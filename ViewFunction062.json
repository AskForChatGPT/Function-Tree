{
  "version": "2.6",
  "nodes": [
    {
      "id": 0,
      "x": -1517.845455900001,
      "y": -456.8358302000003,
      "colorIndex": 0,
      "title": "225-s",
      "content": "",
      "description": "",
      "isConvertedToButton": false,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "saveProject",
        "loadProject",
        "exportSelectedNodes",
        "importSelectedNodes",
        "searchNodesByName",
        "initMinimap",
        "debugVisibleArea",
        "addEventListener"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 0,
        "lastUpdated": "2025-06-30T14:42:45.398Z"
      }
    },
    {
      "id": 1,
      "x": -876.2360600000011,
      "y": -1549.32584,
      "colorIndex": 0,
      "title": "saveProject",
      "content": "function saveProject() {\n`);\n  }\n}\n\n\n\n// 載入項目\n// 載入項目\ntry {\n    const nodesData = nodes.map(node => {\n      const element = node.element;\n\n      let content = '';\n      const inputField = element.querySelector('.paragraph-input');\n      const contentBtn = element.querySelector('.paragraph-btn');\n      const popup = element.querySelector('.paragraph-popup');\n\n      if (contentBtn && popup) {\n        content = popup.textContent || contentBtn.dataset.originalContent || '';\n      } else if (inputField) {\n        content = inputField.value;\n      }\n\n            // 收集變數分析按鈕狀態\n      const variableButtons = Array.from(element.querySelectorAll('.variable-btn'));\n      const variableStates = variableButtons.map(btn => ({\n        name: btn.dataset.variableName,\n        active: btn.dataset.active === 'true'\n      }));\n\n      const nodeData = {\n        id: node.id,\n        x: node.x,\n        y: node.y,\n        colorIndex: node.colorIndex || 0,\n        title: element.querySelector('.node-title').value || '未命名節點',\n        content: content,\n        description: nodeDescriptions[node.id] || '',\n        isConvertedToButton: !!contentBtn,\n        isChildrenHidden: element.classList.contains('children-hidden'),\n        isCollapsed: element.classList.contains('collapsed'),\n        items: Array.from(element.querySelectorAll('.item-text')).map(item => item.value),\n        variableStates: variableStates,\n        variableAnalysisExpanded: element.querySelector('.variable-analysis-container')?.classList.contains('expanded') || false,\n        metadata: {\n          contentLength: content.length,\n          lastUpdated: new Date().toISOString()\n        }\n      };\n\n      // 如果是群組節點，保存額外信息\n      if (node.isGroupNode) {\n        nodeData.isGroupNode = true;\n        nodeData.containedNodes = node.containedNodes || [];\n        nodeData.originalConnections = node.originalConnections || [];\n        nodeData.incomingConnections = node.incomingConnections || [];\n        nodeData.outgoingConnections = node.outgoingConnections || [];\n        \n        // 保存群組節點的原始連接關係\n        nodeData.originalConnections = node.originalConnections || [];\n        \n        // 保存進入和離開群組的連接\n        nodeData.incomingConnections = connections\n          .filter(conn => conn.toNode === node.id)\n          .map(conn => ({\n            fromNode: conn.fromNode,\n            fromOutput: conn.fromOutput,\n            toNode: conn.toNode\n          }));\n          \n        nodeData.outgoingConnections = connections\n          .filter(conn => conn.fromNode === node.id)\n          .map(conn => ({\n            fromNode: conn.fromNode,\n            fromOutput: conn.fromOutput,\n            toNode: conn.toNode\n          }));\n      }\n\n      return nodeData;\n    });\n\n    const connectionsData = connections.map(conn => ({\n      fromNode: conn.fromNode,\n      fromOutput: conn.fromOutput || 0,\n      toNode: conn.toNode,\n      highlighted: conn.highlighted || false\n    }));\n\n\n    const projectData = {\n      version: '2.6',  // 更新版本號以標記支持變數分析\n      nodes: nodesData,\n      connections: connectionsData,\n      viewState: {\n        scale,\n        translateX,\n        translateY\n      },\n      savedAt: new Date().toISOString()\n    };\n\n\n    const dataStr = JSON.stringify(projectData, null, 2);\n    const blob = new Blob([dataStr], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n\n    const filename = `node-project-${new Date().toISOString().replace(/[:.]/g, '-')}.json`;\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.style.display = 'none';\n\n    document.body.appendChild(link);\n    link.click();\n\n    setTimeout(() => {\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    }, 100);\n  } catch (error) {\n    console.error('保存失败:', error);\n    alert(`保存错误: ${error.message}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "variableButtons",
          "active": false
        },
        {
          "name": "variableStates",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "link",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3839,
        "lastUpdated": "2025-06-30T14:42:45.398Z"
      }
    },
    {
      "id": 2,
      "x": -173.60800000000017,
      "y": -305.5999000000003,
      "colorIndex": 0,
      "title": "exportSelectedNodes",
      "content": "function exportSelectedNodes() {\nif (selectedNodes.size === 0) {\n    showStatusMessage('請先選擇要導出的節點', 'warning');\n    return;\n  }\n\n  `, 'error');\n  }\n}\n// 導入選中節點函數\ntry {\n    // 只導出選中的節點，包含群組節點及其內部節點\n    const nodesToExport = Array.from(selectedNodes);\n    const allNodesToExport = new Set(nodesToExport);\n\n    // 收集群組節點中包含的所有節點\n    nodesToExport.forEach(nodeId => {\n      const node = nodes[nodeId];\n      if (node.isGroupNode && node.containedNodes) {\n        node.containedNodes.forEach(containedId => {\n          allNodesToExport.add(containedId);\n        });\n      }\n    });\n\n    // 準備節點數據\n    const nodesData = Array.from(allNodesToExport).map(nodeId => {\n      const node = nodes[nodeId];\n      const element = node.element;\n\n      // 獲取段落內容\n      let content = '';\n      const inputField = element.querySelector('.paragraph-input');\n      const contentBtn = element.querySelector('.paragraph-btn');\n      const popup = element.querySelector('.paragraph-popup');\n\n      if (contentBtn && popup) {\n        content = popup.textContent || contentBtn.dataset.originalContent || '';\n      } else if (inputField) {\n        content = inputField.value;\n      }\n\n      const nodeData = {\n        id: node.id,\n        x: node.x,\n        y: node.y,\n        colorIndex: node.colorIndex || 0,\n        title: element.querySelector('.node-title').value || '未命名節點',\n        content: content,\n        description: nodeDescriptions[node.id] || '',\n        isConvertedToButton: !!contentBtn,\n        items: Array.from(element.querySelectorAll('.item-text')).map(item => item.value),\n        metadata: {\n          contentLength: content.length,\n          lastUpdated: new Date().toISOString()\n        }\n      };\n\n      // 如果是群組節點，保存額外信息\n      if (node.isGroupNode) {\n        nodeData.isGroupNode = true;\n        nodeData.containedNodes = node.containedNodes || [];\n      }\n\n      return nodeData;\n    });\n\n    // 準備連接數據（僅包含導出節點之間的連接）\n    const connectionsData = connections\n      .filter(conn => {\n        return allNodesToExport.has(conn.fromNode) && allNodesToExport.has(conn.toNode);\n      })\n      .map(conn => ({\n        fromNode: conn.fromNode,\n        fromOutput: conn.fromOutput || 0,\n        toNode: conn.toNode\n      }));\n\n    // 創建導出數據\n    const exportData = {\n      version: '2.5',\n      nodes: nodesData,\n      connections: connectionsData,\n      exportedAt: new Date().toISOString()\n    };\n\n    // 生成下載文件\n    const dataStr = JSON.stringify(exportData, null, 2);\n    const blob = new Blob([dataStr], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n\n    const filename = `selected-nodes-${new Date().toISOString().replace(/[:.]/g, '-')}.json`;\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.style.display = 'none';\n\n    document.body.appendChild(link);\n    link.click();\n\n    setTimeout(() => {\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    }, 100);\n\n    showStatusMessage(`已導出 ${nodesToExport.length} 個選中節點`, 'success');\n  } catch (error) {\n    console.error('導出失敗:', error);\n    showStatusMessage(`導出錯誤: ${error.message}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "nodesToExport",
          "active": false
        },
        {
          "name": "allNodesToExport",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodesData",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "inputField",
          "active": false
        },
        {
          "name": "contentBtn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "connectionsData",
          "active": false
        },
        {
          "name": "exportData",
          "active": false
        },
        {
          "name": "dataStr",
          "active": false
        },
        {
          "name": "blob",
          "active": false
        },
        {
          "name": "url",
          "active": false
        },
        {
          "name": "filename",
          "active": false
        },
        {
          "name": "link",
          "active": false
        },
        {
          "name": "link",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3135,
        "lastUpdated": "2025-06-30T14:42:45.398Z"
      }
    },
    {
      "id": 3,
      "x": -868.1739490000004,
      "y": -4430.784756000034,
      "colorIndex": 4,
      "title": "applyTransform",
      "content": "function applyTransform() {\nconsole.log('Applying transform:', {\n    translateX,\n    translateY,\n    scale,\n    screenCenterX: (window.innerWidth / 2 - translateX) / scale,\n    screenCenterY: (window.innerHeight / 2 - translateY) / scale\n  });\n  \n  transformContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  nodesContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  drawConnections();\n  updateNodeList();\n\n  updateMinimap();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "drawConnections",
        "updateNodeList",
        "updateMinimap"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 535,
        "lastUpdated": "2025-06-30T14:42:45.398Z"
      }
    },
    {
      "id": 4,
      "x": 666.7097400000004,
      "y": -4308.531010000002,
      "colorIndex": 3,
      "title": "createNode",
      "content": "function createNode() {\nif (type === 'group') {\n    const node = createGroupNodeElement(x, y, title);\n    const nodeData = initializeGroupNodeData(node, x, y);\n    setupGroupNodeEvents(node, nodeData);\n    return nodeData;\n  } else {\n    const node = createNodeElement(x, y, title);\n    const nodeData = initializeNodeData(node, x, y);\n    setupNodeDrag(node, nodeData);\n    setupCollapseButton(node, nodeData);\n    setupDeleteButton(node, nodeData);\n    setupTitleInput(node);\n    setupParagraphInput(node, nodeData);\n    setupInitialAddButton(node, nodeData);\n    setupAddItemButton(node, nodeData);\n    setupHideChildrenButton(node, nodeData);\n    setupGenerateButton(node, nodeData);\n    setupPortEvents(node, nodeData);\n    updateNodePosition(nodeData);\n      // 初始化變數分析框\n  setupVariableAnalysis(node, nodeData);\n    return nodeData;\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "createGroupNodeElement",
        "initializeGroupNodeData",
        "setupGroupNodeEvents",
        "createNodeElement",
        "initializeNodeData",
        "setupNodeDrag",
        "setupCollapseButton",
        "setupDeleteButton",
        "setupTitleInput",
        "setupParagraphInput",
        "setupInitialAddButton",
        "setupAddItemButton",
        "setupHideChildrenButton",
        "setupGenerateButton",
        "setupPortEvents",
        "updateNodePosition",
        "setupVariableAnalysis"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 846,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 5,
      "x": -541.3081790000028,
      "y": -4316.320736000028,
      "colorIndex": 0,
      "title": "updateNodeList",
      "content": "function updateNodeList() {\nconst nodeList = document.getElementById('node-list');\n  if (!nodeList) return;\n  \n  requestAnimationFrame(() => {\n    const visibleNodes = getVisibleNodes();\n    const visibleNodeIds = visibleNodes.map(n => n.id).join(',');\n    const lastVisibleNodeIds = (lastVisibleNodes || []).map(n => n.id).join(',');\n    \n    if (visibleNodeIds === lastVisibleNodeIds) return;\n    \n    saveCurrentDescriptions();\n    \n    // 建立節點名稱到描述的映射\n    const nameToDescriptionMap = {};\n    nodes.forEach(node => {\n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      if (nodeDescriptions[node.id] && nodeDescriptions[node.id].trim() !== '') {\n        // 如果這個節點有描述，記錄到映射中\n        nameToDescriptionMap[title] = nodeDescriptions[node.id];\n      }\n    });\n    \n    const fragment = document.createDocumentFragment();\n    \n    visibleNodes.forEach(node => {\n      const nodeElement = document.createElement('div');\n      nodeElement.className = 'node-list-item';\n      \n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      \n      // 檢查是否有相同名稱的節點已經有描述\n      let description = nodeDescriptions[node.id] || '';\n      if (!description.trim() && nameToDescriptionMap[title]) {\n        // 如果當前節點沒有描述，但相同名稱的節點有描述，則使用該描述\n        description = nameToDescriptionMap[title];\n        nodeDescriptions[node.id] = description; // 更新節點描述資料\n      }\n      \n      nodeElement.innerHTML = `\n        <div class=\"node-list-name\">${escapeHtml(title)}</div>\n        <textarea class=\"node-list-description\" data-node-id=\"${node.id}\" \n          placeholder=\"輸入節點描述...\">${escapeHtml(description)}</textarea>\n      `;\n      \n      const descInput = nodeElement.querySelector('.node-list-description');\n      descInput.addEventListener('input', () => {\n        const newDescription = descInput.value;\n        nodeDescriptions[descInput.dataset.nodeId] = newDescription;\n        \n        // 當描述變更時，更新所有同名節點的描述\n        if (newDescription.trim() !== '') {\n          const currentTitle = node.element.querySelector('.node-title')?.value || '未命名節點';\n          nodes.forEach(n => {\n            const nTitle = n.element.querySelector('.node-title')?.value || '未命名節點';\n            if (nTitle === currentTitle && n.id !== node.id) {\n              nodeDescriptions[n.id] = newDescription;\n            }\n          });\n           syncDescriptionsForSameNameNodes(descInput.dataset.nodeId);\n          // 觸發重新渲染節點列表\n          updateNodeList();\n        }\n      });\n      \n      fragment.appendChild(nodeElement);\n    });\n    \n    nodeList.innerHTML = '';\n    nodeList.appendChild(fragment);\n    lastVisibleNodes = visibleNodes;\n  });\n}\n\n// 優化的檢查函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "getVisibleNodes",
        "saveCurrentDescriptions",
        "escapeHtml",
        "syncDescriptionsForSameNameNodes"
      ],
      "variableStates": [
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2676,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 6,
      "x": 1900.6586262999992,
      "y": -5193.300787600025,
      "colorIndex": 0,
      "title": "createNodeElement",
      "content": "function createNodeElement() {\nconst node = document.createElement('div');\n  node.className = `node ${COLOR_CLASSES[0]}`;\n  node.style.left = `${x}px`;\n  node.style.top = `${y}px`;\n  node.innerHTML = `\n<div class=\"node-header\">\n  <div class=\"input-port\" data-type=\"input\"></div>\n  <button class=\"collapse-btn\">-</button>\n  <button class=\"jump-to-btn hidden\" title=\"跳轉到同名節點\"></button>\n  <input type=\"text\" class=\"node-title\" value=\"${title}\">\n  <button class=\"delete-node-btn\">×</button>\n  <div class=\"output-port header-port\" data-type=\"output\" style=\"display:none\"></div>\n</div>\n    <div class=\"collapsible\">\n      <textarea class=\"paragraph-input\" placeholder=\"貼上段落內容...\"></textarea>\n      <div class=\"items\">\n        <div class=\"item\">\n          <span class=\"drag-handle\">☰</span>\n          <input type=\"text\" class=\"item-text\" value=\"\">\n          <button class=\"add-node-btn\">+</button>\n          <div class=\"output-port\" data-type=\"output\" data-output-index=\"0\"></div>\n        </div>\n      </div>\n      <div class=\"buttons-container\">\n        <button class=\"add-item-btn\">新加項目</button>\n        <button class=\"hide-children-btn\">隱藏子</button>\n        <button class=\"generate-btn\">一次生成</button>\n      </div>\n      <!-- 變數分析容器 -->\n      <div class=\"variable-analysis-container\">\n  <div class=\"variable-analysis-container\">\n    <div class=\"variable-analysis-header\">\n      <span class=\"variable-analysis-title\">變數分析</span>\n      <button class=\"toggle-variable-analysis-btn\">−</button>\n    </div>\n    <div class=\"variable-analysis-content\" style=\"display:block\"></div>\n  </div>\n</div>\n  `;\n  \n  nodesContainer.appendChild(node);\n  return node;\n}\n\n\n// 添加專用的變數分析框事件處理\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1666,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 7,
      "x": 1903.6516262999992,
      "y": -4908.180787600026,
      "colorIndex": 0,
      "title": "initializeNodeData",
      "content": "function initializeNodeData() {\nconst nodeData = {\n    element: node,\n    id: nodes.length,\n    outputs: [0],\n    x,\n    y,\n    jumpIndex: 0, // 新增跳轉索引\n    colorIndex: 0 // 初始化顏色索引\n  };\n  nodes.push(nodeData);\n\n  // 設置跳轉按鈕事件\n  const jumpBtn = node.querySelector('.jump-to-btn');\n  jumpBtn.addEventListener('click', (e) => {\n    jumpToSameNameNode(nodeData);\n    e.stopPropagation();\n  });\n\n  return nodeData;\n}\n\n// 设置节点拖拽\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "jumpToSameNameNode"
      ],
      "variableStates": [
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 423,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 8,
      "x": 1904.0908562999994,
      "y": -4546.421807600023,
      "colorIndex": 0,
      "title": "setupNodeDrag",
      "content": "function setupNodeDrag() {\nnode.addEventListener('mousedown', (e) => {\n    if (e.target.className.includes('node') || e.target.className === 'node-title') {\n      if (spacePressed || e.button === 1) return;\n\n      draggingNode = nodeData;\n      dragStartWorldX = toWorldX(e.clientX);\n      dragStartWorldY = toWorldY(e.clientY);\n      dragOffsetX = dragStartWorldX - nodeData.x;\n      dragOffsetY = dragStartWorldY - nodeData.y;\n\n      e.stopPropagation();\n    }\n  });\n}\n\n// 设置删除按钮\n// 修改刪除節點函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "toWorldX",
        "toWorldY"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 495,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 9,
      "x": 3154.4384832999986,
      "y": -5097.4132596000145,
      "colorIndex": 3,
      "title": "setupCollapseButton",
      "content": "function setupCollapseButton() {\nconst collapseBtn = node.querySelector('.collapse-btn');\n  collapseBtn.addEventListener('click', (e) => {\n    node.classList.toggle('collapsed');\n    \n    const collapsible = node.querySelector('.collapsible');\n    const originalPorts = node.querySelectorAll('.output-port:not(.header-port)');\n    const headerPort = node.querySelector('.header-port');\n    \n    if (node.classList.contains('collapsed')) {\n      originalPorts.forEach(port => port.style.display = 'none');\n      if (!headerPort) {\n        const port = document.createElement('div');\n        port.className = 'output-port header-port';\n        port.dataset.type = 'output';\n        port.style.display = 'block';\n        node.querySelector('.node-header').appendChild(port);\n      } else {\n        headerPort.style.display = 'block';\n      }\n      collapseBtn.textContent = '+';\n    } else {\n      originalPorts.forEach(port => port.style.display = 'block');\n      if (headerPort) headerPort.style.display = 'none';\n      collapseBtn.textContent = '-';\n    }\n    \n    drawConnections();\n    e.stopPropagation();\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "port",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1118,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 10,
      "x": 3148.9614832999987,
      "y": -4658.949259600018,
      "colorIndex": 0,
      "title": "setupDeleteButton",
      "content": "function setupDeleteButton() {\nnode.querySelector('.delete-node-btn').addEventListener('click', (e) => {\n    // 移除所有與該節點相關的連接\n    connections = connections.filter(conn =>\n    conn.fromNode !== nodeData.id && conn.toNode !== nodeData.id\n    );\n\n    // 重新索引節點ID\n    nodes = nodes.filter(n => n.id !== nodeData.id);\n    nodes.forEach((n, index) => {\n      n.id = index; // 重新分配連續的ID\n    });\n\n    // 更新連接中的節點ID引用\n    connections.forEach(conn => {\n      if (conn.fromNode > nodeData.id) conn.fromNode--;\n      if (conn.toNode > nodeData.id) conn.toNode--;\n    });\n\n    node.remove();\n    drawConnections();\n    updateSameNameHighlights(); // 刪除後更新高亮\n    e.stopPropagation();\n  });\n}\n\n// 设置标题输入\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "drawConnections",
        "updateSameNameHighlights"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 690,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 11,
      "x": 3103.561483299999,
      "y": -4204.959259600015,
      "colorIndex": 0,
      "title": "setupTitleInput",
      "content": "function setupTitleInput() {\nconst titleInput = node.querySelector('.node-title');\n  titleInput.addEventListener('input', () => {\n    titleInput.value = titleInput.value.trim();\n    \n    // 檢查是否有相同名稱的節點已經有描述\n    const nodeData = findNodeByElement(node);\n    if (nodeData) {\n      const sameNameNodes = nodes.filter(n => \n        n.id !== nodeData.id &&\n        n.element.querySelector('.node-title').value === titleInput.value\n      );\n      \n      if (sameNameNodes.length > 0 && !nodeDescriptions[nodeData.id]) {\n        // 使用第一個同名節點的描述\n        const firstSameNameNode = sameNameNodes[0];\n        if (nodeDescriptions[firstSameNameNode.id]) {\n          nodeDescriptions[nodeData.id] = nodeDescriptions[firstSameNameNode.id];\n          updateNodeList(); // 觸發更新\n        }\n      }\n    }\n    \n    updateSameNameHighlights();\n   \n    if (nodeData) {\n      nodeData.jumpIndex = 0;\n      updateJumpButton(nodeData);\n    }\n    nodes.forEach(n => updateJumpButton(n));\n  });\n\n  const nodeData = findNodeByElement(node);\n  if (nodeData) {\n    updateJumpButton(nodeData);\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "findNodeByElement",
        "updateNodeList",
        "updateSameNameHighlights",
        "updateJumpButton"
      ],
      "variableStates": [
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        },
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1071,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 12,
      "x": 4262.204267500001,
      "y": -4841.977118500008,
      "colorIndex": 1,
      "title": "setupParagraphInput",
      "content": "function setupParagraphInput() {\nconst paragraphInput = node.querySelector('.paragraph-input');\n  paragraphInput.addEventListener('input', function() {\n    handleParagraphInput(this, node, nodeData);\n    \n    // 內容變化時自動分析變數\n    if (this.value.trim()) {\n      analyzeVariables(nodeData);\n    }\n  });\n}\n\n// 处理段落输入\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "handleParagraphInput",
        "analyzeVariables"
      ],
      "variableStates": [
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 313,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 13,
      "x": 4341.566927500002,
      "y": -4111.980788499999,
      "colorIndex": 0,
      "title": "setupInitialAddButton",
      "content": "function setupInitialAddButton() {\nnode.querySelector('.add-node-btn').addEventListener('click', (e) => {\n    handleAddNodeClick(nodeData, 0, e);\n  });\n}\n\n// 设置添加项目按钮\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "handleAddNodeClick"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 168,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 14,
      "x": 4127.621027500001,
      "y": -3736.8805885000056,
      "colorIndex": 0,
      "title": "setupAddItemButton",
      "content": "function setupAddItemButton() {\nnode.querySelector('.add-item-btn').addEventListener('click', () => {\n    addNewItem(node, nodeData);\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "addNewItem"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 143,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 15,
      "x": 4678.083027500004,
      "y": -3417.682588500006,
      "colorIndex": 0,
      "title": "setupHideChildrenButton",
      "content": "function setupHideChildrenButton() {\nconst hideChildrenBtn = node.querySelector('.hide-children-btn');\n  \n  nodeData.childStates = new Map();\n\n  hideChildrenBtn.addEventListener('click', (e) => {\n    const childNodes = connections\n      .filter(conn => conn.fromNode === nodeData.id)\n      .map(conn => nodes[conn.toNode]);\n\n    if (!node.classList.contains('children-hidden')) {\n      node.classList.add('children-hidden');\n      hideChildrenBtn.textContent = '顯示子';\n\n      childNodes.forEach((child, index) => {\n        nodeData.childStates.set(child.id, {\n          x: child.x,\n          y: child.y,\n          collapsed: child.element.classList.contains('collapsed')\n        });\n\n        if (!child.element.classList.contains('collapsed')) {\n          child.element.querySelector('.collapse-btn').click();\n        }\n\n        child.x = nodeData.x + 200 / scale;\n        child.y = nodeData.y + (index * 43 / scale);\n        updateNodePosition(child);\n      });\n    } else {\n      node.classList.remove('children-hidden');\n      hideChildrenBtn.textContent = '隱藏子';\n\n      const sortedChildren = childNodes\n        .map(child => ({\n          node: child,\n          originalState: nodeData.childStates.get(child.id)\n        }))\n        .filter(child => child.originalState)\n        .sort((a, b) => a.originalState.y - b.originalState.y);\n\n      let hasOverlap = false;\n      for (let i = 1; i < sortedChildren.length; i++) {\n        const prevChild = sortedChildren[i - 1];\n        const currChild = sortedChildren[i];\n        const prevHeight = prevChild.node.element.getBoundingClientRect().height / scale;\n        const prevBottom = prevChild.originalState.y + prevHeight;\n        if (currChild.originalState.y < prevBottom) {\n          hasOverlap = true;\n          break;\n        }\n      }\n\n      if (hasOverlap) {\n        let currentY = sortedChildren[0]?.originalState.y || nodeData.y;\n        sortedChildren.forEach(({ node, originalState }) => {\n          node.x = originalState.x;\n          node.y = currentY;\n          updateNodePosition(node);\n\n          const isCurrentlyCollapsed = node.element.classList.contains('collapsed');\n          if (isCurrentlyCollapsed !== originalState.collapsed) {\n            node.element.querySelector('.collapse-btn').click();\n          }\n\n          const nodeHeight = node.element.getBoundingClientRect().height / scale;\n          currentY += nodeHeight + 10 / scale;\n        });\n      } else {\n        sortedChildren.forEach(({ node, originalState }) => {\n          node.x = originalState.x;\n          node.y = originalState.y;\n          updateNodePosition(node);\n\n          const isCurrentlyCollapsed = node.element.classList.contains('collapsed');\n          if (isCurrentlyCollapsed !== originalState.collapsed) {\n            node.element.querySelector('.collapse-btn').click();\n          }\n        });\n      }\n\n      nodeData.childStates.clear();\n    }\n\n    drawConnections();\n    e.stopPropagation();\n  });\n}\n\n\n// 修改 updateJumpButton 函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "updateNodePosition",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "sortedChildren",
          "active": false
        },
        {
          "name": "hasOverlap",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "prevChild",
          "active": false
        },
        {
          "name": "currChild",
          "active": false
        },
        {
          "name": "prevHeight",
          "active": false
        },
        {
          "name": "prevBottom",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "isCurrentlyCollapsed",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2988,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 16,
      "x": 4940.5430275,
      "y": -3230.0015884999966,
      "colorIndex": 0,
      "title": "setupGenerateButton",
      "content": "function setupGenerateButton() {\nnode.querySelector('.generate-btn').addEventListener('click', () => {\n    // 獲取所有項目\n    const items = node.querySelectorAll('.item');\n    \n    // 計算基礎位置\n    const baseX = nodeData.x + 200 / scale;\n    let baseY = nodeData.y;\n    \n    // 為每個項目創建子節點\n    items.forEach((item, index) => {\n      const itemText = item.querySelector('.item-text').value;\n      \n      // 創建新節點\n      const newNode = createNode(\n        baseX,\n        baseY,\n        itemText + ' 節點'\n      );\n      \n      // 添加連接\n      connections.push({\n        fromNode: nodeData.id,\n        fromOutput: index,\n        toNode: newNode.id\n      });\n      \n      // 更新下一個節點的Y位置\n      baseY += 235 / scale;\n    });\n    \n    drawConnections();\n  });\n}\n\n\n\n\n// 添加新项目\n// 修改 addNewItem 函數以包含拖動手柄\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "items",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "itemText",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "itemText",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "itemText",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "itemText",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "itemText",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "itemText",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 783,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 17,
      "x": 4105.753027500001,
      "y": -3124.4235885000035,
      "colorIndex": 0,
      "title": "setupPortEvents",
      "content": "function setupPortEvents() {\n// 输入端口\n  node.querySelector('.input-port').addEventListener('mouseup', (e) => {\n    if (connecting) {\n      connections.push( {\n        fromNode: connecting.fromNode,\n        fromOutput: connecting.fromOutput,\n        toNode: nodeData.id\n      });\n      connecting = null;\n      container.classList.remove('connecting');\n      drawConnections();\n    }\n  });\n\n  // 初始输出端口\n  setupOutputPort(node.querySelector('.output-port'), nodeData, 0);\n}\n\n// 设置输出端口\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "drawConnections",
        "setupOutputPort"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 483,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 18,
      "x": 4088.2740274999996,
      "y": -2748.147588500002,
      "colorIndex": 0,
      "title": "updateNodePosition",
      "content": "function updateNodePosition() {\nnode.element.style.left = `${node.x}px`;\nnode.element.style.top = `${node.y}px`;\n  node.element.style.transform = 'none'; // 確保節點不受容器縮放影響\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 173,
        "lastUpdated": "2025-06-30T14:42:45.399Z"
      }
    },
    {
      "id": 19,
      "x": -227.0381790000024,
      "y": -4547.99073600005,
      "colorIndex": 0,
      "title": "getVisibleNodes",
      "content": "function getVisibleNodes() {\n// 1. 獲取視口可見區域（不考慮左側面板，使用整個視窗）\n  const viewport = {\n    left: 0,\n    right: window.innerWidth,\n    top: 0,\n    bottom: window.innerHeight\n  };\n\n  return nodes.filter(node => {\n    // 2. 直接使用getBoundingClientRect獲取屏幕座標\n    const rect = node.element.getBoundingClientRect();\n    \n    // 3. 檢查節點是否在視口內（完全精確判斷）\n    const isVisible = (\n      rect.right > viewport.left &&\n      rect.left < viewport.right &&\n      rect.bottom > viewport.top &&\n      rect.top < viewport.bottom\n    );\n\n    // 4. 控制名稱顯示（直接基於屏幕座標判斷）\n    const nameElement = node.element.querySelector('.node-name');\n    if (nameElement) {\n      nameElement.style.display = isVisible ? 'block' : 'none';\n    }\n\n    // 5. 返回節點是否在緩衝區內（用於渲染優化）\n    const buffer = -200; // 屏幕像素緩衝\n    const inBufferArea = (\n      rect.right > (viewport.left - buffer) &&\n      rect.left < (viewport.right + buffer) &&\n      rect.bottom > (viewport.top - buffer) &&\n      rect.top < (viewport.bottom + buffer)\n    );\n\n    return inBufferArea;\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1017,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 20,
      "x": -236.0381790000024,
      "y": -4157.9907360000425,
      "colorIndex": 0,
      "title": "saveCurrentDescriptions",
      "content": "function saveCurrentDescriptions() {\ndocument.querySelectorAll('.node-list-description').forEach(input => {\n    nodeDescriptions[input.dataset.nodeId] = input.value;\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 173,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 21,
      "x": 10.153820999997606,
      "y": -4431.949736000025,
      "colorIndex": 0,
      "title": "escapeHtml",
      "content": "function escapeHtml() {\nreturn unsafe\n  .replace(/&/g, \"&amp;\")\n  .replace(/</g, \"&lt;\")\n  .replace(/>/g, \"&gt;\")\n  .replace(/\"/g, \"&quot;\")\n  .replace(/'/g, \"&#039;\");\n}\n\n// 显示状态消息函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 185,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 22,
      "x": 8.491820999997572,
      "y": -4168.580736000028,
      "colorIndex": 0,
      "title": "syncDescriptionsForSameNameNodes",
      "content": "function syncDescriptionsForSameNameNodes() {\nconst node = nodes[nodeId];\n  if (!node) return;\n  \n  const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n  const description = nodeDescriptions[nodeId];\n  \n  if (description && description.trim() !== '') {\n    // 更新所有同名節點的描述\n    nodes.forEach(n => {\n      if (n.id !== nodeId) {\n        const nTitle = n.element.querySelector('.node-title')?.value || '未命名節點';\n        if (nTitle === title) {\n          nodeDescriptions[n.id] = description;\n        }\n      }\n    });\n  }\n}\n// 新增函數：更新所有同名節點的高亮狀態\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 565,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 23,
      "x": 2311.4336262999977,
      "y": -5087.777787600027,
      "colorIndex": 0,
      "title": "jumpToSameNameNode",
      "content": "function jumpToSameNameNode() {\nconst title = node.element.querySelector('.node-title').value;\n  const sameNameNodes = nodes.filter(n =>\n  n.id !== node.id &&\n  n.element.querySelector('.node-title').value === title\n  );\n\n  if (sameNameNodes.length > 0) {\n    // 移除所有現有的高亮\n    document.querySelectorAll('.node').forEach(n => {\n      n.classList.remove('highlight');\n    });\n\n    // 高亮所有同名節點\n    sameNameNodes.forEach(targetNode => {\n      targetNode.element.classList.add('highlight');\n    });\n\n    // 顯示提示信息\n    showJumpHint(node, node.jumpIndex + 1, sameNameNodes.length);\n\n    // 更新跳轉索引\n    node.jumpIndex = (node.jumpIndex + 1) % sameNameNodes.length;\n\n    // 設置定時器移除高亮\n    setTimeout(() => {\n      sameNameNodes.forEach(targetNode => {\n        targetNode.element.classList.remove('highlight');\n      });\n    }, 10000);\n  }\n}\n\n// 顯示跳轉順序提示\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "showJumpHint"
      ],
      "variableStates": [
        {
          "name": "title",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 844,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 24,
      "x": 2309.1336262999976,
      "y": -4730.728787600028,
      "colorIndex": 0,
      "title": "toWorldX",
      "content": "function toWorldX() {\nreturn (screenX / scale) + translateX;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 64,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 25,
      "x": 2309.1336262999976,
      "y": -4472.228787600026,
      "colorIndex": 0,
      "title": "toWorldY",
      "content": "function toWorldY() {\nreturn (screenY / scale) + translateY;\n}\n\n// 新增：屏幕坐标与世界坐标转换函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 85,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 26,
      "x": 3401.1513122999986,
      "y": -5092.098576600014,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 27,
      "x": 3469.9514832999976,
      "y": -4591.749259600021,
      "colorIndex": 0,
      "title": "updateSameNameHighlights",
      "content": "function updateSameNameHighlights() {\n// 先移除所有高亮\n  document.querySelectorAll('.node').forEach(node => {\n    node.classList.remove('highlight-same-name');\n  });\n\n  // 建立節點名稱映射\nconst nameMap = {};\n  nodes.forEach(node => {\n    const title = node.element.querySelector('.node-title').value;\n    if (!nameMap[title]) {\n      nameMap[title] = [];\n    }\n    nameMap[title].push(node);\n  });\n\n  // 為有相同名稱的節點添加高亮\n  Object.entries(nameMap).forEach(([title, sameNameNodes]) => {\n    if (sameNameNodes.length > 1) {\n      sameNameNodes.forEach(node => {\n        node.element.classList.add('highlight-same-name');\n      });\n    }\n  });\n}\n\n\n\n// 设置段落输入\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "title",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 640,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 28,
      "x": 3391.5314832999984,
      "y": -4188.019259600025,
      "colorIndex": 0,
      "title": "findNodeByElement",
      "content": "function findNodeByElement() {\nreturn nodes.find(node => node.element === element);\n  }\n\n  // 滾輪縮放\ncontainer.addEventListener('wheel', (e) => {\n  e.preventDefault();\n\n  // 獲取鼠標位置相對於視口的坐標\n  const mouseX = e.clientX;\n  const mouseY = e.clientY;\n\n  // 計算縮放前的世界坐標\n  const worldX = (mouseX - translateX) / scale;\n  const worldY = (mouseY - translateY) / scale;\n\n  // 計算新的縮放比例（保持原有方向邏輯）\n  const delta = -e.deltaY;\n  const newScale = delta > 0 ? scale * 1.1 : scale / 1.1;\n  scale = Math.min(Math.max(0.1, newScale), 3);\n\n  // 計算新的平移值 - 保持鼠標下的點在相同位置\n  translateX = mouseX - worldX * scale;\n  translateY = mouseY - worldY * scale;\n\n  // 應用變換\n  applyTransform();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "applyTransform"
      ],
      "variableStates": [
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 655,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 29,
      "x": 3658.151483299999,
      "y": -4088.88925960002,
      "colorIndex": 0,
      "title": "updateNodeList",
      "content": "function updateNodeList() {\nconst nodeList = document.getElementById('node-list');\n  if (!nodeList) return;\n  \n  requestAnimationFrame(() => {\n    const visibleNodes = getVisibleNodes();\n    const visibleNodeIds = visibleNodes.map(n => n.id).join(',');\n    const lastVisibleNodeIds = (lastVisibleNodes || []).map(n => n.id).join(',');\n    \n    if (visibleNodeIds === lastVisibleNodeIds) return;\n    \n    saveCurrentDescriptions();\n    \n    // 建立節點名稱到描述的映射\n    const nameToDescriptionMap = {};\n    nodes.forEach(node => {\n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      if (nodeDescriptions[node.id] && nodeDescriptions[node.id].trim() !== '') {\n        // 如果這個節點有描述，記錄到映射中\n        nameToDescriptionMap[title] = nodeDescriptions[node.id];\n      }\n    });\n    \n    const fragment = document.createDocumentFragment();\n    \n    visibleNodes.forEach(node => {\n      const nodeElement = document.createElement('div');\n      nodeElement.className = 'node-list-item';\n      \n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      \n      // 檢查是否有相同名稱的節點已經有描述\n      let description = nodeDescriptions[node.id] || '';\n      if (!description.trim() && nameToDescriptionMap[title]) {\n        // 如果當前節點沒有描述，但相同名稱的節點有描述，則使用該描述\n        description = nameToDescriptionMap[title];\n        nodeDescriptions[node.id] = description; // 更新節點描述資料\n      }\n      \n      nodeElement.innerHTML = `\n        <div class=\"node-list-name\">${escapeHtml(title)}</div>\n        <textarea class=\"node-list-description\" data-node-id=\"${node.id}\" \n          placeholder=\"輸入節點描述...\">${escapeHtml(description)}</textarea>\n      `;\n      \n      const descInput = nodeElement.querySelector('.node-list-description');\n      descInput.addEventListener('input', () => {\n        const newDescription = descInput.value;\n        nodeDescriptions[descInput.dataset.nodeId] = newDescription;\n        \n        // 當描述變更時，更新所有同名節點的描述\n        if (newDescription.trim() !== '') {\n          const currentTitle = node.element.querySelector('.node-title')?.value || '未命名節點';\n          nodes.forEach(n => {\n            const nTitle = n.element.querySelector('.node-title')?.value || '未命名節點';\n            if (nTitle === currentTitle && n.id !== node.id) {\n              nodeDescriptions[n.id] = newDescription;\n            }\n          });\n           syncDescriptionsForSameNameNodes(descInput.dataset.nodeId);\n          // 觸發重新渲染節點列表\n          updateNodeList();\n        }\n      });\n      \n      fragment.appendChild(nodeElement);\n    });\n    \n    nodeList.innerHTML = '';\n    nodeList.appendChild(fragment);\n    lastVisibleNodes = visibleNodes;\n  });\n}\n\n// 優化的檢查函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "getVisibleNodes",
        "saveCurrentDescriptions",
        "escapeHtml",
        "syncDescriptionsForSameNameNodes"
      ],
      "variableStates": [
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2676,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 30,
      "x": 3657.521483299999,
      "y": -4037.4392596000157,
      "colorIndex": 0,
      "title": "updateSameNameHighlights",
      "content": "function updateSameNameHighlights() {\n// 先移除所有高亮\n  document.querySelectorAll('.node').forEach(node => {\n    node.classList.remove('highlight-same-name');\n  });\n\n  // 建立節點名稱映射\nconst nameMap = {};\n  nodes.forEach(node => {\n    const title = node.element.querySelector('.node-title').value;\n    if (!nameMap[title]) {\n      nameMap[title] = [];\n    }\n    nameMap[title].push(node);\n  });\n\n  // 為有相同名稱的節點添加高亮\n  Object.entries(nameMap).forEach(([title, sameNameNodes]) => {\n    if (sameNameNodes.length > 1) {\n      sameNameNodes.forEach(node => {\n        node.element.classList.add('highlight-same-name');\n      });\n    }\n  });\n}\n\n\n\n// 设置段落输入\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "title",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 640,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 31,
      "x": 3651.471483299999,
      "y": -3989.479259600013,
      "colorIndex": 0,
      "title": "updateJumpButton",
      "content": "function updateJumpButton() {\nconst title = node.element.querySelector('.node-title').value;\n  const jumpBtn = node.element.querySelector('.jump-to-btn');\n\n  // 查找所有同名節點\n  const sameNameNodes = nodes.filter(n =>\n  n.id !== node.id &&\n  n.element.querySelector('.node-title').value === title\n  );\n\n  if (sameNameNodes.length > 0) {\n    jumpBtn.classList.remove('hidden');\n    jumpBtn.setAttribute('data-count', sameNameNodes.length);\n  jumpBtn.title = `顯示同名節點 (共 ${sameNameNodes.length} 個)`;\n  } else {\n    jumpBtn.classList.add('hidden');\n    jumpBtn.removeAttribute('data-count');\n  }\n}\n\n// 跳轉到同名節點\n// 修改 jumpToSameNameNode 函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "title",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 629,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 32,
      "x": 4612.944267500005,
      "y": -4838.477118500008,
      "colorIndex": 0,
      "title": "handleParagraphInput",
      "content": "function handleParagraphInput() {\nvisibleNodes = getVisibleNodes(); // Get the current visible nodes\n  \n  if (visibleNodes.length === 0) {\n    nodeList.innerHTML = '<div class=\"no-nodes-message\">目前沒有可見節點</div>';\n    return;\n  }\n  \n  const content = inputElement.value.trim();\n  if (content === '') return;\n\n  const functionName = extractFunctionName(content);\n  if (functionName) {\n    node.querySelector('.node-title').value = functionName;\n  }\n\n  const calledFunctions = extractCalledFunctions(content, functionName);\n  if (calledFunctions.length > 0) {\n    createFunctionItems(nodeData, calledFunctions, container);\n  }\n\n  setupParagraphPopup(inputElement, content, nodeData);\n}\n\n// 设置初始添加按钮\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "getVisibleNodes",
        "extractFunctionName",
        "extractCalledFunctions",
        "createFunctionItems",
        "setupParagraphPopup"
      ],
      "variableStates": [
        {
          "name": "content",
          "active": false
        },
        {
          "name": "functionName",
          "active": false
        },
        {
          "name": "calledFunctions",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "functionName",
          "active": false
        },
        {
          "name": "calledFunctions",
          "active": false
        },
        {
          "name": "functionName",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "functionName",
          "active": false
        },
        {
          "name": "calledFunctions",
          "active": false
        },
        {
          "name": "calledFunctions",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 696,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 33,
      "x": 4811.706927500001,
      "y": -4019.250788500001,
      "colorIndex": 0,
      "title": "handleAddNodeClick",
      "content": "function handleAddNodeClick() {\nconst childNodes = connections.filter(conn =>\n  conn.fromNode === nodeData.id &&\n  conn.fromOutput === outputIndex\n  ).length;\n\n  const newNodeX = nodeData.x + 200 / scale;\n  const newNodeY = nodeData.y + (childNodes * 120 / scale);\n\n  const newNode = createNode(newNodeX, newNodeY);\n\n  connections.push( {\n    fromNode: nodeData.id,\n    fromOutput: outputIndex,\n    toNode: newNode.id\n  });\n  drawConnections();\n  e.stopPropagation();\n}\n\n// 设置端口事件\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 482,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 34,
      "x": 4920.083027500001,
      "y": -3417.682588500006,
      "colorIndex": 0,
      "title": "updateNodePosition",
      "content": "function updateNodePosition() {\nnode.element.style.left = `${node.x}px`;\nnode.element.style.top = `${node.y}px`;\n  node.element.style.transform = 'none'; // 確保節點不受容器縮放影響\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 173,
        "lastUpdated": "2025-06-30T14:42:45.400Z"
      }
    },
    {
      "id": 35,
      "x": 4920.083027500001,
      "y": -3364.552588500009,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 36,
      "x": 5160.5430275,
      "y": -3230.0015884999966,
      "colorIndex": 0,
      "title": "createNode",
      "content": "function createNode() {\nif (type === 'group') {\n    const node = createGroupNodeElement(x, y, title);\n    const nodeData = initializeGroupNodeData(node, x, y);\n    setupGroupNodeEvents(node, nodeData);\n    return nodeData;\n  } else {\n    const node = createNodeElement(x, y, title);\n    const nodeData = initializeNodeData(node, x, y);\n    setupNodeDrag(node, nodeData);\n    setupCollapseButton(node, nodeData);\n    setupDeleteButton(node, nodeData);\n    setupTitleInput(node);\n    setupParagraphInput(node, nodeData);\n    setupInitialAddButton(node, nodeData);\n    setupAddItemButton(node, nodeData);\n    setupHideChildrenButton(node, nodeData);\n    setupGenerateButton(node, nodeData);\n    setupPortEvents(node, nodeData);\n    updateNodePosition(nodeData);\n      // 初始化變數分析框\n  setupVariableAnalysis(node, nodeData);\n    return nodeData;\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createGroupNodeElement",
        "initializeGroupNodeData",
        "setupGroupNodeEvents",
        "createNodeElement",
        "initializeNodeData",
        "setupNodeDrag",
        "setupCollapseButton",
        "setupDeleteButton",
        "setupTitleInput",
        "setupParagraphInput",
        "setupInitialAddButton",
        "setupAddItemButton",
        "setupHideChildrenButton",
        "setupGenerateButton",
        "setupPortEvents",
        "updateNodePosition",
        "setupVariableAnalysis"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 846,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 37,
      "x": 5160.5430275,
      "y": -3182.7015884999973,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 38,
      "x": 4436.898027500001,
      "y": -3090.081588500001,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 39,
      "x": 4435.753027500003,
      "y": -3041.1645885000034,
      "colorIndex": 0,
      "title": "setupOutputPort",
      "content": "function setupOutputPort() {\nportElement.addEventListener('mousedown', (e) => {\n    if (spacePressed || e.button === 1) return;\n\n    // 獲取實際顯示的端口（可能是原始端口或header中的端口）\n    const visiblePort = portElement.style.display !== 'none' ? portElement : \n      nodeData.element.querySelector(`.header-port:nth-child(${outputIndex + 4})`);\n    \n    const rect = visiblePort.getBoundingClientRect();\n    connecting = {\n      startX: rect.left + rect.width / 2,\n      startY: rect.top + rect.height / 2,\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      currentX: rect.left + rect.width / 2,\n      currentY: rect.top + rect.height / 2\n    };\n    container.classList.add('connecting');\n    e.stopPropagation();\n  });\n}\n\n// 修改節點位置更新函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 736,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 40,
      "x": 3472.851483299998,
      "y": -4640.84925960002,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 41,
      "x": 2663.6809712999975,
      "y": -4827.323640600027,
      "colorIndex": 0,
      "title": "showJumpHint",
      "content": "function showJumpHint() {\nconst hint = document.createElement('div');\n  hint.className = 'jump-hint';\nhint.textContent = `${current}/${total}`;\n  hint.style.position = 'absolute';\n  hint.style.left = '20px';\n  hint.style.top = '20px';\n  hint.style.background = 'rgba(255, 204, 0, 0.8)';\n  hint.style.color = 'black';\n  hint.style.padding = '5px 10px';\n  hint.style.borderRadius = '10px';\n  hint.style.zIndex = '10000';\n\n  document.body.appendChild(hint);\n\n  setTimeout(() => {\n    hint.style.opacity = '0';\n    hint.style.transition = 'opacity 0.5s';\n    setTimeout(() => hint.remove(), 500);\n  }, 1000);\n}\n\n\n\n\n// 初始化节点数据\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "hint",
          "active": false
        },
        {
          "name": "hint",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 623,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 42,
      "x": 4888.346492000006,
      "y": -4815.789413000013,
      "colorIndex": 0,
      "title": "getVisibleNodes",
      "content": "function getVisibleNodes() {\n// 1. 獲取視口可見區域（不考慮左側面板，使用整個視窗）\n  const viewport = {\n    left: 0,\n    right: window.innerWidth,\n    top: 0,\n    bottom: window.innerHeight\n  };\n\n  return nodes.filter(node => {\n    // 2. 直接使用getBoundingClientRect獲取屏幕座標\n    const rect = node.element.getBoundingClientRect();\n    \n    // 3. 檢查節點是否在視口內（完全精確判斷）\n    const isVisible = (\n      rect.right > viewport.left &&\n      rect.left < viewport.right &&\n      rect.bottom > viewport.top &&\n      rect.top < viewport.bottom\n    );\n\n    // 4. 控制名稱顯示（直接基於屏幕座標判斷）\n    const nameElement = node.element.querySelector('.node-name');\n    if (nameElement) {\n      nameElement.style.display = isVisible ? 'block' : 'none';\n    }\n\n    // 5. 返回節點是否在緩衝區內（用於渲染優化）\n    const buffer = -200; // 屏幕像素緩衝\n    const inBufferArea = (\n      rect.right > (viewport.left - buffer) &&\n      rect.left < (viewport.right + buffer) &&\n      rect.bottom > (viewport.top - buffer) &&\n      rect.top < (viewport.bottom + buffer)\n    );\n\n    return inBufferArea;\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1017,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 43,
      "x": 4883.110077500003,
      "y": -4769.612998500019,
      "colorIndex": 0,
      "title": "extractFunctionName",
      "content": "function extractFunctionName() {\nconst functionNameMatch = content.match(/function\\s+([a-zA-Z_$][0-9a-zA-Z_$]*)/);\n  return functionNameMatch ? functionNameMatch[1] : null;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "functionNameMatch",
          "active": false
        },
        {
          "name": "functionNameMatch",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 176,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 44,
      "x": 5133.250077500003,
      "y": -4805.922998500015,
      "colorIndex": 0,
      "title": "extractCalledFunctions",
      "content": "function extractCalledFunctions() {\nconst functionCallRegex = /([a-zA-Z_$][0-9a-zA-Z_$]*)\\s*\\([^)]*\\)/g;\n  const functionNames = new Set();\n  let match;\n\n  while ((match = functionCallRegex.exec(content)) !== null) {\n    const calledFunctionName = match[1];\n    // 檢查是否在黑名單中或是要排除的函數名\n    if (!FUNCTION_BLACKLIST.includes(calledFunctionName) &&\n    calledFunctionName !== functionNameToExclude) {\n      functionNames.add(calledFunctionName);\n    }\n  }\n\n  return Array.from(functionNames);\n}\n// HTML转义辅助函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        },
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 505,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 45,
      "x": 5382.160077500004,
      "y": -4706.972998500014,
      "colorIndex": 0,
      "title": "createFunctionItems",
      "content": "function createFunctionItems() {\nconst itemsContainer = nodeData.element.querySelector('.items');\n  itemsContainer.innerHTML = '';\n\n  functionNames.forEach((name, index) => {\n    const newItem = document.createElement('div');\n    newItem.className = 'item';\n    newItem.innerHTML = `\n      <span class=\"drag-handle\">☰</span>\n      <input type=\"text\" class=\"item-text\" value=\"${name}\">\n      <button class=\"add-node-btn\">+</button>\n      <div class=\"output-port\" data-type=\"output\"></div>\n    `;\n    itemsContainer.appendChild(newItem);\n\n    nodeData.outputs = functionNames.map((_, i) => i);\n    setupAddNodeButton(newItem, nodeData, index, container);\n    setupOutputPort(newItem, nodeData, index, container);\n    \n    // 確保設置拖動功能\n    setupItemDragAndDrop(nodeData.element, nodeData);\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "setupAddNodeButton",
        "setupOutputPort",
        "setupItemDragAndDrop"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 795,
        "lastUpdated": "2025-06-30T14:42:45.401Z"
      }
    },
    {
      "id": 46,
      "x": 5295.260077500001,
      "y": -4215.052998499996,
      "colorIndex": 0,
      "title": "setupParagraphPopup",
      "content": "function setupParagraphPopup() {\nconst btn = document.createElement('button');\n  btn.className = 'paragraph-btn';\n  btn.textContent = content.length > 50 ? content.substring(0, 47) + '...' : content;\n\n  const popup = document.createElement('div');\n  popup.className = 'paragraph-popup';\n  popup.textContent = content;\n\n  // 添加節點顏色類到彈出框\n  const colorClass = getCurrentColorClass(nodeData);\n  popup.classList.add(colorClass);\n\n  const container = document.createElement('div');\n  container.style.position = 'relative';\n  container.style.display = 'inline-block';\n  container.style.width = '100%';\n\n  // 保存原始輸入框的引用\n  const originalInput = paragraphInput.cloneNode(true);\n  originalInput.style.display = 'none';\n  container.appendChild(originalInput);\n\n  container.appendChild(btn);\n  container.appendChild(popup);\n\n  paragraphInput.replaceWith(container);\n\n  // 每次點擊都創建新的彈出框容器\n  btn.addEventListener('click', (e) => {\n    // 移除現有的彈出框（如果存在）\n    if (nodeData.popupContainer) {\n      nodeData.popupContainer.remove();\n    }\n\n    const btnRect = btn.getBoundingClientRect();\n    const btnCenterX = btnRect.left + btnRect.width / 2;\n    const btnCenterY = btnRect.top + btnRect.height / 2;\n    \n    const worldX = (btnCenterX - translateX) / scale;\n    const worldY = (btnCenterY - translateY) / scale;\n    \n    const popupWidth = 600;\n    const popupHeight = 200;\n    \n    // 創建新的彈出框容器\n    nodeData.popupContainer = document.createElement('div');\n    const popupContainer = nodeData.popupContainer;\n    \n    popupContainer.style.position = 'fixed';\n    popupContainer.style.left = '0';\n    popupContainer.style.top = '0';\n    popupContainer.style.width = `${popupWidth}px`;\n    popupContainer.style.height = `${popupHeight}px`;\n    popupContainer.style.transform = `\n      translate(${worldX * scale + translateX - popupWidth/2}px, \n                ${worldY * scale + translateY - popupHeight/2}px)\n    `;\n    popupContainer.style.zIndex = '10000';\n    \n    // 克隆彈出框內容以避免DOM重複問題\n    const popupClone = popup.cloneNode(true);\n    popupClone.style.display = 'block';\n    popupClone.style.position = 'absolute';\n    popupClone.style.width = '100%';\n    popupClone.style.height = '100%';\n    popupClone.style.overflow = 'auto';\n    \n    popupContainer.appendChild(popupClone);\n    document.body.appendChild(popupContainer);\n\n    // 設置為當前活動彈出框\n    activePopup = popupClone;\n    popupScrollPosition = 0;\n    updatePopupScroll();\n    \n    e.stopPropagation();\n     analyzeVariables(nodeData);\n  });\n\n  // 保留原有的鍵盤事件監聽\n  const clearContentHandler = function(e) {\n    if (e.key.toLowerCase() === 'x' && activePopup === popup) {\n      originalInput.value = '';\n      resetItemsList(nodeData);\n      container.replaceWith(originalInput);\n      document.removeEventListener('keydown', clearContentHandler);\n      if (nodeData.popupContainer) {\n        nodeData.popupContainer.remove();\n        nodeData.popupContainer = null;\n      }\n      activePopup = null;\n      e.preventDefault();\n    }\n  };\n  document.addEventListener('keydown', clearContentHandler);\n\n  // 點擊外部關閉\n  document.addEventListener('click', (e) => {\n    if (nodeData.popupContainer && \n        !nodeData.popupContainer.contains(e.target) && \n        !container.contains(e.target)) {\n      nodeData.popupContainer.remove();\n      nodeData.popupContainer = null;\n      activePopup = null;\n    }\n  });\n}\n\n// 新增變數分析函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "getCurrentColorClass",
        "updatePopupScroll",
        "analyzeVariables",
        "resetItemsList"
      ],
      "variableStates": [
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "btnRect",
          "active": false
        },
        {
          "name": "btnCenterX",
          "active": false
        },
        {
          "name": "btnCenterY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "popupWidth",
          "active": false
        },
        {
          "name": "popupHeight",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        },
        {
          "name": "clearContentHandler",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3362,
        "lastUpdated": "2025-06-30T14:42:45.402Z"
      }
    },
    {
      "id": 47,
      "x": 5031.706927499999,
      "y": -4019.250788500001,
      "colorIndex": 0,
      "title": "createNode",
      "content": "function createNode() {\nif (type === 'group') {\n    const node = createGroupNodeElement(x, y, title);\n    const nodeData = initializeGroupNodeData(node, x, y);\n    setupGroupNodeEvents(node, nodeData);\n    return nodeData;\n  } else {\n    const node = createNodeElement(x, y, title);\n    const nodeData = initializeNodeData(node, x, y);\n    setupNodeDrag(node, nodeData);\n    setupCollapseButton(node, nodeData);\n    setupDeleteButton(node, nodeData);\n    setupTitleInput(node);\n    setupParagraphInput(node, nodeData);\n    setupInitialAddButton(node, nodeData);\n    setupAddItemButton(node, nodeData);\n    setupHideChildrenButton(node, nodeData);\n    setupGenerateButton(node, nodeData);\n    setupPortEvents(node, nodeData);\n    updateNodePosition(nodeData);\n      // 初始化變數分析框\n  setupVariableAnalysis(node, nodeData);\n    return nodeData;\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createGroupNodeElement",
        "initializeGroupNodeData",
        "setupGroupNodeEvents",
        "createNodeElement",
        "initializeNodeData",
        "setupNodeDrag",
        "setupCollapseButton",
        "setupDeleteButton",
        "setupTitleInput",
        "setupParagraphInput",
        "setupInitialAddButton",
        "setupAddItemButton",
        "setupHideChildrenButton",
        "setupGenerateButton",
        "setupPortEvents",
        "updateNodePosition",
        "setupVariableAnalysis"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 846,
        "lastUpdated": "2025-06-30T14:42:45.402Z"
      }
    },
    {
      "id": 48,
      "x": 5031.706927499999,
      "y": -3971.9507885000003,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.402Z"
      }
    },
    {
      "id": 49,
      "x": 5693.329168409093,
      "y": -4761.193907590921,
      "colorIndex": 0,
      "title": "setupAddNodeButton",
      "content": "function setupAddNodeButton() {\nitemElement.querySelector('.add-node-btn').addEventListener('click', (e) => {\n    const name = itemElement.querySelector('.item-text').value;\n\n    const childNodes = connections.filter(conn =>\n    conn.fromNode === nodeData.id &&\n    conn.fromOutput === outputIndex\n    ).length;\n\n    const baseX = nodeData.x + 200 / scale;\n    const baseY = nodeData.y + (childNodes * 120 / scale);\n\n    const newNode = createNode(\n    baseX,\n    baseY,\n    name + ' 節點'\n    );\n\n    connections.push( {\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      toNode: newNode.id\n    });\n    drawConnections();\n    e.stopPropagation();\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 670,
        "lastUpdated": "2025-06-30T14:42:45.402Z"
      }
    },
    {
      "id": 50,
      "x": 5687.39189568182,
      "y": -4283.662089409099,
      "colorIndex": 0,
      "title": "setupOutputPort",
      "content": "function setupOutputPort() {\nportElement.addEventListener('mousedown', (e) => {\n    if (spacePressed || e.button === 1) return;\n\n    // 獲取實際顯示的端口（可能是原始端口或header中的端口）\n    const visiblePort = portElement.style.display !== 'none' ? portElement : \n      nodeData.element.querySelector(`.header-port:nth-child(${outputIndex + 4})`);\n    \n    const rect = visiblePort.getBoundingClientRect();\n    connecting = {\n      startX: rect.left + rect.width / 2,\n      startY: rect.top + rect.height / 2,\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      currentX: rect.left + rect.width / 2,\n      currentY: rect.top + rect.height / 2\n    };\n    container.classList.add('connecting');\n    e.stopPropagation();\n  });\n}\n\n// 修改節點位置更新函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 736,
        "lastUpdated": "2025-06-30T14:42:45.402Z"
      }
    },
    {
      "id": 51,
      "x": 5581.830077499999,
      "y": -4173.1729984999965,
      "colorIndex": 0,
      "title": "getCurrentColorClass",
      "content": "function getCurrentColorClass() {\nconst nodeElement = nodeData.element;\n  for (const colorClass of COLOR_CLASSES) {\n    if (nodeElement.classList.contains(colorClass)) {\n      return colorClass;\n    }\n  }\n  return COLOR_CLASSES[0]; // 默認顏色\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 243,
        "lastUpdated": "2025-06-30T14:42:45.402Z"
      }
    },
    {
      "id": 52,
      "x": 5582.444622954545,
      "y": -3873.3266348636384,
      "colorIndex": 0,
      "title": "updatePopupScroll",
      "content": "function updatePopupScroll() {\nif (activePopup) {\n    activePopup.scrollTop = popupScrollPosition;\n  }\n}\n\n\n// 创建框选元素\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 118,
        "lastUpdated": "2025-06-30T14:42:45.402Z"
      }
    },
    {
      "id": 53,
      "x": 5824.590077500001,
      "y": -4043.1529985000047,
      "colorIndex": 0,
      "title": "resetItemsList",
      "content": "function resetItemsList() {\nconst itemsContainer = nodeData.element.querySelector('.items');\n  itemsContainer.innerHTML = `\n    <div class=\"item\">\n      <span class=\"drag-handle\">☰</span>\n      <input type=\"text\" class=\"item-text\" value=\"\">\n      <button class=\"add-node-btn\">+</button>\n      <div class=\"output-port\" data-type=\"output\"></div>\n    </div>\n  `;\n\n  nodeData.outputs = [0];\n  const newItem = itemsContainer.querySelector('.item');\n  setupAddNodeButton(newItem, nodeData, 0, container);\n  setupOutputPort(newItem, nodeData, 0, container);\n  setupItemDragAndDrop(nodeData.element, nodeData); // 新增這行\n\n  // 恢復輸入框（如果被替換）\n  const containerDiv = nodeData.element.querySelector('.paragraph-container');\n  if (containerDiv) {\n    const textarea = document.createElement('textarea');\n    textarea.className = 'paragraph-input';\n    textarea.placeholder = '貼上段落內容...';\n    containerDiv.replaceWith(textarea);\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "setupAddNodeButton",
        "setupOutputPort",
        "setupItemDragAndDrop"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 919,
        "lastUpdated": "2025-06-30T14:42:45.402Z"
      }
    },
    {
      "id": 54,
      "x": -638.1430105000004,
      "y": -1449.6209119000023,
      "colorIndex": 1,
      "title": "loadProject",
      "content": "function loadProject() {\nconst file = event.target.files[0];\n  if (!file) return;\n\n  const reader = new FileReader();\n  reader.onload = (e) => {\n    \n  };\n\n  reader.readAsText(file);\n  event.target.value = '';\n}\n\n// 導出選中節點函數\ntry {\n      const projectData = JSON.parse(e.target.result);\n\n      nodesContainer.innerHTML = '';\n      nodes = [];\n      connections = [];\n      ALL_ACTIVE_POPUPS.clear();\n      activePopup = null;\n\n      if (projectData.viewState) {\n        scale = projectData.viewState.scale || 1;\n        translateX = projectData.viewState.translateX || window.innerWidth / 2 - 100;\n        translateY = projectData.viewState.translateY || window.innerHeight / 2 - 50;\n        applyTransform();\n      }\n\n      const nodeMap = {};\n      const groupNodesData = [];\n      \n      // 第一遍：創建所有普通節點\n      projectData.nodes?.forEach(nodeData => {\n        if (nodeData.isGroupNode) {\n          groupNodesData.push(nodeData); // 暫存群組節點數據，稍後處理\n          return;\n        }\n        \n        // 創建普通節點...\n        const newNode = createNode(nodeData.x, nodeData.y, nodeData.title || '節點');\n        nodeMap[nodeData.id] = newNode;\n\n        const colorClass = COLOR_CLASSES[nodeData.colorIndex % COLOR_CLASSES.length];\n        newNode.element.classList.add(colorClass);\n        newNode.colorIndex = nodeData.colorIndex;\n\n        // 恢復折疊狀態\n        if (nodeData.isCollapsed) {\n          newNode.element.classList.add('collapsed');\n          const collapseBtn = newNode.element.querySelector('.collapse-btn');\n          if (collapseBtn) {\n            collapseBtn.textContent = '+';\n            const originalPorts = newNode.element.querySelectorAll('.output-port:not(.header-port)');\n            const headerPort = newNode.element.querySelector('.header-port');\n            originalPorts.forEach(port => port.style.display = 'none');\n            if (!headerPort) {\n              const port = document.createElement('div');\n              port.className = 'output-port header-port';\n              port.dataset.type = 'output';\n              port.style.display = 'block';\n              newNode.element.querySelector('.node-header').appendChild(port);\n            } else {\n              headerPort.style.display = 'block';\n            }\n          }\n        }\n\n        const paragraphInput = newNode.element.querySelector('.paragraph-input');\n        if (paragraphInput && nodeData.content !== undefined) {\n          paragraphInput.value = nodeData.content;\n\n          if (nodeData.isConvertedToButton && nodeData.content.trim()) {\n            const btn = document.createElement('button');\n            btn.className = 'paragraph-btn';\n            btn.textContent = nodeData.content.length > 50\n              ? nodeData.content.substring(0, 47) + '...'\n              : nodeData.content;\n            btn.dataset.originalContent = nodeData.content;\n\n            const popup = document.createElement('div');\n            popup.className = 'paragraph-popup';\n            popup.textContent = nodeData.content;\n            popup.classList.add(colorClass);\n\n            const container = document.createElement('div');\n            container.style.position = 'relative';\n            container.style.display = 'inline-block';\n            container.style.width = '100%';\n\n            const originalInput = paragraphInput.cloneNode(true);\n            originalInput.style.display = 'none';\n            container.appendChild(originalInput);\n            container.appendChild(btn);\n            container.appendChild(popup);\n\n            paragraphInput.replaceWith(container);\n            setupParagraphButtonEvents(btn, popup, originalInput, newNode);\n          }\n        }\n\n        const itemsContainer = newNode.element.querySelector('.items');\n        if (itemsContainer && nodeData.items) {\n          itemsContainer.innerHTML = '';\n          newNode.outputs = []; // 重置 outputs 數組\n        \n          nodeData.items.forEach((itemText, index) => {\n            const newItem = document.createElement('div');\n            newItem.className = 'item';\n            newItem.innerHTML = `\n              <span class=\"drag-handle\">☰</span>\n              <input type=\"text\" class=\"item-text\" value=\"${escapeHtml(itemText || '項目 ' + (index + 1))}\">\n              <button class=\"add-node-btn\">+</button>\n              <div class=\"output-port\" data-type=\"output\"></div>\n            `;\n            itemsContainer.appendChild(newItem);\n        \n            newNode.outputs.push(index); // 確保 outputs 數組正確更新\n            setupAddNodeButton(newItem, newNode, index, container);\n            setupOutputPort(newItem, newNode, index, container);\n            setupItemDragAndDrop(newNode.element, newNode);\n          });\n        }\n\n        // 恢復變數分析狀態\n        if (nodeData.content && nodeData.content.trim()) {\n          // 強制分析變數\n          analyzeVariables(newNode);\n          \n          // 恢復變數按鈕狀態\n          if (nodeData.variableStates) {\n            nodeData.variableStates.forEach(variableState => {\n              const btn = newNode.element.querySelector(`.variable-btn[data-variable-name=\"${variableState.name}\"]`);\n              if (btn) {\n                btn.dataset.active = variableState.active.toString();\n                if (variableState.active) {\n                  btn.style.backgroundColor = '#4a90e2';\n                  btn.style.color = 'white';\n                }\n              }\n            });\n          }\n          \n          // 恢復折疊狀態\n          const analysisContainer = newNode.element.querySelector('.variable-analysis-container');\n          const toggleBtn = newNode.element.querySelector('.toggle-variable-analysis-btn');\n          if (analysisContainer && toggleBtn) {\n            if (nodeData.variableAnalysisExpanded) {\n              analysisContainer.classList.add('expanded');\n              toggleBtn.textContent = '-';\n            } else {\n              analysisContainer.classList.remove('expanded');\n              toggleBtn.textContent = '+';\n            }\n          }\n        }\n\n        newNode.childStates = new Map();\n        const childNodes = projectData.connections\n          ?.filter(conn => conn.fromNode === nodeData.id)\n          .map(conn => projectData.nodes.find(n => n.id === conn.toNode));\n\n        if (childNodes && childNodes.length > 0) {\n          childNodes.forEach((childData) => {\n            if (childData) {\n              newNode.childStates.set(childData.id, {\n                x: childData.x,\n                y: childData.y,\n                collapsed: childData.isCollapsed || false\n              });\n            }\n          });\n        }\n\n        if (nodeData.isChildrenHidden) {\n          newNode.element.classList.add('children-hidden');\n          const hideChildrenBtn = newNode.element.querySelector('.hide-children-btn');\n          if (hideChildrenBtn) {\n            hideChildrenBtn.textContent = '顯示子';\n\n            const currentChildNodes = connections\n              .filter(conn => conn.fromNode === newNode.id)\n              .map(conn => nodes[conn.toNode]);\n\n            currentChildNodes.forEach((child, index) => {\n              if (!newNode.childStates.has(child.id)) {\n                newNode.childStates.set(child.id, {\n                  x: child.x,\n                  y: child.y,\n                  collapsed: child.element.classList.contains('collapsed')\n                });\n              }\n\n              if (!child.element.classList.contains('collapsed')) {\n                child.element.querySelector('.collapse-btn').click();\n              }\n\n              child.x = newNode.x + 200 / scale;\n              child.y = newNode.y + (index * 43 / scale);\n              updateNodePosition(child);\n            });\n          }\n        }\n      });\n\n      // 第二遍：創建群組節點並處理連接\n      groupNodesData.forEach(nodeData => {\n        const groupNodeElement = createGroupNodeElement(nodeData.x, nodeData.y, nodeData.title);\n        const groupNodeData = initializeGroupNodeData(\n          groupNodeElement, \n          nodeData.x, \n          nodeData.y, \n          nodeData.containedNodes || []\n        );\n        \n        // 恢復群組節點的屬性\n        groupNodeData.isGroupNode = true;  // 確保標記為群組節點\n        groupNodeData.originalConnections = nodeData.originalConnections || [];\n        groupNodeData.incomingConnections = nodeData.incomingConnections || [];\n        groupNodeData.outgoingConnections = nodeData.outgoingConnections || [];\n        \n        // 設置解散按鈕事件\n        setupUngroupButton(groupNodeElement, groupNodeData);\n        \n        // 隱藏被包含的節點\n        nodeData.containedNodes?.forEach(nodeId => {\n          if (nodeMap[nodeId] && nodeMap[nodeId].element) {\n            nodeMap[nodeId].element.style.display = 'none';\n          }\n        });\n        \n        nodeMap[nodeData.id] = groupNodeData;\n      });\n\n      // 第三遍：恢復所有連接（包括群組節點的連接）\n      projectData.connections?.forEach(conn => {\n        // 檢查連接的兩端節點是否存在\n        const fromNodeExists = nodeMap[conn.fromNode] !== undefined;\n        const toNodeExists = nodeMap[conn.toNode] !== undefined;\n        \n        if (fromNodeExists && toNodeExists) {\n          connections.push({\n            fromNode: nodeMap[conn.fromNode].id,\n            fromOutput: conn.fromOutput || 0,\n            toNode: nodeMap[conn.toNode].id\n          });\n        } else {\n          console.warn('Invalid connection found:', conn);\n        }\n      });\n\n      // 特別處理群組節點的連接關係\n      groupNodesData.forEach(nodeData => {\n        const groupNode = nodeMap[nodeData.id];\n        if (!groupNode) return;\n\n        // 處理進入群組的連接\n        groupNode.incomingConnections.forEach(conn => {\n          if (nodeMap[conn.fromNode] && nodeMap[conn.toNode]) {\n            connections.push({\n              fromNode: nodeMap[conn.fromNode].id,\n              fromOutput: conn.fromOutput,\n              toNode: groupNode.id // 連接到群組節點本身\n            });\n          }\n        });\n\n        // 處理離開群組的連接\n        groupNode.outgoingConnections.forEach(conn => {\n          if (nodeMap[conn.fromNode] && nodeMap[conn.toNode]) {\n            connections.push({\n              fromNode: groupNode.id, // 從群組節點出發\n              fromOutput: conn.fromOutput,\n              toNode: nodeMap[conn.toNode].id\n            });\n          }\n        });\n      });\n\n      drawConnections();\n      showStatusMessage('項目載入完成', 'success');\n    } catch (error) {\n      console.error('載入失敗:', error);\n      showStatusMessage('載入失敗，請檢查文件格式', 'error');\n    }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "applyTransform",
        "createNode",
        "setupParagraphButtonEvents",
        "escapeHtml",
        "setupAddNodeButton",
        "setupOutputPort",
        "setupItemDragAndDrop",
        "analyzeVariables",
        "updateNodePosition",
        "initializeGroupNodeData",
        "setupUngroupButton",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "projectData",
          "active": false
        },
        {
          "name": "nodeMap",
          "active": false
        },
        {
          "name": "groupNodesData",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "hideChildrenBtn",
          "active": false
        },
        {
          "name": "currentChildNodes",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "fromNodeExists",
          "active": false
        },
        {
          "name": "toNodeExists",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 10348,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 55,
      "x": 912.564860243802,
      "y": -2562.107270247111,
      "colorIndex": 1,
      "title": "setupParagraphButtonEvents",
      "content": "function setupParagraphButtonEvents() {\n// 檢查必要的DOM元素是否存在\n  if (!btn || !btn.parentNode || !popup) {\n    console.error('無法設置按鈕事件：缺少必要的DOM元素');\n    return;\n  }\n\n  // 先克隆原始按鈕（保留原始按鈕不變）\n  const btnClone = btn.cloneNode(true);\n  \n  // 創建按鈕容器\n  const buttonContainer = document.createElement('div');\n  buttonContainer.style.display = 'flex';\n  buttonContainer.style.alignItems = 'center';\n  buttonContainer.style.marginBottom = '10px';\n\n  // 創建並添加COPY和UPDATE按鈕\n  const copyBtn = createCopyButton();\n  const updateBtn = createUpdateButton();\n\n  // 先將克隆按鈕和更新按鈕添加到容器\n  buttonContainer.appendChild(btnClone);\n  buttonContainer.appendChild(updateBtn);\n\n  // 小地圖點擊事件\nminimapCanvas.addEventListener('click', (e) => {\n  const rect = minimapCanvas.getBoundingClientRect();\n  const clickX = e.clientX - rect.left;\n  const clickY = e.clientY - rect.top;\n  \n  // 計算所有節點的邊界（與updateMinimap相同）\n  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n  nodes.forEach(node => {\n    minX = Math.min(minX, node.x);\n    minY = Math.min(minY, node.y);\n    maxX = Math.max(maxX, node.x + 200);\n    maxY = Math.max(maxY, node.y + getNodeHeight(node.element));\n  });\n  \n  const padding = 50;\n  minX -= padding;\n  minY -= padding;\n  maxX += padding;\n  maxY += padding;\n  \n  const width = maxX - minX;\n  const height = maxY - minY;\n  const scaleX = minimapCanvas.width / width;\n  const scaleY = minimapCanvas.height / height;\n  const scale = Math.min(scaleX, scaleY);\n  \n  // 計算點擊位置對應的世界座標\n  const worldX = (clickX / scale) + minX;\n  const worldY = (clickY / scale) + minY;\n  \n  // 移動視圖到點擊位置\n  smoothMoveTo(worldX, worldY, this.scale, 300);\n});\n\n  // 替換原始按鈕\n  \n\n  // 保存原始位置信息\n  const { originalParent, originalNextSibling, originalStyles } = saveOriginalPopupPosition(popup);\n  \n  // 設置按鈕事件\n  setupCopyButtonEvents(copyBtn, popup);\n  setupUpdateButtonEvents(updateBtn, popup, nodeData);\n  popup.appendChild(copyBtn);\n\n  // 設置彈出框切換事件\n  setupPopupToggleEvents(btnClone, popup, nodeData);\n\n  // 設置全局事件處理器\n  const handleClickOutside = createClickOutsideHandler(popup, originalParent, originalNextSibling, originalStyles, nodeData);\n  const clearHandler = createClearHandler(popup, paragraphInput, nodeData);\n\n  document.addEventListener('click', handleClickOutside);\n  document.addEventListener('keydown', clearHandler);\n\n  // 儲存事件處理器以便清理\n  popup.dataset.eventHandlers = JSON.stringify({\n    click: handleClickOutside,\n    keydown: clearHandler\n  });\n\n  setupPopupCleanup(popup, handleClickOutside, clearHandler);\n  \n  return btnClone;\n}\n\n\n// 修改後的 createButtonContainer 函數\ntry {\n    btn.parentNode.replaceChild(buttonContainer, btn);\n  } catch (error) {\n    console.error('替換按鈕失敗:', error);\n    return;\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "createCopyButton",
        "createUpdateButton",
        "smoothMoveTo",
        "saveOriginalPopupPosition",
        "setupCopyButtonEvents",
        "setupUpdateButtonEvents",
        "setupPopupToggleEvents",
        "createClickOutsideHandler",
        "createClearHandler",
        "setupPopupCleanup"
      ],
      "variableStates": [
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2693,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 56,
      "x": -99.7035505,
      "y": -1358.3000719000029,
      "colorIndex": 0,
      "title": "escapeHtml",
      "content": "function escapeHtml() {\nreturn unsafe\n  .replace(/&/g, \"&amp;\")\n  .replace(/</g, \"&lt;\")\n  .replace(/>/g, \"&gt;\")\n  .replace(/\"/g, \"&quot;\")\n  .replace(/'/g, \"&#039;\");\n}\n\n// 显示状态消息函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 185,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 57,
      "x": -104.7035505,
      "y": -1314.163708263639,
      "colorIndex": 0,
      "title": "setupAddNodeButton",
      "content": "function setupAddNodeButton() {\nitemElement.querySelector('.add-node-btn').addEventListener('click', (e) => {\n    const name = itemElement.querySelector('.item-text').value;\n\n    const childNodes = connections.filter(conn =>\n    conn.fromNode === nodeData.id &&\n    conn.fromOutput === outputIndex\n    ).length;\n\n    const baseX = nodeData.x + 200 / scale;\n    const baseY = nodeData.y + (childNodes * 120 / scale);\n\n    const newNode = createNode(\n    baseX,\n    baseY,\n    name + ' 節點'\n    );\n\n    connections.push( {\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      toNode: newNode.id\n    });\n    drawConnections();\n    e.stopPropagation();\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 670,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 58,
      "x": -105.90264140909119,
      "y": -1268.1009809909115,
      "colorIndex": 0,
      "title": "setupOutputPort",
      "content": "function setupOutputPort() {\nportElement.addEventListener('mousedown', (e) => {\n    if (spacePressed || e.button === 1) return;\n\n    // 獲取實際顯示的端口（可能是原始端口或header中的端口）\n    const visiblePort = portElement.style.display !== 'none' ? portElement : \n      nodeData.element.querySelector(`.header-port:nth-child(${outputIndex + 4})`);\n    \n    const rect = visiblePort.getBoundingClientRect();\n    connecting = {\n      startX: rect.left + rect.width / 2,\n      startY: rect.top + rect.height / 2,\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      currentX: rect.left + rect.width / 2,\n      currentY: rect.top + rect.height / 2\n    };\n    container.classList.add('connecting');\n    e.stopPropagation();\n  });\n}\n\n// 修改節點位置更新函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 736,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 59,
      "x": -79.0213686818181,
      "y": -533.4089809909105,
      "colorIndex": 0,
      "title": "updateNodePosition",
      "content": "function updateNodePosition() {\nnode.element.style.left = `${node.x}px`;\nnode.element.style.top = `${node.y}px`;\n  node.element.style.transform = 'none'; // 確保節點不受容器縮放影響\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 173,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 60,
      "x": -78.83955049999986,
      "y": -488.7271628090921,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 61,
      "x": 1427.1649008801653,
      "y": -3009.517031156204,
      "colorIndex": 2,
      "title": "createCopyButton",
      "content": "function createCopyButton() {\nconst copyBtn = document.createElement('button');\n  copyBtn.className = 'copy-btn';\n  copyBtn.textContent = '';\n  return copyBtn;\n}\n\n// 創建UPDATE按鈕\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 178,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 62,
      "x": 1656.3299917892564,
      "y": -2972.115667519841,
      "colorIndex": 0,
      "title": "createUpdateButton",
      "content": "function createUpdateButton() {\nconst updateBtn = document.createElement('button');\n  updateBtn.className = 'update-btn';\n  updateBtn.textContent = '更新';\n  updateBtn.title = '更新內容並調整連接';\n  return updateBtn;\n}\n\n// 將按鈕添加到容器\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 223,
        "lastUpdated": "2025-06-30T14:42:45.404Z"
      }
    },
    {
      "id": 63,
      "x": 1884.5859917892567,
      "y": -2909.087303883475,
      "colorIndex": 1,
      "title": "saveOriginalPopupPosition",
      "content": "function saveOriginalPopupPosition() {\nreturn {\n    originalParent: popup.parentNode,\n    originalNextSibling: popup.nextSibling,\n    originalStyles: {\n      position: popup.style.position,\n      left: popup.style.left,\n      top: popup.style.top,\n      zIndex: popup.style.zIndex\n    }\n  };\n}\n\n// 設置彈出框切換事件\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 309,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 64,
      "x": 1395.7499917892562,
      "y": -2639.721940247112,
      "colorIndex": 0,
      "title": "setupCopyButtonEvents",
      "content": "function setupCopyButtonEvents() {\ncopyBtn.addEventListener('click', (e) => {\n    e.stopPropagation();\n    handleCopyText(popup.textContent, copyBtn);\n  });\n}\n\n// 處理複製文本\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "handleCopyText"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 171,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 65,
      "x": 2354.4999917892574,
      "y": -2322.425576610747,
      "colorIndex": 0,
      "title": "setupUpdateButtonEvents",
      "content": "function setupUpdateButtonEvents() {\nupdateBtn.addEventListener('click', (e) => {\n    e.stopPropagation();\n    showUpdateDialog(popup.textContent, (newContent) => {\n      if (newContent !== null) {\n        updateNodeContent(nodeData, newContent);\n      }\n    });\n  });\n}\n\n// 保存彈出框原始位置\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "showUpdateDialog",
        "updateNodeContent"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 286,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 66,
      "x": 1759.5478317892575,
      "y": -2245.1208929743825,
      "colorIndex": 0,
      "title": "setupPopupToggleEvents",
      "content": "function setupPopupToggleEvents() {\nbutton.addEventListener('click', (e) => {\n    // 移除現有的彈出框（如果存在）\n    if (nodeData.popupContainer) {\n      nodeData.popupContainer.remove();\n      nodeData.popupContainer = null;\n    }\n\n    // 創建新的彈出框容器\n    const popupContainer = document.createElement('div');\n    popupContainer.style.position = 'fixed';\n    popupContainer.style.zIndex = '2147483647';\n\n    // 克隆彈出框內容以避免DOM重複問題\n    const popupClone = popup.cloneNode(true);\n    popupClone.style.display = 'block';\n    popupClone.style.width = '100%';\n    popupClone.style.height = '100%';\n    popupClone.style.overflow = 'auto';\n    popupContainer.appendChild(popupClone);\n\n    document.body.appendChild(popupContainer);\n    nodeData.popupContainer = popupContainer;\n\n    // 更新ALL_ACTIVE_POPUPS\n    ALL_ACTIVE_POPUPS.add(popupClone);\n    activePopup = popupClone;\n\n    // 排列彈出框\n    arrangePopups();\n\n    e.stopPropagation();\n  });\n}\n\n// 設置全局事件處理器\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "arrangePopups"
      ],
      "variableStates": [
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupContainer",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        },
        {
          "name": "popupClone",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 934,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 67,
      "x": 1227.0378317892573,
      "y": -2184.4845293380213,
      "colorIndex": 0,
      "title": "createClickOutsideHandler",
      "content": "function createClickOutsideHandler() {\nreturn (e) => {\n    const isClickInsideAnyPopup = Array.from(ALL_ACTIVE_POPUPS).some(p => p.contains(e.target));\n    const isClickInsideButton = nodeData.element.contains(e.target);\n\n    if (!isClickInsideAnyPopup && !isClickInsideButton) {\n      closeAllPopups(popup, originalParent, originalNextSibling, originalStyles, nodeData);\n    }\n  };\n}\n\n// 檢查是否點擊了任何彈窗\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "closeAllPopups"
      ],
      "variableStates": [
        {
          "name": "isClickInsideAnyPopup",
          "active": false
        },
        {
          "name": "isClickInsideButton",
          "active": false
        },
        {
          "name": "isClickInsideAnyPopup",
          "active": false
        },
        {
          "name": "isClickInsideAnyPopup",
          "active": false
        },
        {
          "name": "isClickInsideButton",
          "active": false
        },
        {
          "name": "isClickInsideButton",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 402,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 68,
      "x": 1278.8621317892555,
      "y": -1821.6551657016562,
      "colorIndex": 0,
      "title": "createClearHandler",
      "content": "function createClearHandler() {\nreturn (e) => {\n    if (e.key.toLowerCase() === 'x' && activePopup === popup) {\n      clearParagraphInput(paragraphInput, nodeData, popup);\n      e.preventDefault();\n    }\n  };\n}\n\n// 清除段落輸入\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "clearParagraphInput"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 223,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 69,
      "x": 1645.6399917892552,
      "y": -2591.43194024711,
      "colorIndex": 0,
      "title": "handleCopyText",
      "content": "function handleCopyText() {\n}\n\n// 暫時更新按鈕文本\ntry {\n    navigator.clipboard.writeText(text)\n      .then(() => {\n        updateButtonTextTemporarily(copyBtn, '已複製!');\n      })\n      .catch(err => {\n        console.error('複製失敗:', err);\n        updateButtonTextTemporarily(copyBtn, '複製失敗');\n      });\n  } catch (err) {\n    console.error('複製失敗:', err);\n    updateButtonTextTemporarily(copyBtn, '複製失敗');\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "updateButtonTextTemporarily"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 401,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 70,
      "x": 2776.599991789257,
      "y": -2444.125576610747,
      "colorIndex": 0,
      "title": "showUpdateDialog",
      "content": "function showUpdateDialog() {\n// 創建對話框元素\n  const dialog = document.createElement('div');\n  dialog.className = 'update-dialog';\n  \n  // 對話框內容\n  dialog.innerHTML = `\n    <div class=\"update-dialog-content\">\n      <textarea id=\"update-dialog-textarea\">${escapeHtml(currentContent)}</textarea>\n      <div class=\"update-dialog-buttons\">\n        <button class=\"update-dialog-cancel\">取消</button>\n        <button class=\"update-dialog-confirm\">確認</button>\n      </div>\n    </div>\n  `;\n  \n  // 添加到body\n  document.body.appendChild(dialog);\n  \n  // 獲取元素引用\n  const textarea = dialog.querySelector('#update-dialog-textarea');\n  const cancelBtn = dialog.querySelector('.update-dialog-cancel');\n  const confirmBtn = dialog.querySelector('.update-dialog-confirm');\n  \n  // 聚焦到textarea\n  textarea.focus();\n  \n  // 取消按鈕點擊事件\n  cancelBtn.addEventListener('click', () => {\n    document.body.removeChild(dialog);\n    callback(null);\n  });\n  \n  // 確認按鈕點擊事件\n  confirmBtn.addEventListener('click', () => {\n    const newContent = textarea.value.trim();\n    document.body.removeChild(dialog);\n    callback(newContent);\n  });\n  \n  // 按ESC鍵關閉對話框\n  dialog.addEventListener('keydown', (e) => {\n    if (e.key === 'Escape') {\n      document.body.removeChild(dialog);\n      callback(null);\n    }\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "escapeHtml"
      ],
      "variableStates": [
        {
          "name": "dialog",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "cancelBtn",
          "active": false
        },
        {
          "name": "confirmBtn",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "dialog",
          "active": false
        },
        {
          "name": "dialog",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "cancelBtn",
          "active": false
        },
        {
          "name": "confirmBtn",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "dialog",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "cancelBtn",
          "active": false
        },
        {
          "name": "confirmBtn",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "cancelBtn",
          "active": false
        },
        {
          "name": "dialog",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "cancelBtn",
          "active": false
        },
        {
          "name": "confirmBtn",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "confirmBtn",
          "active": false
        },
        {
          "name": "dialog",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "cancelBtn",
          "active": false
        },
        {
          "name": "confirmBtn",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1269,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 71,
      "x": 2772.198851789258,
      "y": -2005.7252666107458,
      "colorIndex": 0,
      "title": "updateNodeContent",
      "content": "function updateNodeContent() {\nconst element = nodeData.element;\n  \n  // 1. 更新內容顯示\n  const popup = element.querySelector('.paragraph-popup');\n  const btn = element.querySelector('.paragraph-btn');\n  popup.textContent = newContent;\n  btn.textContent = newContent.length > 50 \n    ? newContent.substring(0, 47) + '...' \n    : newContent;\n  btn.dataset.originalContent = newContent;\n\n  // 2. 提取函數信息\n  const newFunctionName = extractFunctionName(newContent);\n  if (newFunctionName) {\n    element.querySelector('.node-title').value = newFunctionName;\n    updateSameNameHighlights();\n  }\n\n  // 3. 獲取新舊函數列表\n  const newCalledFunctions = extractCalledFunctions(newContent, newFunctionName);\n  const oldItems = Array.from(element.querySelectorAll('.item-text')).map(item => item.value);\n\n  // 4. 建立精確連接映射表（使用位置+名稱作為鍵）\n  const connectionMap = new Map();\n  connections.forEach(conn => {\n    if (conn.fromNode === nodeData.id) {\n      const itemName = oldItems[conn.fromOutput];\n      connectionMap.set(`${conn.fromOutput}_${itemName}`, {\n        toNode: conn.toNode,\n        toInput: conn.toInput\n      });\n    }\n  });\n\n  // 5. 完全清除舊連接\n  connections = connections.filter(conn => conn.fromNode !== nodeData.id);\n\n  // 6. 重建項目列表\n  const itemsContainer = element.querySelector('.items');\n  itemsContainer.innerHTML = '';\n  nodeData.outputs = [];\n\n  // 7. 智能重建項目和連接\n  newCalledFunctions.forEach((newFunc, newIndex) => {\n    // 創建新項目\n    const itemDiv = document.createElement('div');\n    itemDiv.className = 'item';\n    itemDiv.innerHTML = `\n      <span class=\"drag-handle\">☰</span>\n      <input type=\"text\" class=\"item-text\" value=\"${escapeHtml(newFunc)}\">\n      <button class=\"add-node-btn\">+</button>\n      <div class=\"output-port\" data-type=\"output\"></div>\n    `;\n    itemsContainer.appendChild(itemDiv);\n    nodeData.outputs.push(newIndex);\n\n    // 設置交互\n    setupAddNodeButton(itemDiv, nodeData, newIndex, container);\n    setupOutputPort(itemDiv, nodeData, newIndex, container);\n    setupItemDragAndDrop(element, nodeData);\n\n    // 恢復連接的智能邏輯\n    let connectionRestored = false;\n    \n    // 情況1：完全匹配原位置和名稱\n    const exactKey = `${newIndex}_${newFunc}`;\n    if (connectionMap.has(exactKey)) {\n      const { toNode, toInput } = connectionMap.get(exactKey);\n      connections.push({\n        fromNode: nodeData.id,\n        fromOutput: newIndex,\n        toNode,\n        toInput\n      });\n      connectionRestored = true;\n    }\n    \n    // 情況2：名稱匹配但位置變化（防止因插入新項目導致錯誤連接）\n    if (!connectionRestored) {\n      for (const [key, connData] of connectionMap) {\n        const [oldIndex, oldFunc] = key.split('_');\n        if (oldFunc === newFunc) {\n          // 確保這是第一個匹配的且未被使用的連接\n          if (!connections.some(c => \n            c.fromNode === nodeData.id && \n            c.toNode === connData.toNode &&\n            c.toInput === connData.toInput\n          )) {\n            connections.push({\n              fromNode: nodeData.id,\n              fromOutput: newIndex,\n              toNode: connData.toNode,\n              toInput: connData.toInput\n            });\n            connectionMap.delete(key); // 防止重複使用\n            break;\n          }\n        }\n      }\n    }\n  });\n\n  // 8. 更新變數分析按鈕\n  analyzeVariables(nodeData);\n\n  // 9. 最終處理\n  drawConnections();\n  showStatusMessage('內容已更新，連接精確保持', 'success');\n}\n\n// 初始化畫布大小\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "extractFunctionName",
        "updateSameNameHighlights",
        "extractCalledFunctions",
        "escapeHtml",
        "setupAddNodeButton",
        "setupOutputPort",
        "setupItemDragAndDrop",
        "analyzeVariables",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "element",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "newFunctionName",
          "active": false
        },
        {
          "name": "newCalledFunctions",
          "active": false
        },
        {
          "name": "oldItems",
          "active": false
        },
        {
          "name": "connectionMap",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "connectionRestored",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        },
        {
          "name": "exactKey",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3293,
        "lastUpdated": "2025-06-30T14:42:45.405Z"
      }
    },
    {
      "id": 72,
      "x": 2025.5978317892568,
      "y": -1851.830892974384,
      "colorIndex": 0,
      "title": "arrangePopups",
      "content": "function arrangePopups() {\nconst popups = Array.from(ALL_ACTIVE_POPUPS);\n  if (popups.length === 0) return;\n\n  const screenWidth = window.innerWidth;\n  const screenHeight = window.innerHeight;\n  const margin = 10;\n\n  // 统一尺寸配置\n  const uniformSize = {\n  small: { width: Math.min(350, screenWidth * 0.4), height: Math.min(250, screenHeight * 0.35) },\n  medium: { width: Math.min(400, screenWidth * 0.5), height: Math.min(300, screenHeight * 0.45) }\n  };\n\n\n  // 在CSS樣式中添加高亮樣式\nconst style = document.createElement('style');\nstyle.textContent = `\n.node.highlight-found {\n  box-shadow: 0 0 15px 5px rgba(0, 255, 255, 0.7) !important;\n  transition: box-shadow 0.3s;\n}\n`;\ndocument.head.appendChild(style);\n\n  // 1. 设置弹窗尺寸\n  popups.forEach((popup, index) => {\n    if (index >= 5) { // 第6个开始\n    popup.style.width = `${uniformSize.small.width}px`;\n    popup.style.height = `${uniformSize.small.height}px`;\n    } else if (index >= 3) { // 第4-5个\n    popup.style.width = `${uniformSize.medium.width}px`;\n    popup.style.height = `${uniformSize.medium.height}px`;\n    } else { // 前3个\n    popup.style.maxWidth = `${screenWidth * 0.8}px`;\n    popup.style.maxHeight = `${screenHeight * 0.8}px`;\n      popup.style.width = '';\n      popup.style.height = '';\n    }\n    popup.style.display = 'block';\n  });\n\n  // 2. 处理1-3个弹窗（宽度自适应）\n  if (popups.length <= 3) {\n    const firstThree = popups.slice(0, 3);\n    adjustWidths(firstThree, margin, screenWidth);\n    arrangeGridLayout(firstThree, margin, screenWidth, screenHeight);\n    return;\n  }\n\n  // 排列前3个（带宽度自适应）\n  const firstThree = popups.slice(0, 3);\n  adjustWidths(firstThree, margin, screenWidth);\n  arrangeGridLayout(firstThree, margin, screenWidth, screenHeight);\n\n  // 3. 处理第4-5个弹窗（新增高度居中逻辑）\n  if (popups.length >= 4) {\n    // 计算各列高度\n    const colHeights = firstThree.map(popup =>\n    parseFloat(popup.style.top) + popup.getBoundingClientRect().height\n    );\n\n    // 找出最短和中间高度的列\n    const sortedIndices = [...colHeights]\n  .map((h, i) => ({h, i}))\n    .sort((a, b) => a.h - b.h)\n    .map(obj => obj.i);\n\n    const shortestCol = sortedIndices[0];\n    const middleCol = sortedIndices[1];\n\n    // 放置第4个在最短列下方\n    const fourthPopup = popups[3];\n    const fourthRect = fourthPopup.getBoundingClientRect();\n    let fourthY = colHeights[shortestCol] + margin;\n\n    // 放置第5个在中间高度列下方\n    const fifthPopup = popups.length >= 5 ? popups[4] : null;\n    const fifthRect = fifthPopup?.getBoundingClientRect();\n    let fifthY = colHeights[middleCol] + margin;\n\n    // 计算整体高度\n    const totalHeight = Math.max(\n    fourthY + fourthRect.height,\n    fifthY + (fifthRect?.height || 0)\n    );\n\n    // 尝试垂直居中\n    const centerOffset = Math.max(0, (screenHeight - totalHeight) / 2);\n\n    if (centerOffset > 0) {\n      // 有足够空间居中\n      firstThree.forEach(popup => {\n      popup.style.top = `${parseFloat(popup.style.top) + centerOffset}px`;\n      });\n\n    fourthPopup.style.left = `${parseFloat(firstThree[shortestCol].style.left)}px`;\n    fourthPopup.style.top = `${fourthY + centerOffset}px`;\n\n      if (fifthPopup) {\n      fifthPopup.style.left = `${parseFloat(firstThree[middleCol].style.left)}px`;\n      fifthPopup.style.top = `${fifthY + centerOffset}px`;\n      }\n    } else {\n      // 需要缩放高度\n      const scaleFactor = screenHeight / totalHeight;\n\n      // 调整前3个高度\n      firstThree.forEach(popup => {\n        const rect = popup.getBoundingClientRect();\n      popup.style.height = `${rect.height * scaleFactor * 0.9}px`; // 保留10%边距\n      });\n\n      // 重新计算位置\n      arrangeGridLayout(firstThree, margin, screenWidth, screenHeight);\n      const newColHeights = firstThree.map(popup =>\n      parseFloat(popup.style.top) + popup.getBoundingClientRect().height\n      );\n\n      // 重新放置第4-5个\n    fourthPopup.style.left = `${parseFloat(firstThree[shortestCol].style.left)}px`;\n    fourthPopup.style.top = `${newColHeights[shortestCol] + margin}px`;\n\n      if (fifthPopup) {\n      fifthPopup.style.left = `${parseFloat(firstThree[middleCol].style.left)}px`;\n      fifthPopup.style.top = `${newColHeights[middleCol] + margin}px`;\n      }\n    }\n  }\n\n  // 4. 处理第6+个弹窗（左上角网格排列）\n  if (popups.length >= 6) {\n    let currentX = margin;\n    let currentY = margin;\n    let rowHeight = 0;\n\n    for (let i = 5; i < popups.length; i++) {\n      const popup = popups[i];\n      const rect = popup.getBoundingClientRect();\n\n      // 换行检查\n      if (currentX + rect.width > screenWidth) {\n        currentX = margin;\n        currentY += rowHeight + margin;\n        rowHeight = 0;\n      }\n\n      // 设置位置\n    popup.style.left = `${currentX}px`;\n    popup.style.top = `${currentY}px`;\n\n      // 更新参数\n      currentX += rect.width + margin;\n      rowHeight = Math.max(rowHeight, rect.height);\n\n      // 超出屏幕底部处理\n      if (currentY + rect.height > screenHeight) {\n        currentX = margin;\n        currentY = margin;\n      }\n    }\n  }\n}\n\n// 宽度自适应辅助函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "adjustWidths",
        "arrangeGridLayout"
      ],
      "variableStates": [
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popups",
          "active": false
        },
        {
          "name": "screenWidth",
          "active": false
        },
        {
          "name": "screenHeight",
          "active": false
        },
        {
          "name": "margin",
          "active": false
        },
        {
          "name": "uniformSize",
          "active": false
        },
        {
          "name": "style",
          "active": false
        },
        {
          "name": "firstThree",
          "active": false
        },
        {
          "name": "colHeights",
          "active": false
        },
        {
          "name": "sortedIndices",
          "active": false
        },
        {
          "name": "shortestCol",
          "active": false
        },
        {
          "name": "middleCol",
          "active": false
        },
        {
          "name": "fourthPopup",
          "active": false
        },
        {
          "name": "fourthRect",
          "active": false
        },
        {
          "name": "fourthY",
          "active": false
        },
        {
          "name": "fifthPopup",
          "active": false
        },
        {
          "name": "fifthRect",
          "active": false
        },
        {
          "name": "fifthY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "centerOffset",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "newColHeights",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeight",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 4833,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 73,
      "x": 1515.3324317892577,
      "y": -2172.7981293380217,
      "colorIndex": 0,
      "title": "closeAllPopups",
      "content": "function closeAllPopups() {\nALL_ACTIVE_POPUPS.forEach(p => {\n    p.style.display = 'none';\n    restoreOriginalPosition(p, originalParent, originalNextSibling, originalStyles);\n    if (p.parentNode) {\n      p.parentNode.removeChild(p);\n    }\n  });\n  ALL_ACTIVE_POPUPS.clear();\n  activePopup = null;\n  \n  // 清理nodeData中的popupContainer\n  if (nodeData.popupContainer) {\n    nodeData.popupContainer.remove();\n    nodeData.popupContainer = null;\n  }\n}\n\n// 恢復原始位置\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 458,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 74,
      "x": 1529.4621317892559,
      "y": -1822.7551657016566,
      "colorIndex": 0,
      "title": "clearParagraphInput",
      "content": "function clearParagraphInput() {\nparagraphInput.value = '';\n  resetItemsList(nodeData);\n  popup.style.display = 'none';\n  ALL_ACTIVE_POPUPS.delete(popup);\n  activePopup = null;\n}\n\n// 設置彈出框清理\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "resetItemsList"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 192,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 75,
      "x": 1902.8536281528911,
      "y": -2574.229212974383,
      "colorIndex": 0,
      "title": "updateButtonTextTemporarily",
      "content": "function updateButtonTextTemporarily() {\nbutton.textContent = text;\n  setTimeout(() => {\n    button.textContent = '';\n  }, 2000);\n}\n\n// 設置UPDATE按鈕事件\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 150,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 76,
      "x": 3108.9090826983465,
      "y": -2337.0983038834756,
      "colorIndex": 0,
      "title": "escapeHtml",
      "content": "function escapeHtml() {\nreturn unsafe\n  .replace(/&/g, \"&amp;\")\n  .replace(/</g, \"&lt;\")\n  .replace(/>/g, \"&gt;\")\n  .replace(/\"/g, \"&quot;\")\n  .replace(/'/g, \"&#039;\");\n}\n\n// 显示状态消息函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 185,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 77,
      "x": 3232.2291736074385,
      "y": -1887.7595766107463,
      "colorIndex": 0,
      "title": "extractFunctionName",
      "content": "function extractFunctionName() {\nconst functionNameMatch = content.match(/function\\s+([a-zA-Z_$][0-9a-zA-Z_$]*)/);\n  return functionNameMatch ? functionNameMatch[1] : null;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "functionNameMatch",
          "active": false
        },
        {
          "name": "functionNameMatch",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 176,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 78,
      "x": 3231.2291736074385,
      "y": -1838.1232129743828,
      "colorIndex": 0,
      "title": "updateSameNameHighlights",
      "content": "function updateSameNameHighlights() {\n// 先移除所有高亮\n  document.querySelectorAll('.node').forEach(node => {\n    node.classList.remove('highlight-same-name');\n  });\n\n  // 建立節點名稱映射\nconst nameMap = {};\n  nodes.forEach(node => {\n    const title = node.element.querySelector('.node-title').value;\n    if (!nameMap[title]) {\n      nameMap[title] = [];\n    }\n    nameMap[title].push(node);\n  });\n\n  // 為有相同名稱的節點添加高亮\n  Object.entries(nameMap).forEach(([title, sameNameNodes]) => {\n    if (sameNameNodes.length > 1) {\n      sameNameNodes.forEach(node => {\n        node.element.classList.add('highlight-same-name');\n      });\n    }\n  });\n}\n\n\n\n// 设置段落输入\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "nameMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "title",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 640,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 79,
      "x": 3234.2291736074385,
      "y": -1786.4868493380193,
      "colorIndex": 0,
      "title": "extractCalledFunctions",
      "content": "function extractCalledFunctions() {\nconst functionCallRegex = /([a-zA-Z_$][0-9a-zA-Z_$]*)\\s*\\([^)]*\\)/g;\n  const functionNames = new Set();\n  let match;\n\n  while ((match = functionCallRegex.exec(content)) !== null) {\n    const calledFunctionName = match[1];\n    // 檢查是否在黑名單中或是要排除的函數名\n    if (!FUNCTION_BLACKLIST.includes(calledFunctionName) &&\n    calledFunctionName !== functionNameToExclude) {\n      functionNames.add(calledFunctionName);\n    }\n  }\n\n  return Array.from(functionNames);\n}\n// HTML转义辅助函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        },
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "functionCallRegex",
          "active": false
        },
        {
          "name": "functionNames",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        },
        {
          "name": "calledFunctionName",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 505,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 80,
      "x": 3230.329173607439,
      "y": -1738.7504857016559,
      "colorIndex": 0,
      "title": "escapeHtml",
      "content": "function escapeHtml() {\nreturn unsafe\n  .replace(/&/g, \"&amp;\")\n  .replace(/</g, \"&lt;\")\n  .replace(/>/g, \"&gt;\")\n  .replace(/\"/g, \"&quot;\")\n  .replace(/'/g, \"&#039;\");\n}\n\n// 显示状态消息函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 185,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 81,
      "x": 3230.929173607439,
      "y": -1698.4232129743827,
      "colorIndex": 0,
      "title": "setupAddNodeButton",
      "content": "function setupAddNodeButton() {\nitemElement.querySelector('.add-node-btn').addEventListener('click', (e) => {\n    const name = itemElement.querySelector('.item-text').value;\n\n    const childNodes = connections.filter(conn =>\n    conn.fromNode === nodeData.id &&\n    conn.fromOutput === outputIndex\n    ).length;\n\n    const baseX = nodeData.x + 200 / scale;\n    const baseY = nodeData.y + (childNodes * 120 / scale);\n\n    const newNode = createNode(\n    baseX,\n    baseY,\n    name + ' 節點'\n    );\n\n    connections.push( {\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      toNode: newNode.id\n    });\n    drawConnections();\n    e.stopPropagation();\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 670,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 82,
      "x": 3230.929173607439,
      "y": -1656.1959402471105,
      "colorIndex": 0,
      "title": "setupOutputPort",
      "content": "function setupOutputPort() {\nportElement.addEventListener('mousedown', (e) => {\n    if (spacePressed || e.button === 1) return;\n\n    // 獲取實際顯示的端口（可能是原始端口或header中的端口）\n    const visiblePort = portElement.style.display !== 'none' ? portElement : \n      nodeData.element.querySelector(`.header-port:nth-child(${outputIndex + 4})`);\n    \n    const rect = visiblePort.getBoundingClientRect();\n    connecting = {\n      startX: rect.left + rect.width / 2,\n      startY: rect.top + rect.height / 2,\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      currentX: rect.left + rect.width / 2,\n      currentY: rect.top + rect.height / 2\n    };\n    container.classList.add('connecting');\n    e.stopPropagation();\n  });\n}\n\n// 修改節點位置更新函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 736,
        "lastUpdated": "2025-06-30T14:42:45.406Z"
      }
    },
    {
      "id": 83,
      "x": 3226.9564463347115,
      "y": -1093.9141220652925,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.407Z"
      }
    },
    {
      "id": 84,
      "x": 1722.9621317892545,
      "y": -1817.7551657016566,
      "colorIndex": 0,
      "title": "resetItemsList",
      "content": "function resetItemsList() {\nconst itemsContainer = nodeData.element.querySelector('.items');\n  itemsContainer.innerHTML = `\n    <div class=\"item\">\n      <span class=\"drag-handle\">☰</span>\n      <input type=\"text\" class=\"item-text\" value=\"\">\n      <button class=\"add-node-btn\">+</button>\n      <div class=\"output-port\" data-type=\"output\"></div>\n    </div>\n  `;\n\n  nodeData.outputs = [0];\n  const newItem = itemsContainer.querySelector('.item');\n  setupAddNodeButton(newItem, nodeData, 0, container);\n  setupOutputPort(newItem, nodeData, 0, container);\n  setupItemDragAndDrop(nodeData.element, nodeData); // 新增這行\n\n  // 恢復輸入框（如果被替換）\n  const containerDiv = nodeData.element.querySelector('.paragraph-container');\n  if (containerDiv) {\n    const textarea = document.createElement('textarea');\n    textarea.className = 'paragraph-input';\n    textarea.placeholder = '貼上段落內容...';\n    containerDiv.replaceWith(textarea);\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": true,
      "items": [
        "setupAddNodeButton",
        "setupOutputPort",
        "setupItemDragAndDrop"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "containerDiv",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        },
        {
          "name": "textarea",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 919,
        "lastUpdated": "2025-06-30T14:42:45.407Z"
      }
    },
    {
      "id": 85,
      "x": 61.38875781900833,
      "y": -190.42164391900866,
      "colorIndex": 0,
      "title": "importSelectedNodes",
      "content": "function importSelectedNodes() {\nconst file = event.target.files[0];\n  if (!file) return;\n\n  const reader = new FileReader();\n  reader.onload = (e) => {\n    \n  };\n\n  reader.readAsText(file);\n  event.target.value = '';\n}\ntry {\n      const importData = JSON.parse(e.target.result);\n      \n      if (!importData.nodes || !Array.isArray(importData.nodes)) {\n        throw new Error('無效的導入文件格式');\n      }\n\n      // 計算導入位置偏移量（當前視圖中心）\n      const centerX = toWorldX(window.innerWidth / 2);\n      const centerY = toWorldY(window.innerHeight / 2);\n      \n      // 計算原始節點群的中心點\n      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n      importData.nodes.forEach(node => {\n        minX = Math.min(minX, node.x);\n        minY = Math.min(minY, node.y);\n        maxX = Math.max(maxX, node.x);\n        maxY = Math.max(maxY, node.y);\n      });\n      const originalCenterX = (minX + maxX) / 2;\n      const originalCenterY = (minY + maxY) / 2;\n      \n      // 計算偏移量\n      const offsetX = centerX - originalCenterX;\n      const offsetY = centerY - originalCenterY;\n\n      // 創建ID映射表（舊ID -> 新ID）\n      const idMap = {};\n      let maxId = Math.max(...nodes.map(n => n.id), -1) + 1;\n\n      // 先創建所有普通節點\n      importData.nodes.forEach(nodeData => {\n        if (nodeData.isGroupNode) return; // 群組節點稍後處理\n        \n        const newNode = createNode(\n          nodeData.x + offsetX,\n          nodeData.y + offsetY,\n          nodeData.title || '節點'\n        );\n        \n        // 記錄ID映射\n        idMap[nodeData.id] = newNode.id;\n        \n        // 設置節點屬性\n        if (nodeData.colorIndex !== undefined) {\n          changeNodeColor(newNode, nodeData.colorIndex);\n        }\n        \n        if (nodeData.description) {\n          nodeDescriptions[newNode.id] = nodeData.description;\n        }\n\n        // 恢復段落內容\n        setupNodeContent(newNode, nodeData);\n      });\n\n      // 處理群組節點\n      importData.nodes.forEach(nodeData => {\n        if (!nodeData.isGroupNode) return;\n        \n        // 創建群組節點\n        const groupNode = createNode(\n          nodeData.x + offsetX,\n          nodeData.y + offsetY,\n          nodeData.title || '群組節點',\n          'group'\n        );\n        \n        // 記錄ID映射\n        idMap[nodeData.id] = groupNode.id;\n        \n        // 設置群組節點屬性\n        if (nodeData.colorIndex !== undefined) {\n          changeNodeColor(groupNode, nodeData.colorIndex);\n        }\n        \n        // 設置包含的節點\n        if (Array.isArray(nodeData.containedNodes)) {\n          groupNode.containedNodes = nodeData.containedNodes.map(id => idMap[id]);\n          \n          // 隱藏被包含的節點\n          groupNode.containedNodes.forEach(nodeId => {\n            if (nodes[nodeId]) {\n              nodes[nodeId].element.style.display = 'none';\n            }\n          });\n        }\n        \n        // 更新群組節點信息\n        updateGroupNodeInfo(groupNode);\n      });\n\n      // 導入連接（僅包含內部連接）\n      if (Array.isArray(importData.connections)) {\n        importData.connections.forEach(conn => {\n          if (idMap[conn.fromNode] !== undefined && idMap[conn.toNode] !== undefined) {\n            connections.push({\n              fromNode: idMap[conn.fromNode],\n              fromOutput: conn.fromOutput || 0,\n              toNode: idMap[conn.toNode]\n            });\n          }\n        });\n      }\n\n      drawConnections();\n      updateNodeList();\n      showStatusMessage(`已導入 ${importData.nodes.length} 個節點`, 'success');\n    } catch (error) {\n      console.error('導入失敗:', error);\n      showStatusMessage('導入失敗，請檢查文件格式', 'error');\n    }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "toWorldX",
        "toWorldY",
        "createNode",
        "changeNodeColor",
        "setupNodeContent",
        "updateGroupNodeInfo",
        "drawConnections",
        "updateNodeList"
      ],
      "variableStates": [
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "file",
          "active": false
        },
        {
          "name": "reader",
          "active": false
        },
        {
          "name": "importData",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "originalCenterX",
          "active": false
        },
        {
          "name": "originalCenterY",
          "active": false
        },
        {
          "name": "offsetX",
          "active": false
        },
        {
          "name": "offsetY",
          "active": false
        },
        {
          "name": "idMap",
          "active": false
        },
        {
          "name": "maxId",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        },
        {
          "name": "groupNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3507,
        "lastUpdated": "2025-06-30T14:42:45.407Z"
      }
    },
    {
      "id": 86,
      "x": 512.7094916454553,
      "y": -322.2303128033063,
      "colorIndex": 0,
      "title": "toWorldX",
      "content": "function toWorldX() {\nreturn (screenX / scale) + translateX;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 64,
        "lastUpdated": "2025-06-30T14:42:45.407Z"
      }
    },
    {
      "id": 87,
      "x": 516.9731280090916,
      "y": -276.0348582578519,
      "colorIndex": 0,
      "title": "toWorldY",
      "content": "function toWorldY() {\nreturn (screenY / scale) + translateY;\n}\n\n// 新增：屏幕坐标与世界坐标转换函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 85,
        "lastUpdated": "2025-06-30T14:42:45.407Z"
      }
    },
    {
      "id": 88,
      "x": 504.245855281819,
      "y": -170.40882520000036,
      "colorIndex": 0,
      "title": "changeNodeColor",
      "content": "function changeNodeColor() {\n// 移除所有顏色類\n  nodeData.element.classList.remove(...COLOR_CLASSES);\n  \n  // 添加新顏色類\n  const newColorClass = COLOR_CLASSES[colorIndex % COLOR_CLASSES.length];\n  nodeData.element.classList.add(newColorClass);\n  \n  // 更新節點數據\n  nodeData.colorIndex = colorIndex;\n  \n  // 更新彈出框顏色（如果存在）\n  const popup = nodeData.element.querySelector('.paragraph-popup');\n  if (popup) {\n    popup.classList.remove(...COLOR_CLASSES);\n    popup.classList.add(newColorClass);\n  }\n  \n  // 更新彈出框容器顏色（如果存在）\n  if (nodeData.popupContainer) {\n    const popupInContainer = nodeData.popupContainer.querySelector('.paragraph-popup');\n    if (popupInContainer) {\n      popupInContainer.classList.remove(...COLOR_CLASSES);\n      popupInContainer.classList.add(newColorClass);\n    }\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "newColorClass",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "popupInContainer",
          "active": false
        },
        {
          "name": "newColorClass",
          "active": false
        },
        {
          "name": "newColorClass",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "popupInContainer",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "newColorClass",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "popupInContainer",
          "active": false
        },
        {
          "name": "popupInContainer",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 777,
        "lastUpdated": "2025-06-30T14:42:45.407Z"
      }
    },
    {
      "id": 89,
      "x": 499.5549461909094,
      "y": 474.4469599239681,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.407Z"
      }
    },
    {
      "id": 90,
      "x": 499.5549461909094,
      "y": 522.4333235603307,
      "colorIndex": 0,
      "title": "updateNodeList",
      "content": "function updateNodeList() {\nconst nodeList = document.getElementById('node-list');\n  if (!nodeList) return;\n  \n  requestAnimationFrame(() => {\n    const visibleNodes = getVisibleNodes();\n    const visibleNodeIds = visibleNodes.map(n => n.id).join(',');\n    const lastVisibleNodeIds = (lastVisibleNodes || []).map(n => n.id).join(',');\n    \n    if (visibleNodeIds === lastVisibleNodeIds) return;\n    \n    saveCurrentDescriptions();\n    \n    // 建立節點名稱到描述的映射\n    const nameToDescriptionMap = {};\n    nodes.forEach(node => {\n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      if (nodeDescriptions[node.id] && nodeDescriptions[node.id].trim() !== '') {\n        // 如果這個節點有描述，記錄到映射中\n        nameToDescriptionMap[title] = nodeDescriptions[node.id];\n      }\n    });\n    \n    const fragment = document.createDocumentFragment();\n    \n    visibleNodes.forEach(node => {\n      const nodeElement = document.createElement('div');\n      nodeElement.className = 'node-list-item';\n      \n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      \n      // 檢查是否有相同名稱的節點已經有描述\n      let description = nodeDescriptions[node.id] || '';\n      if (!description.trim() && nameToDescriptionMap[title]) {\n        // 如果當前節點沒有描述，但相同名稱的節點有描述，則使用該描述\n        description = nameToDescriptionMap[title];\n        nodeDescriptions[node.id] = description; // 更新節點描述資料\n      }\n      \n      nodeElement.innerHTML = `\n        <div class=\"node-list-name\">${escapeHtml(title)}</div>\n        <textarea class=\"node-list-description\" data-node-id=\"${node.id}\" \n          placeholder=\"輸入節點描述...\">${escapeHtml(description)}</textarea>\n      `;\n      \n      const descInput = nodeElement.querySelector('.node-list-description');\n      descInput.addEventListener('input', () => {\n        const newDescription = descInput.value;\n        nodeDescriptions[descInput.dataset.nodeId] = newDescription;\n        \n        // 當描述變更時，更新所有同名節點的描述\n        if (newDescription.trim() !== '') {\n          const currentTitle = node.element.querySelector('.node-title')?.value || '未命名節點';\n          nodes.forEach(n => {\n            const nTitle = n.element.querySelector('.node-title')?.value || '未命名節點';\n            if (nTitle === currentTitle && n.id !== node.id) {\n              nodeDescriptions[n.id] = newDescription;\n            }\n          });\n           syncDescriptionsForSameNameNodes(descInput.dataset.nodeId);\n          // 觸發重新渲染節點列表\n          updateNodeList();\n        }\n      });\n      \n      fragment.appendChild(nodeElement);\n    });\n    \n    nodeList.innerHTML = '';\n    nodeList.appendChild(fragment);\n    lastVisibleNodes = visibleNodes;\n  });\n}\n\n// 優化的檢查函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "getVisibleNodes",
        "saveCurrentDescriptions",
        "escapeHtml",
        "syncDescriptionsForSameNameNodes"
      ],
      "variableStates": [
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2676,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 91,
      "x": 82.52240000000006,
      "y": 678.3053000000014,
      "colorIndex": 0,
      "title": "searchNodesByName",
      "content": "function searchNodesByName() {\nconst searchTerm = document.getElementById('node-search-input').value.trim().toLowerCase();\n  if (!searchTerm) return;\n\n  // 清除之前的高亮\n  nodes.forEach(node => {\n    node.element.classList.remove('highlight-found');\n  });\n\n  // 找到匹配的節點\n  const matchedNodes = nodes.filter(node => {\n    const titleElement = node.element.querySelector('.node-title');\n    return titleElement &&\n           (titleElement.value || titleElement.textContent || titleElement.innerText)\n           .toLowerCase()\n           .includes(searchTerm);\n  });\n\n  if (matchedNodes.length > 0) {\n    const targetNode = matchedNodes[0];\n    targetNode.element.classList.add('highlight-found');\n\n    // 獲取節點中心在螢幕座標\n    const nodeRect = targetNode.element.getBoundingClientRect();\n    const nodeCenterX = nodeRect.left + nodeRect.width / 2;\n    const nodeCenterY = nodeRect.top + nodeRect.height / 2;\n\n    // 轉換為世界座標\n    const targetWorldX = (nodeCenterX - translateX) / scale;\n    const targetWorldY = (nodeCenterY - translateY) / scale;\n\n    // 取消正在進行的動畫\n    if (animationFrameId) {\n      cancelAnimationFrame(animationFrameId);\n      animationFrameId = null;\n    }\n\n    // 平滑移動到目標位置\n    smoothMoveTo(targetWorldX, targetWorldY, scale, 800);\n  } else {\n    alert('未找到匹配的節點標題');\n  }\n}\n\n\n\n// 新增：獲取節點標題中心的世界座標（修正版）\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "smoothMoveTo"
      ],
      "variableStates": [
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "searchTerm",
          "active": false
        },
        {
          "name": "matchedNodes",
          "active": false
        },
        {
          "name": "titleElement",
          "active": false
        },
        {
          "name": "targetNode",
          "active": false
        },
        {
          "name": "nodeRect",
          "active": false
        },
        {
          "name": "nodeCenterX",
          "active": false
        },
        {
          "name": "nodeCenterY",
          "active": false
        },
        {
          "name": "targetWorldX",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        },
        {
          "name": "targetWorldY",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1307,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 92,
      "x": 398.2224,
      "y": 667.3053000000014,
      "colorIndex": 0,
      "title": "smoothMoveTo",
      "content": "function smoothMoveTo() {\nconst startTime = performance.now();\n  const startX = translateX;\n  const startY = translateY;\n  const startScale = scale;\n\n  // 計算目標平移值，使世界座標點位於視圖中心\n  const targetTranslateX = (window.innerWidth / 2) - (targetWorldX * targetScale);\n  const targetTranslateY = (window.innerHeight / 2) - (targetWorldY * targetScale);\n\n  function animate(currentTime) {\n    const elapsed = currentTime - startTime;\n    const progress = Math.min(elapsed / duration, 1);\n    const easeProgress = easeInOutCubic(progress);\n\n    // 插值平移和縮放\n    translateX = startX + (targetTranslateX - startX) * easeProgress;\n    translateY = startY + (targetTranslateY - startY) * easeProgress;\n    scale = startScale + (targetScale - startScale) * easeProgress;\n\n    applyTransform();\n\n    if (progress < 1) {\n      animationFrameId = requestAnimationFrame(animate);\n    } else {\n      // 確保最終位置精確\n      translateX = targetTranslateX + left-panel.width;\n      translateY = targetTranslateY;\n      scale = targetScale;\n      applyTransform();\n\n      // 添加高亮動畫\n      const title = document.querySelector('.node.highlight-found .node-title');\n      if (title) {\n        title.classList.add('title-highlight');\n        setTimeout(() => title.classList.remove('title-highlight'), 1000);\n      }\n\n      // 清除動畫 ID\n      animationFrameId = null;\n    }\n  }\n\n  animationFrameId = requestAnimationFrame(animate);\n}\n\n\n\n// 緩動函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "animate",
        "easeInOutCubic",
        "applyTransform"
      ],
      "variableStates": [
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "title",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1407,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 93,
      "x": 794.4085818181819,
      "y": 672.6403000000008,
      "colorIndex": 0,
      "title": "animate",
      "content": "function animate(currentTime) {\n    const elapsed = currentTime - startTime;\n    const progress = Math.min(elapsed / duration, 1);\n    const easeProgress = easeInOutCubic(progress);\n\n    // 插值平移和縮放\n    translateX = startX + (targetTranslateX - startX) * easeProgress;\n    translateY = startY + (targetTranslateY - startY) * easeProgress;\n    scale = startScale + (targetScale - startScale) * easeProgress;\n\n    applyTransform();\n\n    if (progress < 1) {\n      animationFrameId = requestAnimationFrame(animate);\n    } else {\n      // 確保最終位置精確\n      translateX = targetTranslateX + left-panel.width;\n      translateY = targetTranslateY;\n      scale = targetScale;\n      applyTransform();\n\n      // 添加高亮動畫\n      const title = document.querySelector('.node.highlight-found .node-title');\n      if (title) {\n        title.classList.add('title-highlight');\n        setTimeout(() => title.classList.remove('title-highlight'), 1000);\n      }\n\n      // 清除動畫 ID\n      animationFrameId = null;\n    }\n  }",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "easeInOutCubic",
        "applyTransform"
      ],
      "variableStates": [
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "title",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 992,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 94,
      "x": 791.6730446280994,
      "y": 931.382448760333,
      "colorIndex": 0,
      "title": "easeInOutCubic",
      "content": "function easeInOutCubic() {\nreturn t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;\n}\n// 高亮顯示找到的節點\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 110,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 95,
      "x": 783.4085818181819,
      "y": 1141.7130272727304,
      "colorIndex": 0,
      "title": "applyTransform",
      "content": "function applyTransform() {\nconsole.log('Applying transform:', {\n    translateX,\n    translateY,\n    scale,\n    screenCenterX: (window.innerWidth / 2 - translateX) / scale,\n    screenCenterY: (window.innerHeight / 2 - translateY) / scale\n  });\n  \n  transformContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  nodesContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  drawConnections();\n  updateNodeList();\n\n  updateMinimap();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections",
        "updateNodeList",
        "updateMinimap"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 535,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 96,
      "x": 1027.408581818182,
      "y": 676.6403000000008,
      "colorIndex": 0,
      "title": "easeInOutCubic",
      "content": "function easeInOutCubic() {\nreturn t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;\n}\n// 高亮顯示找到的節點\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 110,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 97,
      "x": 1027.408581818182,
      "y": 719.6403000000008,
      "colorIndex": 0,
      "title": "applyTransform",
      "content": "function applyTransform() {\nconsole.log('Applying transform:', {\n    translateX,\n    translateY,\n    scale,\n    screenCenterX: (window.innerWidth / 2 - translateX) / scale,\n    screenCenterY: (window.innerHeight / 2 - translateY) / scale\n  });\n  \n  transformContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  nodesContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  drawConnections();\n  updateNodeList();\n\n  updateMinimap();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections",
        "updateNodeList",
        "updateMinimap"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 535,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 98,
      "x": 18.0518909090913,
      "y": 1218.8196181818203,
      "colorIndex": 0,
      "title": "debugVisibleArea",
      "content": "function debugVisibleArea() {\nconst visibleNodes = getVisibleNodes();\n  console.log('=== 可見區域調試信息 ===');\n  \n  // 1. 打印視口信息\n  const screenLeft = document.getElementById('left-panel')?.offsetWidth || 0;\n  console.log('屏幕坐標可見區域:', {\n    left: screenLeft,\n    right: window.innerWidth,\n    top: 0,\n    bottom: window.innerHeight\n  });\n  \n  // 2. 打印世界坐標可見區域\n  console.log('世界坐標可見區域:', {\n    left: toWorldX(screenLeft),\n    right: toWorldX(window.innerWidth),\n    top: toWorldY(0),\n    bottom: toWorldY(window.innerHeight)\n  });\n  \n  // 3. 打印節點狀態\n  nodes.forEach(node => {\n    const isVisible = visibleNodes.includes(node);\n    const screenX = toScreenX(node.x);\n    const screenY = toScreenY(node.y);\n    \n    console.log(`節點 ${node.id}:`, {\n      世界坐標: { x: node.x, y: node.y },\n      屏幕坐標: { x: screenX, y: screenY },\n      尺寸: { \n        world: { w: node.element.offsetWidth / scale, h: node.element.offsetHeight / scale },\n        screen: { w: node.element.offsetWidth, h: node.element.offsetHeight }\n      },\n      可見: isVisible,\n      完全在視口內: (\n        screenX >= screenLeft &&\n        screenX <= window.innerWidth &&\n        screenY >= 0 &&\n        screenY <= window.innerHeight\n      )\n    });\n  });\n\n\n  console.log('Final position check:', {\n  targetWorldX, targetWorldY,\n  screenX: (targetWorldX - translateX) * scale,\n  screenY: (targetWorldY - translateY) * scale,\n  viewCenter: { x: window.innerWidth/2, y: window.innerHeight/2 }\n});\n\nconsole.log('Moving to:', {\n  nodeId: targetNode.id,\n  nodePos: { x: targetNode.x, y: targetNode.y },\n  titleCenter: titleCenter,\n  startTransform: { translateX, translateY, scale },\n  targetTransform: { targetTranslateX, targetTranslateY, targetScale }\n});\n\nconsole.log('Node position debug:', {\n  nodeRect: nodeRect,\n  nodeCenter: { x: nodeCenterX, y: nodeCenterY },\n  worldCoords: { x: targetWorldX, y: targetWorldY },\n  targetTranslate: { x: targetTranslateX, y: targetTranslateY },\n  currentTransform: { translateX, translateY, scale }\n});\n}\n// 輔助函數：獲取節點高度\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "getVisibleNodes",
        "toWorldX",
        "toWorldY",
        "toScreenX",
        "toScreenY"
      ],
      "variableStates": [
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "screenLeft",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "screenX",
          "active": false
        },
        {
          "name": "screenY",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "screenLeft",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "screenX",
          "active": false
        },
        {
          "name": "screenY",
          "active": false
        },
        {
          "name": "screenLeft",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "screenLeft",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "screenX",
          "active": false
        },
        {
          "name": "screenY",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "screenLeft",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "screenX",
          "active": false
        },
        {
          "name": "screenY",
          "active": false
        },
        {
          "name": "screenX",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "screenLeft",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "screenX",
          "active": false
        },
        {
          "name": "screenY",
          "active": false
        },
        {
          "name": "screenY",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2006,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 99,
      "x": 412.7518909090911,
      "y": 1227.6196181818186,
      "colorIndex": 0,
      "title": "getVisibleNodes",
      "content": "function getVisibleNodes() {\n// 1. 獲取視口可見區域（不考慮左側面板，使用整個視窗）\n  const viewport = {\n    left: 0,\n    right: window.innerWidth,\n    top: 0,\n    bottom: window.innerHeight\n  };\n\n  return nodes.filter(node => {\n    // 2. 直接使用getBoundingClientRect獲取屏幕座標\n    const rect = node.element.getBoundingClientRect();\n    \n    // 3. 檢查節點是否在視口內（完全精確判斷）\n    const isVisible = (\n      rect.right > viewport.left &&\n      rect.left < viewport.right &&\n      rect.bottom > viewport.top &&\n      rect.top < viewport.bottom\n    );\n\n    // 4. 控制名稱顯示（直接基於屏幕座標判斷）\n    const nameElement = node.element.querySelector('.node-name');\n    if (nameElement) {\n      nameElement.style.display = isVisible ? 'block' : 'none';\n    }\n\n    // 5. 返回節點是否在緩衝區內（用於渲染優化）\n    const buffer = -200; // 屏幕像素緩衝\n    const inBufferArea = (\n      rect.right > (viewport.left - buffer) &&\n      rect.left < (viewport.right + buffer) &&\n      rect.bottom > (viewport.top - buffer) &&\n      rect.top < (viewport.bottom + buffer)\n    );\n\n    return inBufferArea;\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "viewport",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "isVisible",
          "active": false
        },
        {
          "name": "nameElement",
          "active": false
        },
        {
          "name": "buffer",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        },
        {
          "name": "inBufferArea",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1017,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 100,
      "x": 409.45189090909093,
      "y": 1272.3196181818194,
      "colorIndex": 0,
      "title": "toWorldX",
      "content": "function toWorldX() {\nreturn (screenX / scale) + translateX;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 64,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 101,
      "x": 410.55189090909084,
      "y": 1319.2196181818194,
      "colorIndex": 0,
      "title": "toWorldY",
      "content": "function toWorldY() {\nreturn (screenY / scale) + translateY;\n}\n\n// 新增：屏幕坐标与世界坐标转换函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 85,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 102,
      "x": 409.45189090909093,
      "y": 1366.119618181819,
      "colorIndex": 0,
      "title": "toScreenX",
      "content": "function toScreenX() {\nreturn worldX * scale + translateX;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 62,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 103,
      "x": 408.351890909091,
      "y": 1579.11961818182,
      "colorIndex": 0,
      "title": "toScreenY",
      "content": "function toScreenY() {\nreturn worldY * scale + translateY;\n}\n\n// 提取到外部的工具函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 77,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 104,
      "x": 1457.2817038008184,
      "y": 240.2048868604536,
      "colorIndex": 3,
      "title": "addEventListener",
      "content": "",
      "description": "",
      "isConvertedToButton": false,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "document.addEventListener('keydown', (e) ",
        "document.addEventListener('keyup', (e)",
        "container.addEventListener('click', (e)",
        "container.addEventListener('mousedown', (e)",
        "document.addEventListener('mouseup', (e)",
        " document.addEventListener('mousemove', (e)",
        "container.addEventListener('wheel', (e) => {"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 0,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 105,
      "x": 2279.601703800819,
      "y": 70.56215958772441,
      "colorIndex": 2,
      "title": "document.addEventListener('keydown', (e)",
      "content": "document.addEventListener('keydown', (e) => {\n    // 檢查是否正在輸入框中輸入內容\n    const isInputting = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable;\n\n  if (e.key.toLowerCase() === 'g' && selectedNodes.size > 1) {\n    createGroupNodeFromSelection();\n    e.preventDefault();\n  }\n    // 處理 'z' 鍵：切換選中節點的顏色\n    if (e.key.toLowerCase() === 'z' && selectedNodes.size > 0 && !isInputting) {\n        toggleNodeColors();\n        e.preventDefault();\n    }\n\n    // 處理 'd' 鍵：斷開選中節點與父節點的連接\n    if (e.key.toLowerCase() === 'd' && selectedNodes.size === 1 && !isInputting) {\n        const nodeId = selectedNodes.values().next().value;\n        disconnectNodeFromParent(nodeId);\n        e.preventDefault();\n    }\n\n    // 處理 'q' 鍵：複製選中節點內容\n    if (e.key.toLowerCase() === 'q' && selectedNodes.size > 0) {\n        copySelectedNodesContent();\n        e.preventDefault();\n    }\n\n    // 處理 'space' 鍵：設置抓取光標\n    if (e.code === 'Space') {\n        spacePressed = true;\n        container.style.cursor = 'grab';\n    }\n\n    // 處理 'shift' 鍵：設置 shiftPressed 狀態\n    if (e.key === 'Shift') {\n        shiftPressed = true;\n    }\n\n    // 處理 'a' 鍵：選取子節點\n    if (e.key.toLowerCase() === 'a' && selectedNodes.size === 1) {\n        const firstSelectedId = selectedNodes.values().next().value;\n        const prevCount = selectedNodes.size;\n        selectNodeAndChildren(firstSelectedId);\n        const addedCount = selectedNodes.size - prevCount;\n        showStatusMessage(`已選取 ${addedCount} 個子節點`, 'success');\n        e.preventDefault();\n    }\n\n    // 處理 'e' 鍵：在視圖中心創建節點\n    if (e.key.toLowerCase() === 'e' && !isInputting) {\n        const centerX = window.innerWidth / 2;\n        const centerY = window.innerHeight / 2;\n        const worldX = toWorldX(centerX);\n        const worldY = toWorldY(centerY);\n        createNode(worldX, worldY);\n        e.preventDefault();\n    }\n\n    // 處理彈出框滾動\n    if (!activePopup) return;\n\n    const scrollStep = 20; // 每次滾動的像素數\n    switch (e.key.toLowerCase()) {\n        case 'w':\n            popupScrollPosition = Math.max(0, popupScrollPosition - scrollStep);\n            updatePopupScroll();\n            e.preventDefault();\n            break;\n        case 's':\n            const maxScroll = activePopup.scrollHeight - activePopup.clientHeight;\n            popupScrollPosition = Math.min(maxScroll, popupScrollPosition + scrollStep);\n            updatePopupScroll();\n            e.preventDefault();\n            break;\n    }\n});",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "createGroupNodeFromSelection",
        "toggleNodeColors",
        "disconnectNodeFromParent",
        "copySelectedNodesContent",
        "selectNodeAndChildren",
        "toWorldX",
        "toWorldY",
        "createNode",
        "updatePopupScroll"
      ],
      "variableStates": [
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2461,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 106,
      "x": 3006.429976528092,
      "y": 751.7597959513616,
      "colorIndex": 0,
      "title": "toggleNodeColors",
      "content": "function toggleNodeColors() {\nselectedNodes.forEach(nodeId => {\n        const node = nodes[nodeId];\n        if (node) {\n            const nodeElement = node.element;\n            const popup = nodeElement.querySelector('.paragraph-popup');\n            \n            // 使用節點自己的 colorIndex 或默認使用 currentColorIndex\n            const nodeColorIndex = node.colorIndex !== undefined ? node.colorIndex : currentColorIndex;\n            \n            // 計算下一個顏色索引\n            const nextColorIndex = (nodeColorIndex + 1) % COLOR_CLASSES.length;\n            \n            // 移除所有顏色類\n            COLOR_CLASSES.forEach(cls => {\n                nodeElement.classList.remove(cls);\n                if (popup) popup.classList.remove(cls);\n            });\n            \n            // 添加新顏色類\n            const isTransparent = nodeElement.classList.contains('transparent');\n            const colorClass = isTransparent ? \n                `transparent ${COLOR_CLASSES[nextColorIndex]}` : \n                COLOR_CLASSES[nextColorIndex];\n            \n            nodeElement.className = nodeElement.className.split(' ')\n                .filter(c => !COLOR_CLASSES.includes(c) && c !== 'transparent')\n                .join(' ') + ' ' + colorClass;\n            \n            // 更新彈出框顏色\n            if (popup) {\n                popup.className = popup.className.split(' ')\n                    .filter(c => !COLOR_CLASSES.includes(c))\n                    .join(' ') + ' ' + COLOR_CLASSES[nextColorIndex];\n            }\n            \n            // 更新節點的顏色索引\n            node.colorIndex = nextColorIndex;\n        }\n    });\n    \n    // 更新全局 currentColorIndex 以便新選中的節點使用\n    currentColorIndex = (currentColorIndex + 1) % COLOR_CLASSES.length;\n    \n    showStatusMessage(`已切換到下一個顏色`, 'success');\n}\n\n// Create GROUP-NODE element\n// 創建群組節點元素\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1804,
        "lastUpdated": "2025-06-30T14:42:45.408Z"
      }
    },
    {
      "id": 107,
      "x": 3564.716158346274,
      "y": -603.5762040486394,
      "colorIndex": 0,
      "title": "disconnectNodeFromParent",
      "content": "function disconnectNodeFromParent() {\n// 找出所有指向該節點的連接（父節點到該節點的連接）\n    const parentConnections = connections.filter(conn => conn.toNode === nodeId);\n    \n    if (parentConnections.length === 0) {\n        showStatusMessage('該節點沒有父節點連接', 'warning');\n        return;\n    }\n    \n    // 移除這些連接\n    connections = connections.filter(conn => conn.toNode !== nodeId);\n    \n    // 重新繪製連接線\n    drawConnections();\n    \n    showStatusMessage(`已斷開 ${parentConnections.length} 個父節點連接`, 'success');\n}\n\n  // 鍵盤控制\ndocument.addEventListener('keydown', (e) => {\n    // 檢查是否正在輸入框中輸入內容\n    const isInputting = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable;\n\n  if (e.key.toLowerCase() === 'g' && selectedNodes.size > 1) {\n    createGroupNodeFromSelection();\n    e.preventDefault();\n  }\n    // 處理 'z' 鍵：切換選中節點的顏色\n    if (e.key.toLowerCase() === 'z' && selectedNodes.size > 0 && !isInputting) {\n        toggleNodeColors();\n        e.preventDefault();\n    }\n\n    // 處理 'd' 鍵：斷開選中節點與父節點的連接\n    if (e.key.toLowerCase() === 'd' && selectedNodes.size === 1 && !isInputting) {\n        const nodeId = selectedNodes.values().next().value;\n        disconnectNodeFromParent(nodeId);\n        e.preventDefault();\n    }\n\n    // 處理 'q' 鍵：複製選中節點內容\n    if (e.key.toLowerCase() === 'q' && selectedNodes.size > 0) {\n        copySelectedNodesContent();\n        e.preventDefault();\n    }\n\n    // 處理 'space' 鍵：設置抓取光標\n    if (e.code === 'Space') {\n        spacePressed = true;\n        container.style.cursor = 'grab';\n    }\n\n    // 處理 'shift' 鍵：設置 shiftPressed 狀態\n    if (e.key === 'Shift') {\n        shiftPressed = true;\n    }\n\n    // 處理 'a' 鍵：選取子節點\n    if (e.key.toLowerCase() === 'a' && selectedNodes.size === 1) {\n        const firstSelectedId = selectedNodes.values().next().value;\n        const prevCount = selectedNodes.size;\n        selectNodeAndChildren(firstSelectedId);\n        const addedCount = selectedNodes.size - prevCount;\n        showStatusMessage(`已選取 ${addedCount} 個子節點`, 'success');\n        e.preventDefault();\n    }\n\n    // 處理 'e' 鍵：在視圖中心創建節點\n    if (e.key.toLowerCase() === 'e' && !isInputting) {\n        const centerX = window.innerWidth / 2;\n        const centerY = window.innerHeight / 2;\n        const worldX = toWorldX(centerX);\n        const worldY = toWorldY(centerY);\n        createNode(worldX, worldY);\n        e.preventDefault();\n    }\n\n    // 處理彈出框滾動\n    if (!activePopup) return;\n\n    const scrollStep = 20; // 每次滾動的像素數\n    switch (e.key.toLowerCase()) {\n        case 'w':\n            popupScrollPosition = Math.max(0, popupScrollPosition - scrollStep);\n            updatePopupScroll();\n            e.preventDefault();\n            break;\n        case 's':\n            const maxScroll = activePopup.scrollHeight - activePopup.clientHeight;\n            popupScrollPosition = Math.min(maxScroll, popupScrollPosition + scrollStep);\n            updatePopupScroll();\n            e.preventDefault();\n            break;\n    }\n});\n\n\n\n\ndocument.addEventListener('keyup', (e) => {\n    if (e.code === 'Space') {\n        spacePressed = false;\n        if (!isPanning) {\n            container.style.cursor = '';\n        }\n    } else if (e.key === 'Shift') {\n        shiftPressed = false;\n    }\n});\n  // 点击空白处取消选择\n  container.addEventListener('click', (e) => {\n    if (e.target === container && selectedNodes.size > 0) {\n      clearSelection();\n    }\n  });\n\n  // 辅助函数：通过元素查找节点\n  function findNodeByElement(element) {\n    return nodes.find(node => node.element === element);\n  }\n\n  // 滾輪縮放\ncontainer.addEventListener('wheel', (e) => {\n  e.preventDefault();\n\n  // 獲取鼠標位置相對於視口的坐標\n  const mouseX = e.clientX;\n  const mouseY = e.clientY;\n\n  // 計算縮放前的世界坐標\n  const worldX = (mouseX - translateX) / scale;\n  const worldY = (mouseY - translateY) / scale;\n\n  // 計算新的縮放比例（保持原有方向邏輯）\n  const delta = -e.deltaY;\n  const newScale = delta > 0 ? scale * 1.1 : scale / 1.1;\n  scale = Math.min(Math.max(0.1, newScale), 3);\n\n  // 計算新的平移值 - 保持鼠標下的點在相同位置\n  translateX = mouseX - worldX * scale;\n  translateY = mouseY - worldY * scale;\n\n  // 應用變換\n  applyTransform();\n});\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "drawConnections",
        "createGroupNodeFromSelection",
        "toggleNodeColors",
        "copySelectedNodesContent",
        "selectNodeAndChildren",
        "toWorldX",
        "toWorldY",
        "createNode",
        "updatePopupScroll",
        "clearSelection",
        "findNodeByElement",
        "applyTransform"
      ],
      "variableStates": [
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "parentConnections",
          "active": false
        },
        {
          "name": "isInputting",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "firstSelectedId",
          "active": false
        },
        {
          "name": "prevCount",
          "active": false
        },
        {
          "name": "addedCount",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "scrollStep",
          "active": false
        },
        {
          "name": "maxScroll",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 4068,
        "lastUpdated": "2025-06-30T14:42:45.409Z"
      }
    },
    {
      "id": 108,
      "x": 3979.9881583462748,
      "y": -541.6062040486386,
      "colorIndex": 0,
      "title": "copySelectedNodesContent",
      "content": "function copySelectedNodesContent() {\nlet allContent = '';\n  \n  selectedNodes.forEach(nodeId => {\n    const node = nodes[nodeId];\n    if (node) {\n      const popup = node.element.querySelector('.paragraph-popup');\n      const input = node.element.querySelector('.paragraph-input');\n      \n      if (popup) {\n        allContent += popup.textContent + '\\n\\n';\n      } else if (input) {\n        allContent += input.value + '\\n\\n';\n      }\n    }\n  });\n  \nif (allContent) {\n  const lineCount = allContent.split('\\n').filter(line => line.trim() !== '').length;\n  navigator.clipboard.writeText(allContent.trim())\n    .then(() => {\n      showStatusMessage(`已複製 ${selectedNodes.size} 個節點的內容 (共 ${lineCount} 行)`, 'success');\n    })\n    .catch(err => {\n      console.error('複製失敗:', err);\n      showStatusMessage('複製失敗', 'error');\n    });\n} else {\n  showStatusMessage('沒有可複製的內容', 'warning');\n}\n}\n\n\n// 初始化視圖位置\ntranslateX = window.innerWidth / 2 - 100;\ntranslateY = window.innerHeight / 2 - 50;\nnodesContainer.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;\n\n  // 初始化一個節點時使用世界坐標系\n  //createNode(-100, -50); // 這會使節點出現在屏幕中心\n\n\n\n  // 更新鼠标事件处理\n  container.addEventListener('mousedown', (e) => {\n    if (e.button === 0 && !spacePressed && !draggingNode) { // 左键点击\n      const target = e.target;\n      const isNode = target.closest('.node');\n\n      if (!isNode) {\n        // 开始框选\n        isSelecting = true;\n        container.classList.add('selecting');\n        selectionStartX = e.clientX;\n        selectionStartY = e.clientY;\n\n        if (!selectionBox) {\n          createSelectionBox();\n        }\n        updateSelectionBox(selectionStartX, selectionStartY, e.clientX, e.clientY);\n        e.preventDefault();\n      } else if (selectedNodes.size > 0) {\n        // 如果已经有选中的节点，检查点击的是否是其中之一\n        const clickedNode = findNodeByElement(target.closest('.node'));\n        if (clickedNode && selectedNodes.has(clickedNode.id)) {\n          // 开始拖动所有选中的节点\n          draggingNode = clickedNode;\n          dragStartWorldX = toWorldX(e.clientX);\n          dragStartWorldY = toWorldY(e.clientY);\n          dragOffsetX = dragStartWorldX - clickedNode.x;\n          dragOffsetY = dragStartWorldY - clickedNode.y;\n        } else {\n          clearSelection();\n        }\n      }\n    } else if (spacePressed || e.button === 1) { // 空格或中键\n      isPanning = true;\n      panStartX = e.clientX - translateX;\n      panStartY = e.clientY - translateY;\n      container.classList.add('panning');\n      e.preventDefault();\n    }\n  });\n\ndocument.addEventListener('mouseup', (e) => {\n    if (isSelecting) {\n        const selectionRect = {\n            left: Math.min(selectionStartX, e.clientX),\n            right: Math.max(selectionStartX, e.clientX),\n            top: Math.min(selectionStartY, e.clientY),\n            bottom: Math.max(selectionStartY, e.clientY)\n        };\n\n        // 檢查是否有實際的選擇範圍（避免點擊誤觸發）\n        if (selectionRect.right - selectionRect.left > 5 || \n            selectionRect.bottom - selectionRect.top > 5) {\n            \n            // 根據 SHIFT 鍵狀態決定是替換選擇還是增減選擇\n            if (!shiftPressed) {\n                clearSelection();\n            }\n            \n            selectNodesInBox(selectionRect, shiftPressed);\n        }\n        \n        isSelecting = false;\n        container.classList.remove('selecting');\n        if (selectionBox) {\n            selectionBox.style.display = 'none';\n        }\n    }\n\n    draggingNode = null;\n    connecting = null;\n    isPanning = false;\n    container.classList.remove('panning');\n    container.classList.remove('connecting');\n    drawConnections();\n});\n\n  // 替换mousemove事件中的拖拽部分\n  document.addEventListener('mousemove', (e) => {\n    if (isSelecting) {\n      updateSelectionBox(selectionStartX, selectionStartY, e.clientX, e.clientY);\n    } else if (isPanning) {\n      translateX = e.clientX - panStartX;\n      translateY = e.clientY - panStartY;\n      applyTransform();\n      drawConnections();\n    } else if (draggingNode) {\n      const currentWorldX = toWorldX(e.clientX);\n      const currentWorldY = toWorldY(e.clientY);\n\n      const deltaX = currentWorldX - dragStartWorldX;\n      const deltaY = currentWorldY - dragStartWorldY;\n\n      if (selectedNodes.size > 0) {\n        // 移动所有选中的节点\n        selectedNodes.forEach(id => {\n          const node = nodes[id];\n          if (node) {\n            node.x += deltaX;\n            node.y += deltaY;\n            updateNodePosition(node);\n          }\n        });\n      } else {\n        // 移动单个节点\n        draggingNode.x = currentWorldX - dragOffsetX;\n        draggingNode.y = currentWorldY - dragOffsetY;\n        updateNodePosition(draggingNode);\n      }\n\n      dragStartWorldX = currentWorldX;\n      dragStartWorldY = currentWorldY;\n      drawConnections();\n    } else if (connecting) {\n      connecting.currentX = e.clientX;\n      connecting.currentY = e.clientY;\n      drawConnections();\n    }\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "createNode",
        "createSelectionBox",
        "updateSelectionBox",
        "findNodeByElement",
        "toWorldX",
        "toWorldY",
        "clearSelection",
        "selectNodesInBox",
        "drawConnections",
        "applyTransform",
        "updateNodePosition"
      ],
      "variableStates": [
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 4895,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 109,
      "x": 3231.372158346275,
      "y": 836.4257959513627,
      "colorIndex": 0,
      "title": "selectNodeAndChildren",
      "content": "function selectNodeAndChildren() {\n// 選取當前節點\n    const node = nodes[nodeId];\n    if (!node) return;\n    \n    node.element.classList.add('selected');\n    selectedNodes.add(nodeId);\n    \n    // 找出所有直接子節點\n    const children = connections.filter(conn => conn.fromNode === nodeId)\n                               .map(conn => conn.toNode);\n    \n    // 遞歸選取子節點\n    children.forEach(childId => {\n        selectNodeAndChildren(childId);\n    });\n    \n    drawConnections();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "children",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "children",
          "active": false
        },
        {
          "name": "children",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 467,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 110,
      "x": 3458.390158346275,
      "y": 947.4007959513615,
      "colorIndex": 0,
      "title": "toWorldX",
      "content": "function toWorldX() {\nreturn (screenX / scale) + translateX;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 64,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 111,
      "x": 3461.390158346275,
      "y": 994.4007959513624,
      "colorIndex": 0,
      "title": "toWorldY",
      "content": "function toWorldY() {\nreturn (screenY / scale) + translateY;\n}\n\n// 新增：屏幕坐标与世界坐标转换函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 85,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 112,
      "x": 3463.208340164456,
      "y": 1033.6735232240876,
      "colorIndex": 0,
      "title": "createNode",
      "content": "function createNode() {\nif (type === 'group') {\n    const node = createGroupNodeElement(x, y, title);\n    const nodeData = initializeGroupNodeData(node, x, y);\n    setupGroupNodeEvents(node, nodeData);\n    return nodeData;\n  } else {\n    const node = createNodeElement(x, y, title);\n    const nodeData = initializeNodeData(node, x, y);\n    setupNodeDrag(node, nodeData);\n    setupCollapseButton(node, nodeData);\n    setupDeleteButton(node, nodeData);\n    setupTitleInput(node);\n    setupParagraphInput(node, nodeData);\n    setupInitialAddButton(node, nodeData);\n    setupAddItemButton(node, nodeData);\n    setupHideChildrenButton(node, nodeData);\n    setupGenerateButton(node, nodeData);\n    setupPortEvents(node, nodeData);\n    updateNodePosition(nodeData);\n      // 初始化變數分析框\n  setupVariableAnalysis(node, nodeData);\n    return nodeData;\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createGroupNodeElement",
        "initializeGroupNodeData",
        "setupGroupNodeEvents",
        "createNodeElement",
        "initializeNodeData",
        "setupNodeDrag",
        "setupCollapseButton",
        "setupDeleteButton",
        "setupTitleInput",
        "setupParagraphInput",
        "setupInitialAddButton",
        "setupAddItemButton",
        "setupHideChildrenButton",
        "setupGenerateButton",
        "setupPortEvents",
        "updateNodePosition",
        "setupVariableAnalysis"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 846,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 113,
      "x": 3463.3971583462744,
      "y": 1082.1717959513603,
      "colorIndex": 0,
      "title": "updatePopupScroll",
      "content": "function updatePopupScroll() {\nif (activePopup) {\n    activePopup.scrollTop = popupScrollPosition;\n  }\n}\n\n\n// 创建框选元素\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 118,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 114,
      "x": 2055.7598856190007,
      "y": 300.8785232240874,
      "colorIndex": 0,
      "title": "document.addEventListener('keyup', (e)",
      "content": "document.addEventListener('keyup', (e) => {\n    if (e.code === 'Space') {\n        spacePressed = false;\n        if (!isPanning) {\n            container.style.cursor = '';\n        }\n    } else if (e.key === 'Shift') {\n        shiftPressed = false;\n    }\n});",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 256,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 115,
      "x": 2020.1508856190012,
      "y": 879.0946868604508,
      "colorIndex": 0,
      "title": "container.addEventListener('click',",
      "content": "// 点击空白处取消选择\n  container.addEventListener('click', (e) => {\n    if (e.target === container && selectedNodes.size > 0) {\n      clearSelection();\n    }\n  });",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "clearSelection"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 155,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 116,
      "x": 2315.332703800819,
      "y": 885.0946868604508,
      "colorIndex": 0,
      "title": "clearSelection",
      "content": "function clearSelection() {\nselectedNodes.forEach(id => {\n    const node = nodes[id];\n    if (node && node.element) {\n      node.element.classList.remove('selected');\n    }\n  });\n  selectedNodes.clear();\n  if (selectionBox) {\n    selectionBox.style.display = 'none';\n  }\n}\n\n// 检查节点是否在选择框内\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 290,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 117,
      "x": 1959.0247038008188,
      "y": 1228.1396868604538,
      "colorIndex": 0,
      "title": "container.addEventListener('mousedown', (e)",
      "content": "// 更新鼠标事件处理\n  container.addEventListener('mousedown', (e) => {\n    if (e.button === 0 && !spacePressed && !draggingNode) { // 左键点击\n      const target = e.target;\n      const isNode = target.closest('.node');\n\n      if (!isNode) {\n        // 开始框选\n        isSelecting = true;\n        container.classList.add('selecting');\n        selectionStartX = e.clientX;\n        selectionStartY = e.clientY;\n\n        if (!selectionBox) {\n          createSelectionBox();\n        }\n        updateSelectionBox(selectionStartX, selectionStartY, e.clientX, e.clientY);\n        e.preventDefault();\n      } else if (selectedNodes.size > 0) {\n        // 如果已经有选中的节点，检查点击的是否是其中之一\n        const clickedNode = findNodeByElement(target.closest('.node'));\n        if (clickedNode && selectedNodes.has(clickedNode.id)) {\n          // 开始拖动所有选中的节点\n          draggingNode = clickedNode;\n          dragStartWorldX = toWorldX(e.clientX);\n          dragStartWorldY = toWorldY(e.clientY);\n          dragOffsetX = dragStartWorldX - clickedNode.x;\n          dragOffsetY = dragStartWorldY - clickedNode.y;\n        } else {\n          clearSelection();\n        }\n      }\n    } else if (spacePressed || e.button === 1) { // 空格或中键\n      isPanning = true;\n      panStartX = e.clientX - translateX;\n      panStartY = e.clientY - translateY;\n      container.classList.add('panning');\n      e.preventDefault();\n    }\n  });",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "createSelectionBox",
        "updateSelectionBox",
        "findNodeByElement",
        "toWorldX",
        "toWorldY",
        "clearSelection"
      ],
      "variableStates": [
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "target",
          "active": false
        },
        {
          "name": "isNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        },
        {
          "name": "clickedNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1375,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 118,
      "x": 2326.3447038008194,
      "y": 1179.0196868604576,
      "colorIndex": 0,
      "title": "createSelectionBox",
      "content": "function createSelectionBox() {\nselectionBox = document.createElement('div');\n  selectionBox.className = 'selection-box';\n  selectionBox.style.display = 'none';\n  document.body.appendChild(selectionBox);\n  return selectionBox;\n}\n\n// 更新框选区域\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 241,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 119,
      "x": 2563.6147038008203,
      "y": 1232.5196868604557,
      "colorIndex": 0,
      "title": "updateSelectionBox",
      "content": "function updateSelectionBox() {\nconst left = Math.min(x1, x2);\n  const top = Math.min(y1, y2);\n  const width = Math.abs(x2 - x1);\n  const height = Math.abs(y2 - y1);\n\nselectionBox.style.left = `${left}px`;\nselectionBox.style.top = `${top}px`;\nselectionBox.style.width = `${width}px`;\nselectionBox.style.height = `${height}px`;\n  selectionBox.style.display = 'block';\n}\n\n// 清除选择\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "height",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 379,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 120,
      "x": 2566.14470380082,
      "y": 1597.209686860459,
      "colorIndex": 0,
      "title": "findNodeByElement",
      "content": "function findNodeByElement() {\nreturn nodes.find(node => node.element === element);\n  }\n\n  // 滾輪縮放\ncontainer.addEventListener('wheel', (e) => {\n  e.preventDefault();\n\n  // 獲取鼠標位置相對於視口的坐標\n  const mouseX = e.clientX;\n  const mouseY = e.clientY;\n\n  // 計算縮放前的世界坐標\n  const worldX = (mouseX - translateX) / scale;\n  const worldY = (mouseY - translateY) / scale;\n\n  // 計算新的縮放比例（保持原有方向邏輯）\n  const delta = -e.deltaY;\n  const newScale = delta > 0 ? scale * 1.1 : scale / 1.1;\n  scale = Math.min(Math.max(0.1, newScale), 3);\n\n  // 計算新的平移值 - 保持鼠標下的點在相同位置\n  translateX = mouseX - worldX * scale;\n  translateY = mouseY - worldY * scale;\n\n  // 應用變換\n  applyTransform();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "applyTransform"
      ],
      "variableStates": [
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 655,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 121,
      "x": 2565.14470380082,
      "y": 1642.2096868604553,
      "colorIndex": 0,
      "title": "toWorldX",
      "content": "function toWorldX() {\nreturn (screenX / scale) + translateX;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 64,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 122,
      "x": 2564.72470380082,
      "y": 1686.8396868604545,
      "colorIndex": 0,
      "title": "toWorldY",
      "content": "function toWorldY() {\nreturn (screenY / scale) + translateY;\n}\n\n// 新增：屏幕坐标与世界坐标转换函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 85,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 123,
      "x": 2568.72470380082,
      "y": 1730.8396868604545,
      "colorIndex": 0,
      "title": "clearSelection",
      "content": "function clearSelection() {\nselectedNodes.forEach(id => {\n    const node = nodes[id];\n    if (node && node.element) {\n      node.element.classList.remove('selected');\n    }\n  });\n  selectedNodes.clear();\n  if (selectionBox) {\n    selectionBox.style.display = 'none';\n  }\n}\n\n// 检查节点是否在选择框内\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 290,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 124,
      "x": 1935.0897038008193,
      "y": 1848.6567777695454,
      "colorIndex": 0,
      "title": "document.addEventListener('mouseup', (e)",
      "content": "document.addEventListener('mouseup', (e) => {\n    if (isSelecting) {\n        const selectionRect = {\n            left: Math.min(selectionStartX, e.clientX),\n            right: Math.max(selectionStartX, e.clientX),\n            top: Math.min(selectionStartY, e.clientY),\n            bottom: Math.max(selectionStartY, e.clientY)\n        };\n\n        // 檢查是否有實際的選擇範圍（避免點擊誤觸發）\n        if (selectionRect.right - selectionRect.left > 5 || \n            selectionRect.bottom - selectionRect.top > 5) {\n            \n            // 根據 SHIFT 鍵狀態決定是替換選擇還是增減選擇\n            if (!shiftPressed) {\n                clearSelection();\n            }\n            \n            selectNodesInBox(selectionRect, shiftPressed);\n        }\n        \n        isSelecting = false;\n        container.classList.remove('selecting');\n        if (selectionBox) {\n            selectionBox.style.display = 'none';\n        }\n    }\n\n    draggingNode = null;\n    connecting = null;\n    isPanning = false;\n    container.classList.remove('panning');\n    container.classList.remove('connecting');\n    drawConnections();\n});",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "clearSelection",
        "selectNodesInBox",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "selectionRect",
          "active": false
        },
        {
          "name": "selectionRect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1076,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 125,
      "x": 1928.994703800819,
      "y": 2281.859886860449,
      "colorIndex": 0,
      "title": "document.addEventListener('mousemove', (e)",
      "content": "// 替换mousemove事件中的拖拽部分\n  document.addEventListener('mousemove', (e) => {\n    if (isSelecting) {\n      updateSelectionBox(selectionStartX, selectionStartY, e.clientX, e.clientY);\n    } else if (isPanning) {\n      translateX = e.clientX - panStartX;\n      translateY = e.clientY - panStartY;\n      applyTransform();\n      drawConnections();\n    } else if (draggingNode) {\n      const currentWorldX = toWorldX(e.clientX);\n      const currentWorldY = toWorldY(e.clientY);\n\n      const deltaX = currentWorldX - dragStartWorldX;\n      const deltaY = currentWorldY - dragStartWorldY;\n\n      if (selectedNodes.size > 0) {\n        // 移动所有选中的节点\n        selectedNodes.forEach(id => {\n          const node = nodes[id];\n          if (node) {\n            node.x += deltaX;\n            node.y += deltaY;\n            updateNodePosition(node);\n          }\n        });\n      } else {\n        // 移动单个节点\n        draggingNode.x = currentWorldX - dragOffsetX;\n        draggingNode.y = currentWorldY - dragOffsetY;\n        updateNodePosition(draggingNode);\n      }\n\n      dragStartWorldX = currentWorldX;\n      dragStartWorldY = currentWorldY;\n      drawConnections();\n    } else if (connecting) {\n      connecting.currentX = e.clientX;\n      connecting.currentY = e.clientY;\n      drawConnections();\n    }\n  });",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "updateSelectionBox",
        "applyTransform",
        "drawConnections",
        "toWorldX",
        "toWorldY",
        "updateNodePosition"
      ],
      "variableStates": [
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "currentWorldX",
          "active": false
        },
        {
          "name": "currentWorldY",
          "active": false
        },
        {
          "name": "deltaX",
          "active": false
        },
        {
          "name": "deltaY",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1289,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 126,
      "x": 2312.3897038008195,
      "y": 1873.0476868604521,
      "colorIndex": 0,
      "title": "clearSelection",
      "content": "function clearSelection() {\nselectedNodes.forEach(id => {\n    const node = nodes[id];\n    if (node && node.element) {\n      node.element.classList.remove('selected');\n    }\n  });\n  selectedNodes.clear();\n  if (selectionBox) {\n    selectionBox.style.display = 'none';\n  }\n}\n\n// 检查节点是否在选择框内\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 290,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 127,
      "x": 2313.4897038008194,
      "y": 1919.2476868604504,
      "colorIndex": 0,
      "title": "selectNodesInBox",
      "content": "function selectNodesInBox() {\n// 如果不是增減選擇模式，先清除選擇\n    if (!additiveSelection) {\n        clearSelection();\n    }\n\n    nodes.forEach(node => {\n        if (isNodeInSelection(node, selectionRect)) {\n            // 如果是增減選擇模式，切換選擇狀態\n            if (additiveSelection) {\n                if (selectedNodes.has(node.id)) {\n                    node.element.classList.remove('selected');\n                    selectedNodes.delete(node.id);\n                } else {\n                    node.element.classList.add('selected');\n                    selectedNodes.add(node.id);\n                }\n            } else {\n                // 普通模式，直接選擇\n                node.element.classList.add('selected');\n                selectedNodes.add(node.id);\n            }\n        }\n    });\n\n    return selectedNodes.size > 0;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "clearSelection"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 800,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 128,
      "x": 2310.4897038008194,
      "y": 2224.7476868604494,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 129,
      "x": 2148.9947038008195,
      "y": 2281.859886860449,
      "colorIndex": 0,
      "title": "updateSelectionBox",
      "content": "function updateSelectionBox() {\nconst left = Math.min(x1, x2);\n  const top = Math.min(y1, y2);\n  const width = Math.abs(x2 - x1);\n  const height = Math.abs(y2 - y1);\n\nselectionBox.style.left = `${left}px`;\nselectionBox.style.top = `${top}px`;\nselectionBox.style.width = `${width}px`;\nselectionBox.style.height = `${height}px`;\n  selectionBox.style.display = 'block';\n}\n\n// 清除选择\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "height",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 379,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 130,
      "x": 2148.9947038008195,
      "y": 2329.15988686045,
      "colorIndex": 0,
      "title": "applyTransform",
      "content": "function applyTransform() {\nconsole.log('Applying transform:', {\n    translateX,\n    translateY,\n    scale,\n    screenCenterX: (window.innerWidth / 2 - translateX) / scale,\n    screenCenterY: (window.innerHeight / 2 - translateY) / scale\n  });\n  \n  transformContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  nodesContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  drawConnections();\n  updateNodeList();\n\n  updateMinimap();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections",
        "updateNodeList",
        "updateMinimap"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 535,
        "lastUpdated": "2025-06-30T14:42:45.410Z"
      }
    },
    {
      "id": 131,
      "x": 2148.9947038008195,
      "y": 2376.4598868604485,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 132,
      "x": 2148.9947038008195,
      "y": 2423.7598868604478,
      "colorIndex": 0,
      "title": "toWorldX",
      "content": "function toWorldX() {\nreturn (screenX / scale) + translateX;\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 64,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 133,
      "x": 2148.9947038008195,
      "y": 2471.059886860449,
      "colorIndex": 0,
      "title": "toWorldY",
      "content": "function toWorldY() {\nreturn (screenY / scale) + translateY;\n}\n\n// 新增：屏幕坐标与世界坐标转换函数\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 85,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 134,
      "x": 2148.9947038008195,
      "y": 2518.359886860448,
      "colorIndex": 0,
      "title": "updateNodePosition",
      "content": "function updateNodePosition() {\nnode.element.style.left = `${node.x}px`;\nnode.element.style.top = `${node.y}px`;\n  node.element.style.transform = 'none'; // 確保節點不受容器縮放影響\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 173,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 135,
      "x": -78.53055049999989,
      "y": -1206.3780719000024,
      "colorIndex": 0,
      "title": "setupItemDragAndDrop",
      "content": "function setupItemDragAndDrop() {\nconst itemsContainer = node.querySelector('.items');\n  \n   itemsContainer.querySelectorAll('.drag-handle').forEach(handle => {\n    handle.addEventListener('mousedown', (e) => {\n      if (e.button !== 0) return;\n      \n      const item = e.target.closest('.item');\n      if (!item) return;\n      \n      e.preventDefault();\n      \n      // 初始化時確保所有端口都有原始索引\n      nodeData.element.querySelectorAll('.output-port').forEach(port => {\n        if (!port.dataset.originalIndex) {\n          port.dataset.originalIndex = port.dataset.outputIndex || \n            Array.from(itemsContainer.children).indexOf(port.closest('.item'));\n        }\n      });\n      \n      const items = Array.from(itemsContainer.children);\n      const originalIndex = items.indexOf(item);\n      \n      const dragState = {\n        startX: e.clientX,\n        startY: e.clientY,\n        item: item,\n        originalIndex: originalIndex,\n        currentIndex: originalIndex,\n        placeholder: createPlaceholder(item),\n        isDragging: false\n      };\n      \n      function onDragMove(e) {\n        if (!dragState.isDragging) {\n          const dx = e.clientX - dragState.startX;\n          const dy = e.clientY - dragState.startY;\n          if (Math.sqrt(dx*dx + dy*dy) < 5) return;\n          \n          dragState.isDragging = true;\n          item.classList.add('dragging');\n          item.style.position = 'absolute';\n          item.style.zIndex = '1000';\n          item.style.opacity = '0.8';\n          \n          itemsContainer.insertBefore(dragState.placeholder, item);\n        }\n        \n        item.style.left = (e.clientX - dragState.startX) + 'px';\n        item.style.top = (e.clientY - dragState.startY) + 'px';\n        \n        const items = Array.from(itemsContainer.children).filter(el => el !== dragState.placeholder);\n        const itemRect = item.getBoundingClientRect();\n        const itemCenterY = itemRect.top + itemRect.height / 2;\n        \n        for (let i = 0; i < items.length; i++) {\n          const otherItem = items[i];\n          if (otherItem === item) continue;\n          \n          const otherRect = otherItem.getBoundingClientRect();\n          const otherCenterY = otherRect.top + otherRect.height / 2;\n          \n          if (Math.abs(itemCenterY - otherCenterY) < otherRect.height / 2) {\n            const newIndex = i;\n            if (newIndex !== dragState.currentIndex) {\n              itemsContainer.insertBefore(\n                dragState.placeholder, \n                newIndex > dragState.currentIndex ? items[newIndex].nextSibling : items[newIndex]\n              );\n              dragState.currentIndex = newIndex;\n            }\n            break;\n          }\n        }\n      }\n      \n      function onDragEnd() {\n        document.removeEventListener('mousemove', onDragMove);\n        document.removeEventListener('mouseup', onDragEnd);\n        \n        if (dragState.isDragging) {\n          // 將項目放回新位置\n          itemsContainer.insertBefore(item, dragState.placeholder);\n          item.classList.remove('dragging');\n          item.style.position = '';\n          item.style.left = '';\n          item.style.top = '';\n          item.style.zIndex = '';\n          item.style.opacity = '';\n          \n          // 只有在位置改變時才更新連接\n          if (dragState.originalIndex !== dragState.currentIndex) {\n            updateConnectionsAfterDrag(nodeData, dragState.originalIndex, dragState.currentIndex);\n            \n            // 強制重繪所有連接\n            drawConnections();\n            \n            // 確保節點位置更新\n            updateNodePosition(nodeData);\n            \n            // 更新節點列表\n            updateNodeList();\n          }\n        }\n        \n        dragState.placeholder.remove();\n      }\n      \n      document.addEventListener('mousemove', onDragMove);\n      document.addEventListener('mouseup', onDragEnd);\n    });\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "createPlaceholder",
        "onDragMove",
        "onDragEnd",
        "updateConnectionsAfterDrag",
        "drawConnections",
        "updateNodePosition",
        "updateNodeList"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3856,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 136,
      "x": 317.65644949999864,
      "y": -1381.4720719000015,
      "colorIndex": 0,
      "title": "createPlaceholder",
      "content": "function createPlaceholder() {\nconst placeholder = document.createElement('div');\n  placeholder.className = 'item-placeholder';\n  placeholder.style.height = item.offsetHeight + 'px';\n  placeholder.style.margin = '5px 0';\n  placeholder.style.background = 'rgba(0,0,0,0.1)';\n  placeholder.style.borderRadius = '4px';\n  return placeholder;\n}\n\n\n// 更新連接索引\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "placeholder",
          "active": false
        },
        {
          "name": "placeholder",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 352,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 137,
      "x": 320.65644949999864,
      "y": -1112.472071900001,
      "colorIndex": 0,
      "title": "onDragMove",
      "content": "function onDragMove(e) {\n        if (!dragState.isDragging) {\n          const dx = e.clientX - dragState.startX;\n          const dy = e.clientY - dragState.startY;\n          if (Math.sqrt(dx*dx + dy*dy) < 5) return;\n          \n          dragState.isDragging = true;\n          item.classList.add('dragging');\n          item.style.position = 'absolute';\n          item.style.zIndex = '1000';\n          item.style.opacity = '0.8';\n          \n          itemsContainer.insertBefore(dragState.placeholder, item);\n        }\n        \n        item.style.left = (e.clientX - dragState.startX) + 'px';\n        item.style.top = (e.clientY - dragState.startY) + 'px';\n        \n        const items = Array.from(itemsContainer.children).filter(el => el !== dragState.placeholder);\n        const itemRect = item.getBoundingClientRect();\n        const itemCenterY = itemRect.top + itemRect.height / 2;\n        \n        for (let i = 0; i < items.length; i++) {\n          const otherItem = items[i];\n          if (otherItem === item) continue;\n          \n          const otherRect = otherItem.getBoundingClientRect();\n          const otherCenterY = otherRect.top + otherRect.height / 2;\n          \n          if (Math.abs(itemCenterY - otherCenterY) < otherRect.height / 2) {\n            const newIndex = i;\n            if (newIndex !== dragState.currentIndex) {\n              itemsContainer.insertBefore(\n                dragState.placeholder, \n                newIndex > dragState.currentIndex ? items[newIndex].nextSibling : items[newIndex]\n              );\n              dragState.currentIndex = newIndex;\n            }\n            break;\n          }\n        }\n      }",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1652,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 138,
      "x": 600.7564494999986,
      "y": -1281.7720719000017,
      "colorIndex": 0,
      "title": "onDragEnd",
      "content": "function onDragEnd() {\n        document.removeEventListener('mousemove', onDragMove);\n        document.removeEventListener('mouseup', onDragEnd);\n        \n        if (dragState.isDragging) {\n          // 將項目放回新位置\n          itemsContainer.insertBefore(item, dragState.placeholder);\n          item.classList.remove('dragging');\n          item.style.position = '';\n          item.style.left = '';\n          item.style.top = '';\n          item.style.zIndex = '';\n          item.style.opacity = '';\n          \n          // 只有在位置改變時才更新連接\n          if (dragState.originalIndex !== dragState.currentIndex) {\n            updateConnectionsAfterDrag(nodeData, dragState.originalIndex, dragState.currentIndex);\n            \n            // 強制重繪所有連接\n            drawConnections();\n            \n            // 確保節點位置更新\n            updateNodePosition(nodeData);\n            \n            // 更新節點列表\n            updateNodeList();\n          }\n        }\n        \n        dragState.placeholder.remove();\n      }",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "updateConnectionsAfterDrag",
        "drawConnections",
        "updateNodePosition",
        "updateNodeList"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 989,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 139,
      "x": 598.0355404090885,
      "y": -852.0529809909102,
      "colorIndex": 0,
      "title": "updateConnectionsAfterDrag",
      "content": "function updateConnectionsAfterDrag() {\n// 1. 獲取所有項目\n  const items = Array.from(nodeData.element.querySelectorAll('.item'));\n  \n  // 2. 建立完整的索引映射表\n  const indexMap = {};\n  items.forEach((item, newIdx) => {\n    const port = item.querySelector('.output-port');\n    const oldIdx = parseInt(port.dataset.originalIndex);\n    indexMap[oldIdx] = newIdx;\n    \n    // 更新端口索引屬性\n    port.dataset.outputIndex = newIdx;\n    port.dataset.originalIndex = newIdx;\n  });\n  \n  // 3. 更新節點數據\n  nodeData.outputs = Array(items.length).fill(0);\n  \n  // 4. 更新所有相關連接\n  connections.forEach(conn => {\n    if (conn.fromNode === nodeData.id && indexMap[conn.fromOutput] !== undefined) {\n      conn.fromOutput = indexMap[conn.fromOutput];\n    }\n  });\n  \n  // 5. 強制重繪\n  drawConnections();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "items",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 761,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 140,
      "x": 317.3169949545438,
      "y": -680.164526445456,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 141,
      "x": 315.3169949545438,
      "y": -639.1645264454557,
      "colorIndex": 0,
      "title": "updateNodePosition",
      "content": "function updateNodePosition() {\nnode.element.style.left = `${node.x}px`;\nnode.element.style.top = `${node.y}px`;\n  node.element.style.transform = 'none'; // 確保節點不受容器縮放影響\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 173,
        "lastUpdated": "2025-06-30T14:42:45.411Z"
      }
    },
    {
      "id": 142,
      "x": 313.49881313636183,
      "y": -593.2554355363645,
      "colorIndex": 0,
      "title": "updateNodeList",
      "content": "function updateNodeList() {\nconst nodeList = document.getElementById('node-list');\n  if (!nodeList) return;\n  \n  requestAnimationFrame(() => {\n    const visibleNodes = getVisibleNodes();\n    const visibleNodeIds = visibleNodes.map(n => n.id).join(',');\n    const lastVisibleNodeIds = (lastVisibleNodes || []).map(n => n.id).join(',');\n    \n    if (visibleNodeIds === lastVisibleNodeIds) return;\n    \n    saveCurrentDescriptions();\n    \n    // 建立節點名稱到描述的映射\n    const nameToDescriptionMap = {};\n    nodes.forEach(node => {\n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      if (nodeDescriptions[node.id] && nodeDescriptions[node.id].trim() !== '') {\n        // 如果這個節點有描述，記錄到映射中\n        nameToDescriptionMap[title] = nodeDescriptions[node.id];\n      }\n    });\n    \n    const fragment = document.createDocumentFragment();\n    \n    visibleNodes.forEach(node => {\n      const nodeElement = document.createElement('div');\n      nodeElement.className = 'node-list-item';\n      \n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      \n      // 檢查是否有相同名稱的節點已經有描述\n      let description = nodeDescriptions[node.id] || '';\n      if (!description.trim() && nameToDescriptionMap[title]) {\n        // 如果當前節點沒有描述，但相同名稱的節點有描述，則使用該描述\n        description = nameToDescriptionMap[title];\n        nodeDescriptions[node.id] = description; // 更新節點描述資料\n      }\n      \n      nodeElement.innerHTML = `\n        <div class=\"node-list-name\">${escapeHtml(title)}</div>\n        <textarea class=\"node-list-description\" data-node-id=\"${node.id}\" \n          placeholder=\"輸入節點描述...\">${escapeHtml(description)}</textarea>\n      `;\n      \n      const descInput = nodeElement.querySelector('.node-list-description');\n      descInput.addEventListener('input', () => {\n        const newDescription = descInput.value;\n        nodeDescriptions[descInput.dataset.nodeId] = newDescription;\n        \n        // 當描述變更時，更新所有同名節點的描述\n        if (newDescription.trim() !== '') {\n          const currentTitle = node.element.querySelector('.node-title')?.value || '未命名節點';\n          nodes.forEach(n => {\n            const nTitle = n.element.querySelector('.node-title')?.value || '未命名節點';\n            if (nTitle === currentTitle && n.id !== node.id) {\n              nodeDescriptions[n.id] = newDescription;\n            }\n          });\n           syncDescriptionsForSameNameNodes(descInput.dataset.nodeId);\n          // 觸發重新渲染節點列表\n          updateNodeList();\n        }\n      });\n      \n      fragment.appendChild(nodeElement);\n    });\n    \n    nodeList.innerHTML = '';\n    nodeList.appendChild(fragment);\n    lastVisibleNodes = visibleNodes;\n  });\n}\n\n// 優化的檢查函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "getVisibleNodes",
        "saveCurrentDescriptions",
        "escapeHtml",
        "syncDescriptionsForSameNameNodes"
      ],
      "variableStates": [
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2676,
        "lastUpdated": "2025-06-30T14:42:45.412Z"
      }
    },
    {
      "id": 143,
      "x": 845.4155404090914,
      "y": -929.4529809909103,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.412Z"
      }
    },
    {
      "id": 144,
      "x": 820.7564495000004,
      "y": -1281.7720719000017,
      "colorIndex": 0,
      "title": "updateConnectionsAfterDrag",
      "content": "function updateConnectionsAfterDrag() {\n// 1. 獲取所有項目\n  const items = Array.from(nodeData.element.querySelectorAll('.item'));\n  \n  // 2. 建立完整的索引映射表\n  const indexMap = {};\n  items.forEach((item, newIdx) => {\n    const port = item.querySelector('.output-port');\n    const oldIdx = parseInt(port.dataset.originalIndex);\n    indexMap[oldIdx] = newIdx;\n    \n    // 更新端口索引屬性\n    port.dataset.outputIndex = newIdx;\n    port.dataset.originalIndex = newIdx;\n  });\n  \n  // 3. 更新節點數據\n  nodeData.outputs = Array(items.length).fill(0);\n  \n  // 4. 更新所有相關連接\n  connections.forEach(conn => {\n    if (conn.fromNode === nodeData.id && indexMap[conn.fromOutput] !== undefined) {\n      conn.fromOutput = indexMap[conn.fromOutput];\n    }\n  });\n  \n  // 5. 強制重繪\n  drawConnections();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "items",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "indexMap",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        },
        {
          "name": "oldIdx",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 761,
        "lastUpdated": "2025-06-30T14:42:45.412Z"
      }
    },
    {
      "id": 145,
      "x": 820.7564495000004,
      "y": -1234.4720719000015,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.412Z"
      }
    },
    {
      "id": 146,
      "x": 820.7564495000004,
      "y": -1187.1720719000016,
      "colorIndex": 0,
      "title": "updateNodePosition",
      "content": "function updateNodePosition() {\nnode.element.style.left = `${node.x}px`;\nnode.element.style.top = `${node.y}px`;\n  node.element.style.transform = 'none'; // 確保節點不受容器縮放影響\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 173,
        "lastUpdated": "2025-06-30T14:42:45.412Z"
      }
    },
    {
      "id": 147,
      "x": 820.7564495000004,
      "y": -1139.8720719000014,
      "colorIndex": 0,
      "title": "updateNodeList",
      "content": "function updateNodeList() {\nconst nodeList = document.getElementById('node-list');\n  if (!nodeList) return;\n  \n  requestAnimationFrame(() => {\n    const visibleNodes = getVisibleNodes();\n    const visibleNodeIds = visibleNodes.map(n => n.id).join(',');\n    const lastVisibleNodeIds = (lastVisibleNodes || []).map(n => n.id).join(',');\n    \n    if (visibleNodeIds === lastVisibleNodeIds) return;\n    \n    saveCurrentDescriptions();\n    \n    // 建立節點名稱到描述的映射\n    const nameToDescriptionMap = {};\n    nodes.forEach(node => {\n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      if (nodeDescriptions[node.id] && nodeDescriptions[node.id].trim() !== '') {\n        // 如果這個節點有描述，記錄到映射中\n        nameToDescriptionMap[title] = nodeDescriptions[node.id];\n      }\n    });\n    \n    const fragment = document.createDocumentFragment();\n    \n    visibleNodes.forEach(node => {\n      const nodeElement = document.createElement('div');\n      nodeElement.className = 'node-list-item';\n      \n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      \n      // 檢查是否有相同名稱的節點已經有描述\n      let description = nodeDescriptions[node.id] || '';\n      if (!description.trim() && nameToDescriptionMap[title]) {\n        // 如果當前節點沒有描述，但相同名稱的節點有描述，則使用該描述\n        description = nameToDescriptionMap[title];\n        nodeDescriptions[node.id] = description; // 更新節點描述資料\n      }\n      \n      nodeElement.innerHTML = `\n        <div class=\"node-list-name\">${escapeHtml(title)}</div>\n        <textarea class=\"node-list-description\" data-node-id=\"${node.id}\" \n          placeholder=\"輸入節點描述...\">${escapeHtml(description)}</textarea>\n      `;\n      \n      const descInput = nodeElement.querySelector('.node-list-description');\n      descInput.addEventListener('input', () => {\n        const newDescription = descInput.value;\n        nodeDescriptions[descInput.dataset.nodeId] = newDescription;\n        \n        // 當描述變更時，更新所有同名節點的描述\n        if (newDescription.trim() !== '') {\n          const currentTitle = node.element.querySelector('.node-title')?.value || '未命名節點';\n          nodes.forEach(n => {\n            const nTitle = n.element.querySelector('.node-title')?.value || '未命名節點';\n            if (nTitle === currentTitle && n.id !== node.id) {\n              nodeDescriptions[n.id] = newDescription;\n            }\n          });\n           syncDescriptionsForSameNameNodes(descInput.dataset.nodeId);\n          // 觸發重新渲染節點列表\n          updateNodeList();\n        }\n      });\n      \n      fragment.appendChild(nodeElement);\n    });\n    \n    nodeList.innerHTML = '';\n    nodeList.appendChild(fragment);\n    lastVisibleNodes = visibleNodes;\n  });\n}\n\n// 優化的檢查函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "getVisibleNodes",
        "saveCurrentDescriptions",
        "escapeHtml",
        "syncDescriptionsForSameNameNodes"
      ],
      "variableStates": [
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2676,
        "lastUpdated": "2025-06-30T14:42:45.412Z"
      }
    },
    {
      "id": 148,
      "x": -539.3139490000001,
      "y": -3764.9747560000333,
      "colorIndex": 0,
      "title": "updateMinimap",
      "content": "function updateMinimap() {\nif (!nodes.length) return;\n  \n  // 計算所有節點的邊界\n  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n  nodes.forEach(node => {\n    minX = Math.min(minX, node.x);\n    minY = Math.min(minY, node.y);\n    maxX = Math.max(maxX, node.x + 200); // 假設節點寬度為200\n    maxY = Math.max(maxY, node.y + getNodeHeight(node.element));\n  });\n  \n  // 添加邊距\n  const padding = 50;\n  minX -= padding;\n  minY -= padding;\n  maxX += padding;\n  maxY += padding;\n  \n  // 計算縮放比例\n  const width = maxX - minX;\n  const height = maxY - minY;\n  const scaleX = minimapCanvas.width / width;\n  const scaleY = minimapCanvas.height / height;\n  const scale = Math.min(scaleX, scaleY);\n  \n  // 清空畫布\n  minimapCtx.clearRect(0, 0, minimapCanvas.width, minimapCanvas.height);\n  \n  // 繪製所有節點\n  nodes.forEach(node => {\n    const x = (node.x - minX) * scale;\n    const y = (node.y - minY) * scale;\n    const nodeWidth = 200 * scale;\n    const nodeHeight = getNodeHeight(node.element) * scale;\n    \n    // 繪製節點矩形\n    minimapCtx.fillStyle = 'rgba(255, 255, 255, 0.3)';\n    minimapCtx.fillRect(x, y, nodeWidth, nodeHeight);\n    \n    // 繪製邊框\n    minimapCtx.strokeStyle = 'rgba(255, 255, 255, 0.5)';\n    minimapCtx.lineWidth = 1;\n    minimapCtx.strokeRect(x, y, nodeWidth, nodeHeight);\n  });\n  \n  // 更新視口指示器\n  updateViewportIndicator(minX, minY, scale);\n}\n\n// 更新視口指示器\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "getNodeHeight",
        "updateViewportIndicator"
      ],
      "variableStates": [
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1362,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 149,
      "x": 1423.6896077876036,
      "y": -5362.962882228114,
      "colorIndex": 0,
      "title": "createGroupNodeElement",
      "content": "function createGroupNodeElement() {\nconst node = document.createElement('div');\n  node.className = 'node group-node';\n  node.style.left = `${x}px`;\n  node.style.top = `${y}px`;\n  node.innerHTML = `\n    <div class=\"node-header\">\n      <div class=\"input-port\" data-type=\"input\"></div>\n      <button class=\"collapse-btn\">-</button>\n      <button class=\"jump-to-btn hidden\" title=\"跳轉到同名節點\"></button>\n      <input type=\"text\" class=\"node-title\" value=\"${title}\">\n      <button class=\"delete-node-btn\">×</button>\n      <button class=\"ungroup-btn\">解散</button>\n      <div class=\"output-port header-port\" data-type=\"output\" style=\"display:none\"></div>\n    </div>\n    <div class=\"collapsible\">\n      <div class=\"group-node-info\">包含 0 個節點</div>\n      <div class=\"items\">\n        <div class=\"item\">\n          <input type=\"text\" class=\"item-text\" value=\"\">\n          <button class=\"add-node-btn\">+</button>\n          <div class=\"output-port\" data-type=\"output\" data-output-index=\"0\"></div>\n        </div>\n      </div>\n    </div>\n  `;\n  \n  nodesContainer.appendChild(node);\n  return node;\n}\n\n// 修改後的 initializeGroupNodeData 函數，確保正確初始化連接數據\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1126,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 150,
      "x": 1655.6853929115707,
      "y": -5288.9637086743915,
      "colorIndex": 0,
      "title": "initializeGroupNodeData",
      "content": "function initializeGroupNodeData() {\nconst nodeData = {\n    element: node,\n    id: nodes.length,\n    outputs: [0],\n    x,\n    y,\n    jumpIndex: 0,\n    isGroupNode: true,\n    containedNodes: containedNodes,\n    originalConnections: [],  // 保存原始連接\n    incomingConnections: [],  // 進入群組的連接\n    outgoingConnections: []   // 離開群組的連接\n  };\n  \n  // 保存所有被包含節點的原始連接\n  containedNodes.forEach(nodeId => {\n    const originalNode = nodes[nodeId];\n    if (originalNode) {\n      const nodeConnections = {\n        nodeId: originalNode.id,\n        incoming: [],\n        outgoing: []\n      };\n      \n      // 收集進入該節點的連接\n      connections.forEach(conn => {\n        if (conn.toNode === originalNode.id) {\n          nodeConnections.incoming.push({\n            fromNode: conn.fromNode,\n            fromOutput: conn.fromOutput,\n            toNode: conn.toNode\n          });\n        }\n      });\n      \n      // 收集從該節點出去的連接\n      connections.forEach(conn => {\n        if (conn.fromNode === originalNode.id) {\n          nodeConnections.outgoing.push({\n            fromNode: conn.fromNode,\n            fromOutput: conn.fromOutput,\n            toNode: conn.toNode\n          });\n        }\n      });\n      \n      nodeData.originalConnections.push(nodeConnections);\n    }\n  });\n  \n  nodes.push(nodeData);\n  updateGroupNodeInfo(nodeData);\n  \n  // 設置跳轉按鈕\n  const jumpBtn = node.querySelector('.jump-to-btn');\n  jumpBtn.addEventListener('click', (e) => {\n    jumpToSameNameNode(nodeData);\n    e.stopPropagation();\n  });\n\n  return nodeData;\n}\n\n// Update group node info display\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "updateGroupNodeInfo",
        "jumpToSameNameNode"
      ],
      "variableStates": [
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1543,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 151,
      "x": 4330.3413002272755,
      "y": -2632.1294066818245,
      "colorIndex": 0,
      "title": "setupVariableAnalysis",
      "content": "function setupVariableAnalysis() {\nconst header = node.querySelector('.variable-analysis-header');\n  const toggleBtn = node.querySelector('.toggle-variable-analysis-btn');\n  const content = node.querySelector('.variable-analysis-content');\n  \n  // 點擊整個標題區域都可以切換\n  header.addEventListener('click', (e) => {\n    // 確保不是點擊在切換按鈕上\n    if (!e.target.classList.contains('toggle-variable-analysis-btn')) {\n      toggleAnalysis(content, toggleBtn);\n    }\n  });\n  \n  // 點擊切換按鈕\n  toggleBtn.addEventListener('click', (e) => {\n    e.stopPropagation();\n    toggleAnalysis(content, toggleBtn);\n  });\n  \n  // 初始狀態\n  content.style.display = 'block';\n  toggleBtn.textContent = '−';\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "toggleAnalysis"
      ],
      "variableStates": [
        {
          "name": "header",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "header",
          "active": false
        },
        {
          "name": "header",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "header",
          "active": false
        },
        {
          "name": "toggleBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "content",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 667,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 152,
      "x": 3229.9261245165308,
      "y": -1579.1798120652913,
      "colorIndex": 0,
      "title": "setupItemDragAndDrop",
      "content": "function setupItemDragAndDrop() {\nconst itemsContainer = node.querySelector('.items');\n  \n   itemsContainer.querySelectorAll('.drag-handle').forEach(handle => {\n    handle.addEventListener('mousedown', (e) => {\n      if (e.button !== 0) return;\n      \n      const item = e.target.closest('.item');\n      if (!item) return;\n      \n      e.preventDefault();\n      \n      // 初始化時確保所有端口都有原始索引\n      nodeData.element.querySelectorAll('.output-port').forEach(port => {\n        if (!port.dataset.originalIndex) {\n          port.dataset.originalIndex = port.dataset.outputIndex || \n            Array.from(itemsContainer.children).indexOf(port.closest('.item'));\n        }\n      });\n      \n      const items = Array.from(itemsContainer.children);\n      const originalIndex = items.indexOf(item);\n      \n      const dragState = {\n        startX: e.clientX,\n        startY: e.clientY,\n        item: item,\n        originalIndex: originalIndex,\n        currentIndex: originalIndex,\n        placeholder: createPlaceholder(item),\n        isDragging: false\n      };\n      \n      function onDragMove(e) {\n        if (!dragState.isDragging) {\n          const dx = e.clientX - dragState.startX;\n          const dy = e.clientY - dragState.startY;\n          if (Math.sqrt(dx*dx + dy*dy) < 5) return;\n          \n          dragState.isDragging = true;\n          item.classList.add('dragging');\n          item.style.position = 'absolute';\n          item.style.zIndex = '1000';\n          item.style.opacity = '0.8';\n          \n          itemsContainer.insertBefore(dragState.placeholder, item);\n        }\n        \n        item.style.left = (e.clientX - dragState.startX) + 'px';\n        item.style.top = (e.clientY - dragState.startY) + 'px';\n        \n        const items = Array.from(itemsContainer.children).filter(el => el !== dragState.placeholder);\n        const itemRect = item.getBoundingClientRect();\n        const itemCenterY = itemRect.top + itemRect.height / 2;\n        \n        for (let i = 0; i < items.length; i++) {\n          const otherItem = items[i];\n          if (otherItem === item) continue;\n          \n          const otherRect = otherItem.getBoundingClientRect();\n          const otherCenterY = otherRect.top + otherRect.height / 2;\n          \n          if (Math.abs(itemCenterY - otherCenterY) < otherRect.height / 2) {\n            const newIndex = i;\n            if (newIndex !== dragState.currentIndex) {\n              itemsContainer.insertBefore(\n                dragState.placeholder, \n                newIndex > dragState.currentIndex ? items[newIndex].nextSibling : items[newIndex]\n              );\n              dragState.currentIndex = newIndex;\n            }\n            break;\n          }\n        }\n      }\n      \n      function onDragEnd() {\n        document.removeEventListener('mousemove', onDragMove);\n        document.removeEventListener('mouseup', onDragEnd);\n        \n        if (dragState.isDragging) {\n          // 將項目放回新位置\n          itemsContainer.insertBefore(item, dragState.placeholder);\n          item.classList.remove('dragging');\n          item.style.position = '';\n          item.style.left = '';\n          item.style.top = '';\n          item.style.zIndex = '';\n          item.style.opacity = '';\n          \n          // 只有在位置改變時才更新連接\n          if (dragState.originalIndex !== dragState.currentIndex) {\n            updateConnectionsAfterDrag(nodeData, dragState.originalIndex, dragState.currentIndex);\n            \n            // 強制重繪所有連接\n            drawConnections();\n            \n            // 確保節點位置更新\n            updateNodePosition(nodeData);\n            \n            // 更新節點列表\n            updateNodeList();\n          }\n        }\n        \n        dragState.placeholder.remove();\n      }\n      \n      document.addEventListener('mousemove', onDragMove);\n      document.addEventListener('mouseup', onDragEnd);\n    });\n  });\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createPlaceholder",
        "onDragMove",
        "onDragEnd",
        "updateConnectionsAfterDrag",
        "drawConnections",
        "updateNodePosition",
        "updateNodeList"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3856,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 153,
      "x": 3223.362488152893,
      "y": -1528.1161757016546,
      "colorIndex": 0,
      "title": "analyzeVariables",
      "content": "function analyzeVariables() {\n// 獲取內容來源，優先使用 paragraph-btn 的原始內容\n  let content = '';\n  const paragraphBtn = nodeData.element.querySelector('.paragraph-btn');\n  const paragraphInput = nodeData.element.querySelector('.paragraph-input');\n  \n  if (paragraphBtn && paragraphBtn.dataset.originalContent) {\n    content = paragraphBtn.dataset.originalContent;\n  } else if (paragraphInput) {\n    content = paragraphInput.value;\n  }\n  \n  const variableAnalysisContent = nodeData.element.querySelector('.variable-analysis-content');\n  \n  // 清空現有內容\n  variableAnalysisContent.innerHTML = '';\n  \n  // 提取所有 const 和 let 聲明的變數\n  const variableRegex = /(?:const|let)\\s+([a-zA-Z_$][0-9a-zA-Z_$]*)/g;\n  const variables = new Set();\n  let match;\n  \n  while ((match = variableRegex.exec(content)) !== null) {\n    variables.add(match[1]);\n  }\n  \n  // 如果沒有找到變數，顯示提示\n  if (variables.size === 0) {\n    variableAnalysisContent.innerHTML = '<div class=\"no-variables-message\">未找到變數聲明</div>';\n    return;\n  }\n  \n  // 為每個變數創建一個按鈕\n  variables.forEach(variable => {\n    const variableBtn = document.createElement('button');\n    variableBtn.className = 'variable-btn';\n    variableBtn.textContent = variable;\n    variableBtn.dataset.variableName = variable;\n    variableBtn.dataset.active = 'false';\n    \n  variables.forEach(variable => {\n    const variableBtn = document.createElement('button');\n    variableBtn.className = 'variable-btn';\n    variableBtn.textContent = variable;\n    variableBtn.dataset.variableName = variable;\n    variableBtn.dataset.active = 'false';\n    \n    variableBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      toggleVariableHighlight(variable, nodeData, variableBtn);\n      \n      // 在彈出框中高亮變數名稱\n      highlightVariableInPopup(variable, nodeData);\n    });\n    \n    variableAnalysisContent.appendChild(variableBtn);\n  });\n    \n    variableAnalysisContent.appendChild(variableBtn);\n  });\n  \n  // 確保內容是可見的\n  const analysisContainer = nodeData.element.querySelector('.variable-analysis-container');\n  if (analysisContainer) {\n    analysisContainer.style.display = 'block';\n    variableAnalysisContent.style.display = 'block';\n  }\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "toggleVariableHighlight",
        "highlightVariableInPopup"
      ],
      "variableStates": [
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2146,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 154,
      "x": 3504.180669971074,
      "y": -1529.2161757016545,
      "colorIndex": 0,
      "title": "toggleVariableHighlight",
      "content": "function toggleVariableHighlight() {\nconst isActive = button.dataset.active === 'true';\n  \n  if (isActive) {\n    // 取消高亮\n    button.dataset.active = 'false';\n    button.style.backgroundColor = '';\n    resetConnectionColors();\n    \n    // 移除彈出框中的高亮\n    const popup = nodeData.element.querySelector('.paragraph-popup');\n    if (popup) {\n      const highlights = popup.querySelectorAll('.variable-highlight');\n      highlights.forEach(el => {\n        const parent = el.parentNode;\n        parent.replaceChild(document.createTextNode(el.textContent), el);\n        parent.normalize();\n      });\n    }\n  } else {\n    // 高亮相關連接\n    button.dataset.active = 'true';\n    button.style.backgroundColor = '#4a90e2';\n    highlightVariableConnections(variableName, nodeData);\n    \n    // 在彈出框中高亮變數名稱\n    highlightVariableInPopup(variableName, nodeData);\n  }\n}\n\n// 新增高亮變數相關連接的函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "resetConnectionColors",
        "highlightVariableConnections",
        "highlightVariableInPopup"
      ],
      "variableStates": [
        {
          "name": "isActive",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "highlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "isActive",
          "active": false
        },
        {
          "name": "isActive",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "highlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "isActive",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "highlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "highlights",
          "active": false
        },
        {
          "name": "isActive",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "highlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 864,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 155,
      "x": 3912.880669971075,
      "y": -1929.8161757016546,
      "colorIndex": 0,
      "title": "resetConnectionColors",
      "content": "function resetConnectionColors() {\nconnections.forEach(conn => {\n    conn.highlighted = false;\n  });\n  drawConnections();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "drawConnections"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 125,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 156,
      "x": 3916.0806699710733,
      "y": -1201.3161757016542,
      "colorIndex": 0,
      "title": "highlightVariableConnections",
      "content": "function highlightVariableConnections() {\n// 先重置所有連接顏色\n  resetConnectionColors();\n  \n  // 使用BFS算法遍歷所有相關節點\n  const queue = [{ node: startNode, variable: variableName }];\n  const visited = new Set();\n  \n  while (queue.length > 0) {\n    const current = queue.shift();\n    const nodeId = current.node.id;\n    \n    if (visited.has(nodeId)) continue;\n    visited.add(nodeId);\n    \n    // 檢查當前節點內容是否包含該變數\n    const paragraphInput = current.node.element.querySelector('.paragraph-input');\n    if (paragraphInput && paragraphInput.value.includes(current.variable)) {\n      // 高亮從父節點到當前節點的連接\n      highlightConnectionsToNode(current.node);\n      \n      // 提取當前節點中新的變數聲明\n      const newVariables = extractVariables(paragraphInput.value);\n      \n      // 將子節點和新變數加入隊列\n      const childConnections = connections.filter(conn => conn.fromNode === current.node.id);\n      childConnections.forEach(conn => {\n        const childNode = nodes[conn.toNode];\n        newVariables.forEach(v => {\n          queue.push({ node: childNode, variable: v });\n        });\n      });\n    }\n  }\n  \n  // 重繪連接\n  drawConnections();\n}\n\n// 新增提取變數的輔助函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "resetConnectionColors",
        "highlightConnectionsToNode",
        "extractVariables",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        },
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "queue",
          "active": false
        },
        {
          "name": "visited",
          "active": false
        },
        {
          "name": "current",
          "active": false
        },
        {
          "name": "nodeId",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "newVariables",
          "active": false
        },
        {
          "name": "childConnections",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        },
        {
          "name": "childNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1114,
        "lastUpdated": "2025-06-30T14:42:45.413Z"
      }
    },
    {
      "id": 157,
      "x": 4252.510669971078,
      "y": -1325.606175701653,
      "colorIndex": 0,
      "title": "resetConnectionColors",
      "content": "function resetConnectionColors() {\nconnections.forEach(conn => {\n    conn.highlighted = false;\n  });\n  drawConnections();\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 125,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 158,
      "x": 4251.300669971079,
      "y": -1288.5361757016537,
      "colorIndex": 0,
      "title": "highlightConnectionsToNode",
      "content": "function highlightConnectionsToNode() {\nconst incomingConnections = connections.filter(conn => conn.toNode === node.id);\n  \n  incomingConnections.forEach(conn => {\n    conn.highlighted = true;\n  });\n}\n\n// 新增重置連接顏色的函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "incomingConnections",
          "active": false
        },
        {
          "name": "incomingConnections",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 218,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 159,
      "x": 4252.510669971078,
      "y": -1014.3061757016543,
      "colorIndex": 0,
      "title": "extractVariables",
      "content": "function extractVariables() {\nconst variableRegex = /(?:const|let)\\s+([a-zA-Z_$][0-9a-zA-Z_$]*)/g;\n  const variables = new Set();\n  let match;\n  \n  while ((match = variableRegex.exec(content)) !== null) {\n    variables.add(match[1]);\n  }\n  \n  return Array.from(variables);\n}\n\n// 新增高亮連接到指定節點的連接線\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [],
      "variableStates": [
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "match",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 296,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 160,
      "x": 4257.570669971077,
      "y": -668.686175701654,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\nconsole.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}\n\n  // 修改初始化代碼\n  function init() {\n    // 設置canvas大小\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n\n    // 初始化位置和縮放\n    scale = 1;\n    translateX = container.offsetWidth / 2 - 100;\n    translateY = container.offsetHeight / 2 - 50;\n\n    applyTransform();\n\n    // 創建初始節點\n    createNode(-100, -50);\n    // 初始高亮檢查\n    updateSameNameHighlights();\n\n      // 初始化左側面板\n  updateNodeList();\n\n\n    // 設置定期檢查可見節點的定時器\n  setInterval(checkVisibleNodes, 500);\n  initMinimap();\n  }\n\n// 檢查可見節點並更新列表\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "init",
        "applyTransform",
        "createNode",
        "updateSameNameHighlights",
        "updateNodeList",
        "initMinimap"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3548,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 161,
      "x": 1341.946432971073,
      "y": -1503.7333611562015,
      "colorIndex": 0,
      "title": "setupPopupCleanup 節點",
      "content": "",
      "description": "",
      "isConvertedToButton": false,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 0,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 162,
      "x": 1636.4521329710753,
      "y": -2704.5863611562036,
      "colorIndex": 0,
      "title": "smoothMoveTo",
      "content": "function smoothMoveTo() {\nconst startTime = performance.now();\n  const startX = translateX;\n  const startY = translateY;\n  const startScale = scale;\n\n  // 計算目標平移值，使世界座標點位於視圖中心\n  const targetTranslateX = (window.innerWidth / 2) - (targetWorldX * targetScale);\n  const targetTranslateY = (window.innerHeight / 2) - (targetWorldY * targetScale);\n\n  function animate(currentTime) {\n    const elapsed = currentTime - startTime;\n    const progress = Math.min(elapsed / duration, 1);\n    const easeProgress = easeInOutCubic(progress);\n\n    // 插值平移和縮放\n    translateX = startX + (targetTranslateX - startX) * easeProgress;\n    translateY = startY + (targetTranslateY - startY) * easeProgress;\n    scale = startScale + (targetScale - startScale) * easeProgress;\n\n    applyTransform();\n\n    if (progress < 1) {\n      animationFrameId = requestAnimationFrame(animate);\n    } else {\n      // 確保最終位置精確\n      translateX = targetTranslateX + left-panel.width;\n      translateY = targetTranslateY;\n      scale = targetScale;\n      applyTransform();\n\n      // 添加高亮動畫\n      const title = document.querySelector('.node.highlight-found .node-title');\n      if (title) {\n        title.classList.add('title-highlight');\n        setTimeout(() => title.classList.remove('title-highlight'), 1000);\n      }\n\n      // 清除動畫 ID\n      animationFrameId = null;\n    }\n  }\n\n  animationFrameId = requestAnimationFrame(animate);\n}\n\n\n\n// 緩動函數\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "animate",
        "easeInOutCubic",
        "applyTransform"
      ],
      "variableStates": [
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "startTime",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "startScale",
          "active": false
        },
        {
          "name": "targetTranslateX",
          "active": false
        },
        {
          "name": "targetTranslateY",
          "active": false
        },
        {
          "name": "elapsed",
          "active": false
        },
        {
          "name": "progress",
          "active": false
        },
        {
          "name": "easeProgress",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "title",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1407,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 163,
      "x": 518.3887578190087,
      "y": -227.1216439190087,
      "colorIndex": 0,
      "title": "createNode",
      "content": "",
      "description": "",
      "isConvertedToButton": false,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 0,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 164,
      "x": 740.4614850917359,
      "y": -145.8398257371906,
      "colorIndex": 0,
      "title": "setupNodeContent",
      "content": "function setupNodeContent(newNode, nodeData) {\n  const paragraphInput = newNode.element.querySelector('.paragraph-input');\n  if (paragraphInput && nodeData.content !== undefined) {\n    paragraphInput.value = nodeData.content;\n\n    if (nodeData.isConvertedToButton && nodeData.content.trim()) {\n      const btn = document.createElement('button');\n      btn.className = 'paragraph-btn';\n      btn.textContent = nodeData.content.length > 50\n        ? nodeData.content.substring(0, 47) + '...'\n        : nodeData.content;\n      btn.dataset.originalContent = nodeData.content;\n\n      const popup = document.createElement('div');\n      popup.className = 'paragraph-popup';\n      popup.textContent = nodeData.content;\n      popup.classList.add(COLOR_CLASSES[nodeData.colorIndex % COLOR_CLASSES.length]);\n\n      const container = document.createElement('div');\n      container.style.position = 'relative';\n      container.style.display = 'inline-block';\n      container.style.width = '100%';\n\n      const originalInput = paragraphInput.cloneNode(true);\n      originalInput.style.display = 'none';\n      container.appendChild(originalInput);\n      container.appendChild(btn);\n      container.appendChild(popup);\n\n      paragraphInput.replaceWith(container);\n      setupParagraphButtonEvents(btn, popup, originalInput, newNode);\n    }\n  }\n\n  // 恢復項目列表\n  const itemsContainer = newNode.element.querySelector('.items');\n  if (itemsContainer && nodeData.items) {\n    itemsContainer.innerHTML = '';\n    newNode.outputs = [];\n\n    nodeData.items.forEach((itemText, index) => {\n      const newItem = document.createElement('div');\n      newItem.className = 'item';\n      newItem.innerHTML = `\n        <span class=\"drag-handle\">☰</span>\n        <input type=\"text\" class=\"item-text\" value=\"${escapeHtml(itemText || '項目 ' + (index + 1))}\">\n        <button class=\"add-node-btn\">+</button>\n        <div class=\"output-port\" data-type=\"output\"></div>\n      `;\n      itemsContainer.appendChild(newItem);\n\n      newNode.outputs.push(index);\n      setupAddNodeButton(newItem, newNode, index, container);\n      setupOutputPort(newItem, newNode, index, container);\n      setupItemDragAndDrop(newNode.element, newNode);\n    });\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "setupParagraphButtonEvents",
        "escapeHtml",
        "setupAddNodeButton",
        "setupOutputPort",
        "setupItemDragAndDrop"
      ],
      "variableStates": [
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "btn",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "container",
          "active": false
        },
        {
          "name": "originalInput",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2204,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 165,
      "x": 497.56148509173534,
      "y": 165.9601742628097,
      "colorIndex": 0,
      "title": "updateGroupNodeInfo",
      "content": "// Update group node info display\nfunction updateGroupNodeInfo(groupNode) {\n  const infoElement = groupNode.element.querySelector('.group-node-info');\n  if (infoElement) {\n    infoElement.textContent = `包含 ${groupNode.containedNodes.length} 個節點`;\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "infoElement",
          "active": false
        },
        {
          "name": "infoElement",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 252,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 166,
      "x": 4409.221027500002,
      "y": -3720.3805885000024,
      "colorIndex": 0,
      "title": "addNewItem",
      "content": "// 修改 addNewItem 函數以包含拖動手柄\nfunction addNewItem(node, nodeData) {\n  const itemsContainer = node.querySelector('.items');\n  const itemCount = itemsContainer.children.length;\n  \n  const item = document.createElement('div');\n  item.className = 'item';\n  item.innerHTML = `\n    <span class=\"drag-handle\">☰</span>\n    <input type=\"text\" class=\"item-text\" value=\"\">\n    <button class=\"add-node-btn\">+</button>\n    <div class=\"output-port\" data-type=\"output\" data-output-index=\"${itemCount}\"></div>\n  `;\n  \n  itemsContainer.appendChild(item);\n  \n  // 設置新項目的按鈕事件\n  item.querySelector('.add-node-btn').addEventListener('click', (e) => {\n    handleAddNodeClick(nodeData, itemCount, e);\n  });\n  \n  // 設置新項目的拖動事件\n  setupItemDragAndDrop(node, nodeData);\n  \n  // 更新節點數據\n  nodeData.outputs.push(0);\n  \n  // 設置輸出端口事件\n  setupOutputPort(item, nodeData, itemCount);\n  \n  return item;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "handleAddNodeClick",
        "setupItemDragAndDrop",
        "setupOutputPort"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemCount",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemCount",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "itemCount",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemCount",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "item",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 865,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 167,
      "x": 4629.221027500003,
      "y": -3720.3805885000024,
      "colorIndex": 0,
      "title": "handleAddNodeClick",
      "content": "// 处理添加节点点击\nfunction handleAddNodeClick(nodeData, outputIndex, e) {\n  const childNodes = connections.filter(conn =>\n  conn.fromNode === nodeData.id &&\n  conn.fromOutput === outputIndex\n  ).length;\n\n  const newNodeX = nodeData.x + 200 / scale;\n  const newNodeY = nodeData.y + (childNodes * 120 / scale);\n\n  const newNode = createNode(newNodeX, newNodeY);\n\n  connections.push( {\n    fromNode: nodeData.id,\n    fromOutput: outputIndex,\n    toNode: newNode.id\n  });\n  drawConnections();\n  e.stopPropagation();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "newNodeX",
          "active": false
        },
        {
          "name": "newNodeY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 507,
        "lastUpdated": "2025-06-30T14:42:45.414Z"
      }
    },
    {
      "id": 168,
      "x": 4629.221027500003,
      "y": -3673.0805885000036,
      "colorIndex": 0,
      "title": "setupItemDragAndDrop",
      "content": "function setupItemDragAndDrop(node, nodeData) {\n  const itemsContainer = node.querySelector('.items');\n  \n   itemsContainer.querySelectorAll('.drag-handle').forEach(handle => {\n    handle.addEventListener('mousedown', (e) => {\n      if (e.button !== 0) return;\n      \n      const item = e.target.closest('.item');\n      if (!item) return;\n      \n      e.preventDefault();\n      \n      // 初始化時確保所有端口都有原始索引\n      nodeData.element.querySelectorAll('.output-port').forEach(port => {\n        if (!port.dataset.originalIndex) {\n          port.dataset.originalIndex = port.dataset.outputIndex || \n            Array.from(itemsContainer.children).indexOf(port.closest('.item'));\n        }\n      });\n      \n      const items = Array.from(itemsContainer.children);\n      const originalIndex = items.indexOf(item);\n      \n      const dragState = {\n        startX: e.clientX,\n        startY: e.clientY,\n        item: item,\n        originalIndex: originalIndex,\n        currentIndex: originalIndex,\n        placeholder: createPlaceholder(item),\n        isDragging: false\n      };\n      \n      function onDragMove(e) {\n        if (!dragState.isDragging) {\n          const dx = e.clientX - dragState.startX;\n          const dy = e.clientY - dragState.startY;\n          if (Math.sqrt(dx*dx + dy*dy) < 5) return;\n          \n          dragState.isDragging = true;\n          item.classList.add('dragging');\n          item.style.position = 'absolute';\n          item.style.zIndex = '1000';\n          item.style.opacity = '0.8';\n          \n          itemsContainer.insertBefore(dragState.placeholder, item);\n        }\n        \n        item.style.left = (e.clientX - dragState.startX) + 'px';\n        item.style.top = (e.clientY - dragState.startY) + 'px';\n        \n        const items = Array.from(itemsContainer.children).filter(el => el !== dragState.placeholder);\n        const itemRect = item.getBoundingClientRect();\n        const itemCenterY = itemRect.top + itemRect.height / 2;\n        \n        for (let i = 0; i < items.length; i++) {\n          const otherItem = items[i];\n          if (otherItem === item) continue;\n          \n          const otherRect = otherItem.getBoundingClientRect();\n          const otherCenterY = otherRect.top + otherRect.height / 2;\n          \n          if (Math.abs(itemCenterY - otherCenterY) < otherRect.height / 2) {\n            const newIndex = i;\n            if (newIndex !== dragState.currentIndex) {\n              itemsContainer.insertBefore(\n                dragState.placeholder, \n                newIndex > dragState.currentIndex ? items[newIndex].nextSibling : items[newIndex]\n              );\n              dragState.currentIndex = newIndex;\n            }\n            break;\n          }\n        }\n      }\n      \n      function onDragEnd() {\n        document.removeEventListener('mousemove', onDragMove);\n        document.removeEventListener('mouseup', onDragEnd);\n        \n        if (dragState.isDragging) {\n          // 將項目放回新位置\n          itemsContainer.insertBefore(item, dragState.placeholder);\n          item.classList.remove('dragging');\n          item.style.position = '';\n          item.style.left = '';\n          item.style.top = '';\n          item.style.zIndex = '';\n          item.style.opacity = '';\n          \n          // 只有在位置改變時才更新連接\n          if (dragState.originalIndex !== dragState.currentIndex) {\n            updateConnectionsAfterDrag(nodeData, dragState.originalIndex, dragState.currentIndex);\n            \n            // 強制重繪所有連接\n            drawConnections();\n            \n            // 確保節點位置更新\n            updateNodePosition(nodeData);\n            \n            // 更新節點列表\n            updateNodeList();\n          }\n        }\n        \n        dragState.placeholder.remove();\n      }\n      \n      document.addEventListener('mousemove', onDragMove);\n      document.addEventListener('mouseup', onDragEnd);\n    });\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createPlaceholder",
        "onDragMove",
        "onDragEnd",
        "updateConnectionsAfterDrag",
        "drawConnections",
        "updateNodePosition",
        "updateNodeList"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3870,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 169,
      "x": 4629.221027500003,
      "y": -3625.7805885000025,
      "colorIndex": 0,
      "title": "setupOutputPort",
      "content": "// 设置输出端口\nfunction setupOutputPort(portElement, nodeData, outputIndex) {\n  portElement.addEventListener('mousedown', (e) => {\n    if (spacePressed || e.button === 1) return;\n\n    // 獲取實際顯示的端口（可能是原始端口或header中的端口）\n    const visiblePort = portElement.style.display !== 'none' ? portElement : \n      nodeData.element.querySelector(`.header-port:nth-child(${outputIndex + 4})`);\n    \n    const rect = visiblePort.getBoundingClientRect();\n    connecting = {\n      startX: rect.left + rect.width / 2,\n      startY: rect.top + rect.height / 2,\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      currentX: rect.left + rect.width / 2,\n      currentY: rect.top + rect.height / 2\n    };\n    container.classList.add('connecting');\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "visiblePort",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 765,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 170,
      "x": 5581.070077499999,
      "y": -3598.8429984999993,
      "colorIndex": 0,
      "title": "analyzeVariables",
      "content": "// 新增變數分析函數\nfunction analyzeVariables(nodeData) {\n  // 獲取內容來源，優先使用 paragraph-btn 的原始內容\n  let content = '';\n  const paragraphBtn = nodeData.element.querySelector('.paragraph-btn');\n  const paragraphInput = nodeData.element.querySelector('.paragraph-input');\n  \n  if (paragraphBtn && paragraphBtn.dataset.originalContent) {\n    content = paragraphBtn.dataset.originalContent;\n  } else if (paragraphInput) {\n    content = paragraphInput.value;\n  }\n  \n  const variableAnalysisContent = nodeData.element.querySelector('.variable-analysis-content');\n  \n  // 清空現有內容\n  variableAnalysisContent.innerHTML = '';\n  \n  // 提取所有 const 和 let 聲明的變數\n  const variableRegex = /(?:const|let)\\s+([a-zA-Z_$][0-9a-zA-Z_$]*)/g;\n  const variables = new Set();\n  let match;\n  \n  while ((match = variableRegex.exec(content)) !== null) {\n    variables.add(match[1]);\n  }\n  \n  // 如果沒有找到變數，顯示提示\n  if (variables.size === 0) {\n    variableAnalysisContent.innerHTML = '<div class=\"no-variables-message\">未找到變數聲明</div>';\n    return;\n  }\n  \n  // 為每個變數創建一個按鈕\n  variables.forEach(variable => {\n    const variableBtn = document.createElement('button');\n    variableBtn.className = 'variable-btn';\n    variableBtn.textContent = variable;\n    variableBtn.dataset.variableName = variable;\n    variableBtn.dataset.active = 'false';\n    \n    variableBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      toggleVariableHighlight(variable, nodeData, variableBtn);\n    });\n    \n    variableAnalysisContent.appendChild(variableBtn);\n  });\n  \n  // 確保內容是可見的\n  const analysisContainer = nodeData.element.querySelector('.variable-analysis-container');\n  if (analysisContainer) {\n    analysisContainer.style.display = 'block';\n    variableAnalysisContent.style.display = 'block';\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "toggleVariableHighlight"
      ],
      "variableStates": [
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1749,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 171,
      "x": 6075.590077499999,
      "y": -4055.1529985000047,
      "colorIndex": 0,
      "title": "setupAddNodeButton",
      "content": "function setupAddNodeButton(itemElement, nodeData, outputIndex, container) {\n  itemElement.querySelector('.add-node-btn').addEventListener('click', (e) => {\n    const name = itemElement.querySelector('.item-text').value;\n\n    const childNodes = connections.filter(conn =>\n    conn.fromNode === nodeData.id &&\n    conn.fromOutput === outputIndex\n    ).length;\n\n    const baseX = nodeData.x + 200 / scale;\n    const baseY = nodeData.y + (childNodes * 120 / scale);\n\n    const newNode = createNode(\n    baseX,\n    baseY,\n    name + ' 節點'\n    );\n\n    connections.push( {\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      toNode: newNode.id\n    });\n    drawConnections();\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 715,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 172,
      "x": 6075.590077499999,
      "y": -4012.1529985000047,
      "colorIndex": 0,
      "title": "setupOutputPort",
      "content": "function setupOutputPort(itemElement, nodeData, outputIndex, container) {\n  itemElement.querySelector('.output-port').addEventListener('mousedown', (e) => {\n    if (spacePressed || e.button === 1) return;\n\n    const rect = e.target.getBoundingClientRect();\n    connecting = {\n      startX: rect.left + rect.width / 2,\n      startY: rect.top + rect.height / 2,\n      fromNode: nodeData.id,\n      fromOutput: outputIndex\n    };\n    container.classList.add('connecting');\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 501,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 173,
      "x": 6075.590077499999,
      "y": -3969.152998500005,
      "colorIndex": 0,
      "title": "setupItemDragAndDrop",
      "content": "// 新增拖動排序功能\nfunction setupItemDragAndDrop(node, nodeData) {\n  const itemsContainer = node.querySelector('.items');\n  \n   itemsContainer.querySelectorAll('.drag-handle').forEach(handle => {\n    handle.addEventListener('mousedown', (e) => {\n      if (e.button !== 0) return;\n      \n      const item = e.target.closest('.item');\n      if (!item) return;\n      \n      e.preventDefault();\n      \n      // 初始化時確保所有端口都有原始索引\n      nodeData.element.querySelectorAll('.output-port').forEach(port => {\n        if (!port.dataset.originalIndex) {\n          port.dataset.originalIndex = port.dataset.outputIndex || \n            Array.from(itemsContainer.children).indexOf(port.closest('.item'));\n        }\n      });\n      \n      const items = Array.from(itemsContainer.children);\n      const originalIndex = items.indexOf(item);\n      \n      const dragState = {\n        startX: e.clientX,\n        startY: e.clientY,\n        item: item,\n        originalIndex: originalIndex,\n        currentIndex: originalIndex,\n        placeholder: createPlaceholder(item),\n        isDragging: false\n      };\n      \n      function onDragMove(e) {\n        if (!dragState.isDragging) {\n          const dx = e.clientX - dragState.startX;\n          const dy = e.clientY - dragState.startY;\n          if (Math.sqrt(dx*dx + dy*dy) < 5) return;\n          \n          dragState.isDragging = true;\n          item.classList.add('dragging');\n          item.style.position = 'absolute';\n          item.style.zIndex = '1000';\n          item.style.opacity = '0.8';\n          \n          itemsContainer.insertBefore(dragState.placeholder, item);\n        }\n        \n        item.style.left = (e.clientX - dragState.startX) + 'px';\n        item.style.top = (e.clientY - dragState.startY) + 'px';\n        \n        const items = Array.from(itemsContainer.children).filter(el => el !== dragState.placeholder);\n        const itemRect = item.getBoundingClientRect();\n        const itemCenterY = itemRect.top + itemRect.height / 2;\n        \n        for (let i = 0; i < items.length; i++) {\n          const otherItem = items[i];\n          if (otherItem === item) continue;\n          \n          const otherRect = otherItem.getBoundingClientRect();\n          const otherCenterY = otherRect.top + otherRect.height / 2;\n          \n          if (Math.abs(itemCenterY - otherCenterY) < otherRect.height / 2) {\n            const newIndex = i;\n            if (newIndex !== dragState.currentIndex) {\n              itemsContainer.insertBefore(\n                dragState.placeholder, \n                newIndex > dragState.currentIndex ? items[newIndex].nextSibling : items[newIndex]\n              );\n              dragState.currentIndex = newIndex;\n            }\n            break;\n          }\n        }\n      }\n      \n      function onDragEnd() {\n        document.removeEventListener('mousemove', onDragMove);\n        document.removeEventListener('mouseup', onDragEnd);\n        \n        if (dragState.isDragging) {\n          // 將項目放回新位置\n          itemsContainer.insertBefore(item, dragState.placeholder);\n          item.classList.remove('dragging');\n          item.style.position = '';\n          item.style.left = '';\n          item.style.top = '';\n          item.style.zIndex = '';\n          item.style.opacity = '';\n          \n          // 只有在位置改變時才更新連接\n          if (dragState.originalIndex !== dragState.currentIndex) {\n            updateConnectionsAfterDrag(nodeData, dragState.originalIndex, dragState.currentIndex);\n            \n            // 強制重繪所有連接\n            drawConnections();\n            \n            // 確保節點位置更新\n            updateNodePosition(nodeData);\n            \n            // 更新節點列表\n            updateNodeList();\n          }\n        }\n        \n        dragState.placeholder.remove();\n      }\n      \n      document.addEventListener('mousemove', onDragMove);\n      document.addEventListener('mouseup', onDragEnd);\n    });\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createPlaceholder",
        "onDragMove",
        "onDragEnd",
        "updateConnectionsAfterDrag",
        "drawConnections",
        "updateNodePosition",
        "updateNodeList"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3882,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 174,
      "x": 4609.432209318187,
      "y": -2630.3112248636426,
      "colorIndex": 0,
      "title": "toggleAnalysis",
      "content": "function toggleAnalysis(content, toggleBtn) {\n  if (content.style.display === 'none') {\n    content.style.display = 'block';\n    toggleBtn.textContent = '−';\n  } else {\n    content.style.display = 'none';\n    toggleBtn.textContent = '+';\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 243,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 175,
      "x": -251.48394899999994,
      "y": -3760.494756000041,
      "colorIndex": 0,
      "title": "getNodeHeight",
      "content": "// 輔助函數：獲取節點高度\nfunction getNodeHeight(nodeElement) {\n  // 簡單估算節點高度（可根據實際需求調整）\n  const titleHeight = 30;\n  const paragraphHeight = nodeElement.querySelector('.paragraph-input') ? 70 : 0;\n  const itemsHeight = nodeElement.querySelectorAll('.item').length * 30;\n  const buttonsHeight = 30;\n  \n  return titleHeight + paragraphHeight + itemsHeight + buttonsHeight + 20; // 20px padding\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "titleHeight",
          "active": false
        },
        {
          "name": "paragraphHeight",
          "active": false
        },
        {
          "name": "itemsHeight",
          "active": false
        },
        {
          "name": "buttonsHeight",
          "active": false
        },
        {
          "name": "titleHeight",
          "active": false
        },
        {
          "name": "titleHeight",
          "active": false
        },
        {
          "name": "paragraphHeight",
          "active": false
        },
        {
          "name": "itemsHeight",
          "active": false
        },
        {
          "name": "buttonsHeight",
          "active": false
        },
        {
          "name": "paragraphHeight",
          "active": false
        },
        {
          "name": "titleHeight",
          "active": false
        },
        {
          "name": "paragraphHeight",
          "active": false
        },
        {
          "name": "itemsHeight",
          "active": false
        },
        {
          "name": "buttonsHeight",
          "active": false
        },
        {
          "name": "itemsHeight",
          "active": false
        },
        {
          "name": "titleHeight",
          "active": false
        },
        {
          "name": "paragraphHeight",
          "active": false
        },
        {
          "name": "itemsHeight",
          "active": false
        },
        {
          "name": "buttonsHeight",
          "active": false
        },
        {
          "name": "buttonsHeight",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 382,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 176,
      "x": 29.39605100000017,
      "y": -3632.1147560000363,
      "colorIndex": 0,
      "title": "updateViewportIndicator",
      "content": "// 更新視口指示器\nfunction updateViewportIndicator(minX, minY, minimapScale) {\n  // 1. 定義左側工具列寬度\n  const leftPanelWidth = 321;\n  const PanelScale = scale*0.15;\n\n  // 2. 計算視口的世界坐標範圍（完整畫布）\n  const viewportWorldWidth = minimapCanvas.width / PanelScale;\n  const viewportWorldHeight = minimapCanvas.height / PanelScale;\n\n  // 3. 計算視口中心的世界坐標（關鍵修正）\n  const viewportCenterX = (-translateX + leftPanelWidth) / PanelScale + viewportWorldWidth / 2;\n  const viewportCenterY = -translateY / (scale*0.395) + viewportWorldHeight / 2;\n\n  // 4. 計算指示器寬高\n  const indicatorWidth = (viewportWorldWidth)* minimapScale;\n  const indicatorHeight = viewportWorldHeight * minimapScale;\n\n  // 5. 以中心點計算位置（核心修改）\n  const indicatorLeft = (viewportCenterX - minX) * minimapScale - indicatorWidth / 2;\n  const indicatorTop = (viewportCenterY - minY) * minimapScale - indicatorHeight / 2;\n\n  // 6. 更新指示器\n  viewportIndicator.style.left = `${indicatorLeft}px`;\n  viewportIndicator.style.top = `${indicatorTop}px`;\n  viewportIndicator.style.width = `${indicatorWidth}px`;\n  viewportIndicator.style.height = `${indicatorHeight}px`;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "leftPanelWidth",
          "active": false
        },
        {
          "name": "PanelScale",
          "active": false
        },
        {
          "name": "viewportWorldWidth",
          "active": false
        },
        {
          "name": "viewportWorldHeight",
          "active": false
        },
        {
          "name": "viewportCenterX",
          "active": false
        },
        {
          "name": "viewportCenterY",
          "active": false
        },
        {
          "name": "indicatorWidth",
          "active": false
        },
        {
          "name": "indicatorHeight",
          "active": false
        },
        {
          "name": "indicatorLeft",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        },
        {
          "name": "indicatorTop",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1088,
        "lastUpdated": "2025-06-30T14:42:45.415Z"
      }
    },
    {
      "id": 177,
      "x": -635.4466762727277,
      "y": -4427.14839236367,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\n    console.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3031,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 178,
      "x": 3004.804183139662,
      "y": 27.123316612519034,
      "colorIndex": 0,
      "title": "createGroupNodeFromSelection",
      "content": "// 從選中的節點創建群組節點\nfunction createGroupNodeFromSelection() {\n  if (selectedNodes.size < 2) return;\n  \n  const selectedNodesData = Array.from(selectedNodes)\n    .map(id => nodes[id])\n    .filter(node => node && !node.isGroupNode);\n  \n  if (selectedNodesData.length < 2) return;\n  \n  // 計算群組節點位置（選中節點的中心點）\n  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n  selectedNodesData.forEach(node => {\n    const rect = node.element.getBoundingClientRect();\n    minX = Math.min(minX, node.x);\n    minY = Math.min(minY, node.y);\n    maxX = Math.max(maxX, node.x + rect.width / scale);\n    maxY = Math.max(maxY, node.y + rect.height / scale);\n  });\n  \n  const centerX = (minX + maxX) / 2;\n  const centerY = (minY + maxY) / 2;\n  \n  // 創建群組節點\n  const groupNodeElement = createGroupNodeElement(centerX, centerY);\n  const groupNodeData = initializeGroupNodeData(\n    groupNodeElement, \n    centerX, \n    centerY, \n    selectedNodesData.map(n => n.id)\n  );\n  \n  // 隱藏被群組的節點\n  selectedNodesData.forEach(node => {\n    node.element.style.display = 'none';\n  });\n  \n  // 設置群組節點的ITEM名稱\n  const itemsContainer = groupNodeElement.querySelector('.items');\n  itemsContainer.innerHTML = '';\n  \n  // 收集所有輸出連接\n  const outputMap = new Map();\n  selectedNodesData.forEach(node => {\n    connections.forEach(conn => {\n      if (conn.fromNode === node.id) {\n        if (!outputMap.has(conn.fromOutput)) {\n          outputMap.set(conn.fromOutput, []);\n        }\n        outputMap.get(conn.fromOutput).push({\n          toNode: conn.toNode,\n          nodeTitle: nodes[conn.toNode].element.querySelector('.node-title').value\n        });\n      }\n    });\n  });\n  \n  // 創建ITEM\n  outputMap.forEach((connections, outputIndex) => {\n    const itemDiv = document.createElement('div');\n    itemDiv.className = 'item';\n    \n    // 使用第一個連接的子節點名稱作為ITEM名稱\n    const itemName = connections[0].nodeTitle || `輸出 ${outputIndex + 1}`;\n    \n    itemDiv.innerHTML = `\n      <input type=\"text\" class=\"item-text\" value=\"${escapeHtml(itemName)}\">\n      <button class=\"add-node-btn\">+</button>\n      <div class=\"output-port\" data-type=\"output\" data-output-index=\"${outputIndex}\"></div>\n    `;\n    \n    itemsContainer.appendChild(itemDiv);\n    \n    // 設置事件\n    setupAddNodeButton(itemDiv, groupNodeData, outputIndex, container);\n    setupOutputPort(itemDiv, groupNodeData, outputIndex, container);\n  });\n  \n  // 處理連接\n  processGroupNodeConnections(groupNodeData, selectedNodesData);\n  \n  // 設置群組節點事件\n  setupGroupNodeEvents(groupNodeElement, groupNodeData);\n  \n  // 清除選中狀態\n  clearSelection();\n  \n  return groupNodeData;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "createGroupNodeElement",
        "initializeGroupNodeData",
        "escapeHtml",
        "setupAddNodeButton",
        "setupOutputPort",
        "processGroupNodeConnections",
        "setupGroupNodeEvents",
        "clearSelection"
      ],
      "variableStates": [
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2577,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 179,
      "x": 3294.886827767762,
      "y": 35.305134794337505,
      "colorIndex": 0,
      "title": "createGroupNodeElement",
      "content": "// 創建群組節點元素\nfunction createGroupNodeElement(x, y, title = '群組節點') {\n  const node = document.createElement('div');\n  node.className = 'node group-node';\n  node.style.left = `${x}px`;\n  node.style.top = `${y}px`;\n  node.innerHTML = `\n    <div class=\"node-header\">\n      <div class=\"input-port\" data-type=\"input\"></div>\n      <button class=\"collapse-btn\">-</button>\n      <button class=\"jump-to-btn hidden\" title=\"跳轉到同名節點\"></button>\n      <input type=\"text\" class=\"node-title\" value=\"${title}\">\n      <button class=\"delete-node-btn\">×</button>\n      <button class=\"ungroup-btn\">解散</button>\n      <div class=\"output-port header-port\" data-type=\"output\" style=\"display:none\"></div>\n    </div>\n    <div class=\"collapsible\">\n      <div class=\"group-node-info\">包含 0 個節點</div>\n      <div class=\"items\">\n        <div class=\"item\">\n          <input type=\"text\" class=\"item-text\" value=\"\">\n          <button class=\"add-node-btn\">+</button>\n          <div class=\"output-port\" data-type=\"output\" data-output-index=\"0\"></div>\n        </div>\n      </div>\n    </div>\n  `;\n  \n  nodesContainer.appendChild(node);\n  return node;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1110,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 180,
      "x": 3294.804183139663,
      "y": 71.07786206706453,
      "colorIndex": 0,
      "title": "initializeGroupNodeData",
      "content": "// 修改後的 initializeGroupNodeData 函數，確保正確初始化連接數據\nfunction initializeGroupNodeData(node, x, y, containedNodes = []) {\n  const nodeData = {\n    element: node,\n    id: nodes.length,\n    outputs: [0],\n    x,\n    y,\n    jumpIndex: 0,\n    isGroupNode: true,\n    containedNodes: containedNodes,\n    originalConnections: [],  // 保存原始連接\n    incomingConnections: [],  // 進入群組的連接\n    outgoingConnections: []   // 離開群組的連接\n  };\n  \n  // 保存所有被包含節點的原始連接\n  containedNodes.forEach(nodeId => {\n    const originalNode = nodes[nodeId];\n    if (originalNode) {\n      const nodeConnections = {\n        nodeId: originalNode.id,\n        incoming: [],\n        outgoing: []\n      };\n      \n      // 收集進入該節點的連接\n      connections.forEach(conn => {\n        if (conn.toNode === originalNode.id) {\n          nodeConnections.incoming.push({\n            fromNode: conn.fromNode,\n            fromOutput: conn.fromOutput,\n            toNode: conn.toNode\n          });\n        }\n      });\n      \n      // 收集從該節點出去的連接\n      connections.forEach(conn => {\n        if (conn.fromNode === originalNode.id) {\n          nodeConnections.outgoing.push({\n            fromNode: conn.fromNode,\n            fromOutput: conn.fromOutput,\n            toNode: conn.toNode\n          });\n        }\n      });\n      \n      nodeData.originalConnections.push(nodeConnections);\n    }\n  });\n  \n  nodes.push(nodeData);\n  updateGroupNodeInfo(nodeData);\n  \n  // 設置跳轉按鈕\n  const jumpBtn = node.querySelector('.jump-to-btn');\n  jumpBtn.addEventListener('click', (e) => {\n    jumpToSameNameNode(nodeData);\n    e.stopPropagation();\n  });\n\n  return nodeData;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "updateGroupNodeInfo",
        "jumpToSameNameNode"
      ],
      "variableStates": [
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1586,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 181,
      "x": 3295.7132740487523,
      "y": 115.03240752160866,
      "colorIndex": 0,
      "title": "escapeHtml",
      "content": "// HTML转义辅助函数\nfunction escapeHtml(unsafe) {\n  return unsafe\n  .replace(/&/g, \"&amp;\")\n  .replace(/</g, \"&lt;\")\n  .replace(/>/g, \"&gt;\")\n  .replace(/\"/g, \"&quot;\")\n  .replace(/'/g, \"&#039;\");\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 192,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 182,
      "x": 3294.8041831396613,
      "y": 159.89604388524663,
      "colorIndex": 0,
      "title": "setupAddNodeButton",
      "content": "function setupAddNodeButton(itemElement, nodeData, outputIndex, container) {\n  itemElement.querySelector('.add-node-btn').addEventListener('click', (e) => {\n    const name = itemElement.querySelector('.item-text').value;\n\n    const childNodes = connections.filter(conn =>\n    conn.fromNode === nodeData.id &&\n    conn.fromOutput === outputIndex\n    ).length;\n\n    const baseX = nodeData.x + 200 / scale;\n    const baseY = nodeData.y + (childNodes * 120 / scale);\n\n    const newNode = createNode(\n    baseX,\n    baseY,\n    name + ' 節點'\n    );\n\n    connections.push( {\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      toNode: newNode.id\n    });\n    drawConnections();\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 715,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 183,
      "x": 3296.6223649578433,
      "y": 204.75968024888175,
      "colorIndex": 0,
      "title": "setupOutputPort",
      "content": "function setupOutputPort(itemElement, nodeData, outputIndex, container) {\n  itemElement.querySelector('.output-port').addEventListener('mousedown', (e) => {\n    if (spacePressed || e.button === 1) return;\n\n    const rect = e.target.getBoundingClientRect();\n    connecting = {\n      startX: rect.left + rect.width / 2,\n      startY: rect.top + rect.height / 2,\n      fromNode: nodeData.id,\n      fromOutput: outputIndex\n    };\n    container.classList.add('connecting');\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 501,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 184,
      "x": 3294.1041831396624,
      "y": 252.6233166125179,
      "colorIndex": 0,
      "title": "processGroupNodeConnections",
      "content": "// 修改後的 processGroupNodeConnections 函數，確保正確處理連接關係\nfunction processGroupNodeConnections(groupNode, containedNodes) {\n  const containedNodeIds = new Set(containedNodes.map(n => n.id));\n  \n  // 找出所有進入群組的連接（外部節點 -> 群組內節點）\n  groupNode.incomingConnections = connections.filter(conn => \n    !containedNodeIds.has(conn.fromNode) && \n    containedNodeIds.has(conn.toNode)\n  ).map(conn => ({\n    fromNode: conn.fromNode,\n    fromOutput: conn.fromOutput,\n    toNode: conn.toNode\n  }));\n  \n  // 找出所有離開群組的連接（群組內節點 -> 外部節點）\n  groupNode.outgoingConnections = connections.filter(conn => \n    containedNodeIds.has(conn.fromNode) && \n    !containedNodeIds.has(conn.toNode)\n  ).map(conn => ({\n    fromNode: conn.fromNode,\n    fromOutput: conn.fromOutput,\n    toNode: conn.toNode\n  }));\n  \n  // 移除所有與被包含節點相關的原始連接\n  connections = connections.filter(conn => \n    !containedNodeIds.has(conn.fromNode) && \n    !containedNodeIds.has(conn.toNode)\n  );\n  \n  // 為群組節點創建輸入端口（基於進入群組的連接）\n  const inputSources = new Set();\n  groupNode.incomingConnections.forEach(conn => {\n    inputSources.add(conn.fromNode);\n    \n    // 創建從原始來源節點到群組節點的連接\n    connections.push({\n      fromNode: conn.fromNode,\n      fromOutput: conn.fromOutput,\n      toNode: groupNode.id\n    });\n  });\n  \n  // 為群組節點創建輸出端口（基於離開群組的連接）\n  const outputTargets = new Map();\n  groupNode.outgoingConnections.forEach(conn => {\n    if (!outputTargets.has(conn.fromOutput)) {\n      outputTargets.set(conn.fromOutput, []);\n    }\n    outputTargets.get(conn.fromOutput).push(conn.toNode);\n    \n    // 創建從群組節點到原始目標節點的連接\n    connections.push({\n      fromNode: groupNode.id,\n      fromOutput: conn.fromOutput,\n      toNode: conn.toNode\n    });\n  });\n  \n  // 更新群組節點的輸出端口\n  if (outputTargets.size > 0) {\n    groupNode.outputs = Array.from(outputTargets.keys());\n    updateGroupNodeItems(groupNode);\n  }\n  \n  drawConnections();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "updateGroupNodeItems",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "containedNodeIds",
          "active": false
        },
        {
          "name": "inputSources",
          "active": false
        },
        {
          "name": "outputTargets",
          "active": false
        },
        {
          "name": "containedNodeIds",
          "active": false
        },
        {
          "name": "containedNodeIds",
          "active": false
        },
        {
          "name": "inputSources",
          "active": false
        },
        {
          "name": "outputTargets",
          "active": false
        },
        {
          "name": "inputSources",
          "active": false
        },
        {
          "name": "containedNodeIds",
          "active": false
        },
        {
          "name": "inputSources",
          "active": false
        },
        {
          "name": "outputTargets",
          "active": false
        },
        {
          "name": "outputTargets",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1845,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 185,
      "x": 4009.486001321481,
      "y": 320.63240752160834,
      "colorIndex": 0,
      "title": "setupGroupNodeEvents",
      "content": "// 設置群組節點的事件\nfunction setupGroupNodeEvents(node, nodeData) {\n  setupNodeDrag(node, nodeData);\n  setupCollapseButton(node, nodeData);\n  setupDeleteButton(node, nodeData);\n  setupUngroupButton(node, nodeData);\n  setupTitleInput(node);\n  setupPortEvents(node, nodeData);\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "setupNodeDrag",
        "setupCollapseButton",
        "setupDeleteButton",
        "setupUngroupButton",
        "setupTitleInput",
        "setupPortEvents"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 269,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 186,
      "x": 3827.6041831396633,
      "y": 706.9233166125181,
      "colorIndex": 0,
      "title": "clearSelection",
      "content": "// 清除选择\nfunction clearSelection() {\n  selectedNodes.forEach(id => {\n    const node = nodes[id];\n    if (node && node.element) {\n      node.element.classList.remove('selected');\n    }\n  });\n  selectedNodes.clear();\n  if (selectionBox) {\n    selectionBox.style.display = 'none';\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 282,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 187,
      "x": 3568.004183139663,
      "y": 400.02331661251844,
      "colorIndex": 0,
      "title": "updateGroupNodeItems",
      "content": "// 更新群組節點的項目列表\nfunction updateGroupNodeItems(groupNode) {\n  const itemsContainer = groupNode.element.querySelector('.items');\n  itemsContainer.innerHTML = '';\n  \n  groupNode.outputs.forEach((outputIndex, i) => {\n    const newItem = document.createElement('div');\n    newItem.className = 'item';\n    newItem.innerHTML = `\n      <input type=\"text\" class=\"item-text\" value=\"輸出 ${i + 1}\">\n      <button class=\"add-node-btn\">+</button>\n      <div class=\"output-port\" data-type=\"output\" data-output-index=\"${outputIndex}\"></div>\n    `;\n    itemsContainer.appendChild(newItem);\n    \n    setupAddNodeButton(newItem, groupNode, outputIndex, container);\n    setupOutputPort(newItem, groupNode, outputIndex, container);\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "setupAddNodeButton",
        "setupOutputPort"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        },
        {
          "name": "newItem",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 716,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 188,
      "x": 3582.304183139663,
      "y": 771.8233166125176,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\n    console.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3031,
        "lastUpdated": "2025-06-30T14:42:45.416Z"
      }
    },
    {
      "id": 189,
      "x": 940.461485091736,
      "y": -145.8398257371906,
      "colorIndex": 0,
      "title": "setupParagraphButtonEvents",
      "content": "function setupParagraphButtonEvents(btn, popup, paragraphInput, nodeData) {\n  // 檢查必要的DOM元素是否存在\n  if (!btn || !btn.parentNode || !popup) {\n    console.error('無法設置按鈕事件：缺少必要的DOM元素');\n    return;\n  }\n\n  // 先克隆原始按鈕（保留原始按鈕不變）\n  const btnClone = btn.cloneNode(true);\n  \n  // 創建按鈕容器\n  const buttonContainer = document.createElement('div');\n  buttonContainer.style.display = 'flex';\n  buttonContainer.style.alignItems = 'center';\n  buttonContainer.style.marginBottom = '10px';\n\n  // 創建並添加COPY和UPDATE按鈕\n  const copyBtn = createCopyButton();\n  const updateBtn = createUpdateButton();\n\n  // 先將克隆按鈕和更新按鈕添加到容器\n  buttonContainer.appendChild(btnClone);\n  buttonContainer.appendChild(updateBtn);\n\n  // 小地圖點擊事件\nminimapCanvas.addEventListener('click', (e) => {\n  const rect = minimapCanvas.getBoundingClientRect();\n  const clickX = e.clientX - rect.left;\n  const clickY = e.clientY - rect.top;\n  \n  // 計算所有節點的邊界（與updateMinimap相同）\n  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n  nodes.forEach(node => {\n    minX = Math.min(minX, node.x);\n    minY = Math.min(minY, node.y);\n    maxX = Math.max(maxX, node.x + 200);\n    maxY = Math.max(maxY, node.y + getNodeHeight(node.element));\n  });\n  \n  const padding = 50;\n  minX -= padding;\n  minY -= padding;\n  maxX += padding;\n  maxY += padding;\n  \n  const width = maxX - minX;\n  const height = maxY - minY;\n  const scaleX = minimapCanvas.width / width;\n  const scaleY = minimapCanvas.height / height;\n  const scale = Math.min(scaleX, scaleY);\n  \n  // 計算點擊位置對應的世界座標\n  const worldX = (clickX / scale) + minX;\n  const worldY = (clickY / scale) + minY;\n  \n  // 移動視圖到點擊位置\n  smoothMoveTo(worldX, worldY, this.scale, 300);\n});\n\n  // 替換原始按鈕\n  try {\n    btn.parentNode.replaceChild(buttonContainer, btn);\n  } catch (error) {\n    console.error('替換按鈕失敗:', error);\n    return;\n  }\n\n  // 保存原始位置信息\n  const { originalParent, originalNextSibling, originalStyles } = saveOriginalPopupPosition(popup);\n  \n  // 設置按鈕事件\n  setupCopyButtonEvents(copyBtn, popup);\n  setupUpdateButtonEvents(updateBtn, popup, nodeData);\n  popup.appendChild(copyBtn);\n\n  // 設置彈出框切換事件\n  setupPopupToggleEvents(btnClone, popup, nodeData);\n\n  // 設置全局事件處理器\n  const handleClickOutside = createClickOutsideHandler(popup, originalParent, originalNextSibling, originalStyles, nodeData);\n  const clearHandler = createClearHandler(popup, paragraphInput, nodeData);\n\n  document.addEventListener('click', handleClickOutside);\n  document.addEventListener('keydown', clearHandler);\n\n  // 儲存事件處理器以便清理\n  popup.dataset.eventHandlers = JSON.stringify({\n    click: handleClickOutside,\n    keydown: clearHandler\n  });\n\n  setupPopupCleanup(popup, handleClickOutside, clearHandler);\n  \n  return btnClone;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createCopyButton",
        "createUpdateButton",
        "smoothMoveTo",
        "saveOriginalPopupPosition",
        "setupCopyButtonEvents",
        "setupUpdateButtonEvents",
        "setupPopupToggleEvents",
        "createClickOutsideHandler",
        "createClearHandler",
        "setupPopupCleanup"
      ],
      "variableStates": [
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "btnClone",
          "active": false
        },
        {
          "name": "buttonContainer",
          "active": false
        },
        {
          "name": "copyBtn",
          "active": false
        },
        {
          "name": "updateBtn",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "clickX",
          "active": false
        },
        {
          "name": "clickY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "handleClickOutside",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        },
        {
          "name": "clearHandler",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2693,
        "lastUpdated": "2025-06-30T14:42:45.417Z"
      }
    },
    {
      "id": 190,
      "x": 940.461485091736,
      "y": -102.8398257371906,
      "colorIndex": 0,
      "title": "escapeHtml",
      "content": "// HTML转义辅助函数\nfunction escapeHtml(unsafe) {\n  return unsafe\n  .replace(/&/g, \"&amp;\")\n  .replace(/</g, \"&lt;\")\n  .replace(/>/g, \"&gt;\")\n  .replace(/\"/g, \"&quot;\")\n  .replace(/'/g, \"&#039;\");\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 192,
        "lastUpdated": "2025-06-30T14:42:45.417Z"
      }
    },
    {
      "id": 191,
      "x": 940.461485091736,
      "y": -59.83982573719058,
      "colorIndex": 0,
      "title": "setupAddNodeButton",
      "content": "function setupAddNodeButton(itemElement, nodeData, outputIndex, container) {\n  itemElement.querySelector('.add-node-btn').addEventListener('click', (e) => {\n    const name = itemElement.querySelector('.item-text').value;\n\n    const childNodes = connections.filter(conn =>\n    conn.fromNode === nodeData.id &&\n    conn.fromOutput === outputIndex\n    ).length;\n\n    const baseX = nodeData.x + 200 / scale;\n    const baseY = nodeData.y + (childNodes * 120 / scale);\n\n    const newNode = createNode(\n    baseX,\n    baseY,\n    name + ' 節點'\n    );\n\n    connections.push( {\n      fromNode: nodeData.id,\n      fromOutput: outputIndex,\n      toNode: newNode.id\n    });\n    drawConnections();\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createNode",
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "name",
          "active": false
        },
        {
          "name": "childNodes",
          "active": false
        },
        {
          "name": "baseX",
          "active": false
        },
        {
          "name": "baseY",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        },
        {
          "name": "newNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 715,
        "lastUpdated": "2025-06-30T14:42:45.417Z"
      }
    },
    {
      "id": 192,
      "x": 940.461485091736,
      "y": -16.83982573719055,
      "colorIndex": 0,
      "title": "setupOutputPort",
      "content": "function setupOutputPort(itemElement, nodeData, outputIndex, container) {\n  itemElement.querySelector('.output-port').addEventListener('mousedown', (e) => {\n    if (spacePressed || e.button === 1) return;\n\n    const rect = e.target.getBoundingClientRect();\n    connecting = {\n      startX: rect.left + rect.width / 2,\n      startY: rect.top + rect.height / 2,\n      fromNode: nodeData.id,\n      fromOutput: outputIndex\n    };\n    container.classList.add('connecting');\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 501,
        "lastUpdated": "2025-06-30T14:42:45.417Z"
      }
    },
    {
      "id": 193,
      "x": 940.461485091736,
      "y": 26.16017426280945,
      "colorIndex": 0,
      "title": "setupItemDragAndDrop",
      "content": "// 新增拖動排序功能\nfunction setupItemDragAndDrop(node, nodeData) {\n  const itemsContainer = node.querySelector('.items');\n  \n   itemsContainer.querySelectorAll('.drag-handle').forEach(handle => {\n    handle.addEventListener('mousedown', (e) => {\n      if (e.button !== 0) return;\n      \n      const item = e.target.closest('.item');\n      if (!item) return;\n      \n      e.preventDefault();\n      \n      // 初始化時確保所有端口都有原始索引\n      nodeData.element.querySelectorAll('.output-port').forEach(port => {\n        if (!port.dataset.originalIndex) {\n          port.dataset.originalIndex = port.dataset.outputIndex || \n            Array.from(itemsContainer.children).indexOf(port.closest('.item'));\n        }\n      });\n      \n      const items = Array.from(itemsContainer.children);\n      const originalIndex = items.indexOf(item);\n      \n      const dragState = {\n        startX: e.clientX,\n        startY: e.clientY,\n        item: item,\n        originalIndex: originalIndex,\n        currentIndex: originalIndex,\n        placeholder: createPlaceholder(item),\n        isDragging: false\n      };\n      \n      function onDragMove(e) {\n        if (!dragState.isDragging) {\n          const dx = e.clientX - dragState.startX;\n          const dy = e.clientY - dragState.startY;\n          if (Math.sqrt(dx*dx + dy*dy) < 5) return;\n          \n          dragState.isDragging = true;\n          item.classList.add('dragging');\n          item.style.position = 'absolute';\n          item.style.zIndex = '1000';\n          item.style.opacity = '0.8';\n          \n          itemsContainer.insertBefore(dragState.placeholder, item);\n        }\n        \n        item.style.left = (e.clientX - dragState.startX) + 'px';\n        item.style.top = (e.clientY - dragState.startY) + 'px';\n        \n        const items = Array.from(itemsContainer.children).filter(el => el !== dragState.placeholder);\n        const itemRect = item.getBoundingClientRect();\n        const itemCenterY = itemRect.top + itemRect.height / 2;\n        \n        for (let i = 0; i < items.length; i++) {\n          const otherItem = items[i];\n          if (otherItem === item) continue;\n          \n          const otherRect = otherItem.getBoundingClientRect();\n          const otherCenterY = otherRect.top + otherRect.height / 2;\n          \n          if (Math.abs(itemCenterY - otherCenterY) < otherRect.height / 2) {\n            const newIndex = i;\n            if (newIndex !== dragState.currentIndex) {\n              itemsContainer.insertBefore(\n                dragState.placeholder, \n                newIndex > dragState.currentIndex ? items[newIndex].nextSibling : items[newIndex]\n              );\n              dragState.currentIndex = newIndex;\n            }\n            break;\n          }\n        }\n      }\n      \n      function onDragEnd() {\n        document.removeEventListener('mousemove', onDragMove);\n        document.removeEventListener('mouseup', onDragEnd);\n        \n        if (dragState.isDragging) {\n          // 將項目放回新位置\n          itemsContainer.insertBefore(item, dragState.placeholder);\n          item.classList.remove('dragging');\n          item.style.position = '';\n          item.style.left = '';\n          item.style.top = '';\n          item.style.zIndex = '';\n          item.style.opacity = '';\n          \n          // 只有在位置改變時才更新連接\n          if (dragState.originalIndex !== dragState.currentIndex) {\n            updateConnectionsAfterDrag(nodeData, dragState.originalIndex, dragState.currentIndex);\n            \n            // 強制重繪所有連接\n            drawConnections();\n            \n            // 確保節點位置更新\n            updateNodePosition(nodeData);\n            \n            // 更新節點列表\n            updateNodeList();\n          }\n        }\n        \n        dragState.placeholder.remove();\n      }\n      \n      document.addEventListener('mousemove', onDragMove);\n      document.addEventListener('mouseup', onDragEnd);\n    });\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createPlaceholder",
        "onDragMove",
        "onDragEnd",
        "updateConnectionsAfterDrag",
        "drawConnections",
        "updateNodePosition",
        "updateNodeList"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3882,
        "lastUpdated": "2025-06-30T14:42:45.417Z"
      }
    },
    {
      "id": 194,
      "x": 5687.160077500002,
      "y": -4243.972998500014,
      "colorIndex": 0,
      "title": "setupItemDragAndDrop",
      "content": "// 新增拖動排序功能\nfunction setupItemDragAndDrop(node, nodeData) {\n  const itemsContainer = node.querySelector('.items');\n  \n   itemsContainer.querySelectorAll('.drag-handle').forEach(handle => {\n    handle.addEventListener('mousedown', (e) => {\n      if (e.button !== 0) return;\n      \n      const item = e.target.closest('.item');\n      if (!item) return;\n      \n      e.preventDefault();\n      \n      // 初始化時確保所有端口都有原始索引\n      nodeData.element.querySelectorAll('.output-port').forEach(port => {\n        if (!port.dataset.originalIndex) {\n          port.dataset.originalIndex = port.dataset.outputIndex || \n            Array.from(itemsContainer.children).indexOf(port.closest('.item'));\n        }\n      });\n      \n      const items = Array.from(itemsContainer.children);\n      const originalIndex = items.indexOf(item);\n      \n      const dragState = {\n        startX: e.clientX,\n        startY: e.clientY,\n        item: item,\n        originalIndex: originalIndex,\n        currentIndex: originalIndex,\n        placeholder: createPlaceholder(item),\n        isDragging: false\n      };\n      \n      function onDragMove(e) {\n        if (!dragState.isDragging) {\n          const dx = e.clientX - dragState.startX;\n          const dy = e.clientY - dragState.startY;\n          if (Math.sqrt(dx*dx + dy*dy) < 5) return;\n          \n          dragState.isDragging = true;\n          item.classList.add('dragging');\n          item.style.position = 'absolute';\n          item.style.zIndex = '1000';\n          item.style.opacity = '0.8';\n          \n          itemsContainer.insertBefore(dragState.placeholder, item);\n        }\n        \n        item.style.left = (e.clientX - dragState.startX) + 'px';\n        item.style.top = (e.clientY - dragState.startY) + 'px';\n        \n        const items = Array.from(itemsContainer.children).filter(el => el !== dragState.placeholder);\n        const itemRect = item.getBoundingClientRect();\n        const itemCenterY = itemRect.top + itemRect.height / 2;\n        \n        for (let i = 0; i < items.length; i++) {\n          const otherItem = items[i];\n          if (otherItem === item) continue;\n          \n          const otherRect = otherItem.getBoundingClientRect();\n          const otherCenterY = otherRect.top + otherRect.height / 2;\n          \n          if (Math.abs(itemCenterY - otherCenterY) < otherRect.height / 2) {\n            const newIndex = i;\n            if (newIndex !== dragState.currentIndex) {\n              itemsContainer.insertBefore(\n                dragState.placeholder, \n                newIndex > dragState.currentIndex ? items[newIndex].nextSibling : items[newIndex]\n              );\n              dragState.currentIndex = newIndex;\n            }\n            break;\n          }\n        }\n      }\n      \n      function onDragEnd() {\n        document.removeEventListener('mousemove', onDragMove);\n        document.removeEventListener('mouseup', onDragEnd);\n        \n        if (dragState.isDragging) {\n          // 將項目放回新位置\n          itemsContainer.insertBefore(item, dragState.placeholder);\n          item.classList.remove('dragging');\n          item.style.position = '';\n          item.style.left = '';\n          item.style.top = '';\n          item.style.zIndex = '';\n          item.style.opacity = '';\n          \n          // 只有在位置改變時才更新連接\n          if (dragState.originalIndex !== dragState.currentIndex) {\n            updateConnectionsAfterDrag(nodeData, dragState.originalIndex, dragState.currentIndex);\n            \n            // 強制重繪所有連接\n            drawConnections();\n            \n            // 確保節點位置更新\n            updateNodePosition(nodeData);\n            \n            // 更新節點列表\n            updateNodeList();\n          }\n        }\n        \n        dragState.placeholder.remove();\n      }\n      \n      document.addEventListener('mousemove', onDragMove);\n      document.addEventListener('mouseup', onDragEnd);\n    });\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createPlaceholder",
        "onDragMove",
        "onDragEnd",
        "updateConnectionsAfterDrag",
        "drawConnections",
        "updateNodePosition",
        "updateNodeList"
      ],
      "variableStates": [
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "item",
          "active": false
        },
        {
          "name": "items",
          "active": false
        },
        {
          "name": "originalIndex",
          "active": false
        },
        {
          "name": "dragState",
          "active": false
        },
        {
          "name": "dx",
          "active": false
        },
        {
          "name": "dy",
          "active": false
        },
        {
          "name": "itemRect",
          "active": false
        },
        {
          "name": "itemCenterY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "otherItem",
          "active": false
        },
        {
          "name": "otherRect",
          "active": false
        },
        {
          "name": "otherCenterY",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        },
        {
          "name": "newIndex",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3882,
        "lastUpdated": "2025-06-30T14:42:45.417Z"
      }
    },
    {
      "id": 195,
      "x": 2348.597831789257,
      "y": -1955.8308929743841,
      "colorIndex": 0,
      "title": "adjustWidths",
      "content": "// 宽度自适应辅助函数\nfunction adjustWidths(popups, margin, screenWidth) {\n  let totalWidth = 0;\n  const originalWidths = [];\n\n  popups.forEach(popup => {\n    popup.style.width = '';\n    const rect = popup.getBoundingClientRect();\n    originalWidths.push(rect.width);\n    totalWidth += rect.width;\n  });\n\n  totalWidth += margin * (popups.length - 1);\n\n  if (totalWidth > screenWidth) {\n    const scaleFactor = (screenWidth - margin * (popups.length - 1)) /\n    (totalWidth - margin * (popups.length - 1));\n\n    popups.forEach((popup, i) => {\n    popup.style.width = `${originalWidths[i] * scaleFactor}px`;\n    });\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "originalWidths",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "originalWidths",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "originalWidths",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "originalWidths",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "originalWidths",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        },
        {
          "name": "scaleFactor",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 610,
        "lastUpdated": "2025-06-30T14:42:45.418Z"
      }
    },
    {
      "id": 196,
      "x": 2346.597831789257,
      "y": -1548.830892974384,
      "colorIndex": 0,
      "title": "arrangeGridLayout",
      "content": "// 原有的網格佈局函數\nfunction arrangeGridLayout(popups, margin, screenWidth, screenHeight) {\n  if (popups.length === 0) return;\n\n  // 計算所有彈出框的總面積和平均寬高\n  let totalWidth = 0;\n  let totalHeight = 0;\n  popups.forEach(popup => {\n    const rect = popup.getBoundingClientRect();\n    totalWidth += rect.width + margin;\n    totalHeight += rect.height + margin;\n  });\n\n  // 計算最接近正方形的行列分佈\n  const aspectRatio = screenWidth / screenHeight;\n  let cols = Math.ceil(Math.sqrt(popups.length * aspectRatio));\n  let rows = Math.ceil(popups.length / cols);\n\n  // 調整行列數以更貼近正方形\n  while (rows > cols && (rows - 1) * cols >= popups.length) {\n    rows--;\n    cols = Math.ceil(popups.length / rows);\n  }\n\n  // 計算每行列的最大寬高\n  const colWidths = new Array(cols).fill(0);\n  const rowHeights = new Array(rows).fill(0);\n  popups.forEach((popup, index) => {\n    const col = index % cols;\n    const row = Math.floor(index / cols);\n    const rect = popup.getBoundingClientRect();\n    colWidths[col] = Math.max(colWidths[col], rect.width);\n    rowHeights[row] = Math.max(rowHeights[row], rect.height);\n  });\n\n  // 計算總佈局寬高\n  const layoutWidth = colWidths.reduce((sum, width) => sum + width + margin, -margin);\n  const layoutHeight = rowHeights.reduce((sum, height) => sum + height + margin, -margin);\n\n  // 計算起始位置（居中）\n  const startX = (screenWidth - layoutWidth) / 2;\n  const startY = (screenHeight - layoutHeight) / 2;\n\n  // 設置每個彈出框的位置\n  const colPositions = [];\n  let currentX = startX;\n  for (let i = 0; i < cols; i++) {\n    colPositions.push(currentX);\n    currentX += colWidths[i] + margin;\n  }\n\n  const rowPositions = [];\n  let currentY = startY;\n  for (let i = 0; i < rows; i++) {\n    rowPositions.push(currentY);\n    currentY += rowHeights[i] + margin;\n  }\n\n  popups.forEach((popup, index) => {\n    const col = index % cols;\n    const row = Math.floor(index / cols);\n    const rect = popup.getBoundingClientRect();\n\n  popup.style.left = `${colPositions[col]}px`;\n  popup.style.top = `${rowPositions[row]}px`;\n  popup.style.width = `${rect.width}px`;\n  popup.style.height = `${rect.height}px`;\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "totalWidth",
          "active": false
        },
        {
          "name": "totalHeight",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "aspectRatio",
          "active": false
        },
        {
          "name": "cols",
          "active": false
        },
        {
          "name": "rows",
          "active": false
        },
        {
          "name": "colWidths",
          "active": false
        },
        {
          "name": "rowHeights",
          "active": false
        },
        {
          "name": "col",
          "active": false
        },
        {
          "name": "row",
          "active": false
        },
        {
          "name": "layoutWidth",
          "active": false
        },
        {
          "name": "layoutHeight",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "colPositions",
          "active": false
        },
        {
          "name": "currentX",
          "active": false
        },
        {
          "name": "i",
          "active": false
        },
        {
          "name": "rowPositions",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        },
        {
          "name": "currentY",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2062,
        "lastUpdated": "2025-06-30T14:42:45.418Z"
      }
    },
    {
      "id": 197,
      "x": 3784.716158346274,
      "y": -603.5762040486394,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\n    console.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3031,
        "lastUpdated": "2025-06-30T14:42:45.418Z"
      }
    },
    {
      "id": 198,
      "x": 3784.716158346274,
      "y": -556.2762040486397,
      "colorIndex": 0,
      "title": "createGroupNodeFromSelection",
      "content": "// 從選中的節點創建群組節點\nfunction createGroupNodeFromSelection() {\n  if (selectedNodes.size < 2) return;\n  \n  const selectedNodesData = Array.from(selectedNodes)\n    .map(id => nodes[id])\n    .filter(node => node && !node.isGroupNode);\n  \n  if (selectedNodesData.length < 2) return;\n  \n  // 計算群組節點位置（選中節點的中心點）\n  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n  selectedNodesData.forEach(node => {\n    const rect = node.element.getBoundingClientRect();\n    minX = Math.min(minX, node.x);\n    minY = Math.min(minY, node.y);\n    maxX = Math.max(maxX, node.x + rect.width / scale);\n    maxY = Math.max(maxY, node.y + rect.height / scale);\n  });\n  \n  const centerX = (minX + maxX) / 2;\n  const centerY = (minY + maxY) / 2;\n  \n  // 創建群組節點\n  const groupNodeElement = createGroupNodeElement(centerX, centerY);\n  const groupNodeData = initializeGroupNodeData(\n    groupNodeElement, \n    centerX, \n    centerY, \n    selectedNodesData.map(n => n.id)\n  );\n  \n  // 隱藏被群組的節點\n  selectedNodesData.forEach(node => {\n    node.element.style.display = 'none';\n  });\n  \n  // 設置群組節點的ITEM名稱\n  const itemsContainer = groupNodeElement.querySelector('.items');\n  itemsContainer.innerHTML = '';\n  \n  // 收集所有輸出連接\n  const outputMap = new Map();\n  selectedNodesData.forEach(node => {\n    connections.forEach(conn => {\n      if (conn.fromNode === node.id) {\n        if (!outputMap.has(conn.fromOutput)) {\n          outputMap.set(conn.fromOutput, []);\n        }\n        outputMap.get(conn.fromOutput).push({\n          toNode: conn.toNode,\n          nodeTitle: nodes[conn.toNode].element.querySelector('.node-title').value\n        });\n      }\n    });\n  });\n  \n  // 創建ITEM\n  outputMap.forEach((connections, outputIndex) => {\n    const itemDiv = document.createElement('div');\n    itemDiv.className = 'item';\n    \n    // 使用第一個連接的子節點名稱作為ITEM名稱\n    const itemName = connections[0].nodeTitle || `輸出 ${outputIndex + 1}`;\n    \n    itemDiv.innerHTML = `\n      <input type=\"text\" class=\"item-text\" value=\"${escapeHtml(itemName)}\">\n      <button class=\"add-node-btn\">+</button>\n      <div class=\"output-port\" data-type=\"output\" data-output-index=\"${outputIndex}\"></div>\n    `;\n    \n    itemsContainer.appendChild(itemDiv);\n    \n    // 設置事件\n    setupAddNodeButton(itemDiv, groupNodeData, outputIndex, container);\n    setupOutputPort(itemDiv, groupNodeData, outputIndex, container);\n  });\n  \n  // 處理連接\n  processGroupNodeConnections(groupNodeData, selectedNodesData);\n  \n  // 設置群組節點事件\n  setupGroupNodeEvents(groupNodeElement, groupNodeData);\n  \n  // 清除選中狀態\n  clearSelection();\n  \n  return groupNodeData;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createGroupNodeElement",
        "initializeGroupNodeData",
        "escapeHtml",
        "setupAddNodeButton",
        "setupOutputPort",
        "processGroupNodeConnections",
        "setupGroupNodeEvents",
        "clearSelection"
      ],
      "variableStates": [
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "selectedNodesData",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "rect",
          "active": false
        },
        {
          "name": "centerX",
          "active": false
        },
        {
          "name": "centerY",
          "active": false
        },
        {
          "name": "groupNodeElement",
          "active": false
        },
        {
          "name": "groupNodeData",
          "active": false
        },
        {
          "name": "itemsContainer",
          "active": false
        },
        {
          "name": "outputMap",
          "active": false
        },
        {
          "name": "itemDiv",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        },
        {
          "name": "itemName",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2577,
        "lastUpdated": "2025-06-30T14:42:45.418Z"
      }
    },
    {
      "id": 199,
      "x": 3784.716158346274,
      "y": -508.9762040486394,
      "colorIndex": 0,
      "title": "toggleNodeColors",
      "content": "function toggleNodeColors() {\n    selectedNodes.forEach(nodeId => {\n        const node = nodes[nodeId];\n        if (node) {\n            const nodeElement = node.element;\n            const popup = nodeElement.querySelector('.paragraph-popup');\n            \n            // 使用節點自己的 colorIndex 或默認使用 currentColorIndex\n            const nodeColorIndex = node.colorIndex !== undefined ? node.colorIndex : currentColorIndex;\n            \n            // 計算下一個顏色索引\n            const nextColorIndex = (nodeColorIndex + 1) % COLOR_CLASSES.length;\n            \n            // 移除所有顏色類\n            COLOR_CLASSES.forEach(cls => {\n                nodeElement.classList.remove(cls);\n                if (popup) popup.classList.remove(cls);\n            });\n            \n            // 添加新顏色類\n            const isTransparent = nodeElement.classList.contains('transparent');\n            const colorClass = isTransparent ? \n                `transparent ${COLOR_CLASSES[nextColorIndex]}` : \n                COLOR_CLASSES[nextColorIndex];\n            \n            nodeElement.className = nodeElement.className.split(' ')\n                .filter(c => !COLOR_CLASSES.includes(c) && c !== 'transparent')\n                .join(' ') + ' ' + colorClass;\n            \n            // 更新彈出框顏色\n            if (popup) {\n                popup.className = popup.className.split(' ')\n                    .filter(c => !COLOR_CLASSES.includes(c))\n                    .join(' ') + ' ' + COLOR_CLASSES[nextColorIndex];\n            }\n            \n            // 更新節點的顏色索引\n            node.colorIndex = nextColorIndex;\n        }\n    });\n    \n    // 更新全局 currentColorIndex 以便新選中的節點使用\n    currentColorIndex = (currentColorIndex + 1) % COLOR_CLASSES.length;\n    \n    showStatusMessage(`已切換到下一個顏色`, 'success');\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "nodeColorIndex",
          "active": false
        },
        {
          "name": "nextColorIndex",
          "active": false
        },
        {
          "name": "isTransparent",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        },
        {
          "name": "colorClass",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1764,
        "lastUpdated": "2025-06-30T14:42:45.418Z"
      }
    },
    {
      "id": 200,
      "x": 3784.716158346274,
      "y": -461.67620404863965,
      "colorIndex": 0,
      "title": "copySelectedNodesContent",
      "content": "function copySelectedNodesContent() {\n  let allContent = '';\n  \n  selectedNodes.forEach(nodeId => {\n    const node = nodes[nodeId];\n    if (node) {\n      const popup = node.element.querySelector('.paragraph-popup');\n      const input = node.element.querySelector('.paragraph-input');\n      \n      if (popup) {\n        allContent += popup.textContent + '\\n\\n';\n      } else if (input) {\n        allContent += input.value + '\\n\\n';\n      }\n    }\n  });\n  \nif (allContent) {\n  const lineCount = allContent.split('\\n').filter(line => line.trim() !== '').length;\n  navigator.clipboard.writeText(allContent.trim())\n    .then(() => {\n      showStatusMessage(`已複製 ${selectedNodes.size} 個節點的內容 (共 ${lineCount} 行)`, 'success');\n    })\n    .catch(err => {\n      console.error('複製失敗:', err);\n      showStatusMessage('複製失敗', 'error');\n    });\n} else {\n  showStatusMessage('沒有可複製的內容', 'warning');\n}\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "allContent",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "input",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        },
        {
          "name": "lineCount",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 885,
        "lastUpdated": "2025-06-30T14:42:45.418Z"
      }
    },
    {
      "id": 201,
      "x": 3784.716158346274,
      "y": -414.37620404863947,
      "colorIndex": 0,
      "title": "selectNodeAndChildren",
      "content": "function selectNodeAndChildren(nodeId) {\n    // 選取當前節點\n    const node = nodes[nodeId];\n    if (!node) return;\n    \n    node.element.classList.add('selected');\n    selectedNodes.add(nodeId);\n    \n    // 找出所有直接子節點\n    const children = connections.filter(conn => conn.fromNode === nodeId)\n                               .map(conn => conn.toNode);\n    \n    // 遞歸選取子節點\n    children.forEach(childId => {\n        selectNodeAndChildren(childId);\n    });\n    \n    drawConnections();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "children",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "children",
          "active": false
        },
        {
          "name": "children",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 475,
        "lastUpdated": "2025-06-30T14:42:45.418Z"
      }
    },
    {
      "id": 202,
      "x": 3784.716158346274,
      "y": -367.07620404863974,
      "colorIndex": 0,
      "title": "toWorldX",
      "content": "// 視圖轉換函數\nfunction toWorldX(screenX) {\n  return (screenX / scale) + translateX;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 81,
        "lastUpdated": "2025-06-30T14:42:45.418Z"
      }
    },
    {
      "id": 203,
      "x": 3784.716158346274,
      "y": -319.77620404863956,
      "colorIndex": 0,
      "title": "toWorldY",
      "content": "function toWorldY(screenY) {\n  return (screenY / scale) + translateY;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 71,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 204,
      "x": 3784.716158346274,
      "y": -272.47620404863983,
      "colorIndex": 0,
      "title": "createNode",
      "content": "// 主函數\nfunction createNode(x, y, title = '節點', type = 'normal') {\n  if (type === 'group') {\n    const node = createGroupNodeElement(x, y, title);\n    const nodeData = initializeGroupNodeData(node, x, y);\n    setupGroupNodeEvents(node, nodeData);\n    return nodeData;\n  } else {\n    const node = createNodeElement(x, y, title);\n    const nodeData = initializeNodeData(node, x, y);\n    setupNodeDrag(node, nodeData);\n    setupCollapseButton(node, nodeData);\n    setupDeleteButton(node, nodeData);\n    setupTitleInput(node);\n    setupParagraphInput(node, nodeData);\n    setupInitialAddButton(node, nodeData);\n    setupAddItemButton(node, nodeData);\n    setupHideChildrenButton(node, nodeData);\n    setupGenerateButton(node, nodeData);\n    setupPortEvents(node, nodeData);\n    updateNodePosition(nodeData);\n      // 初始化變數分析框\n  setupVariableAnalysis(node, nodeData);\n    return nodeData;\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createGroupNodeElement",
        "initializeGroupNodeData",
        "setupGroupNodeEvents",
        "createNodeElement",
        "initializeNodeData",
        "setupNodeDrag",
        "setupCollapseButton",
        "setupDeleteButton",
        "setupTitleInput",
        "setupParagraphInput",
        "setupInitialAddButton",
        "setupAddItemButton",
        "setupHideChildrenButton",
        "setupGenerateButton",
        "setupPortEvents",
        "updateNodePosition",
        "setupVariableAnalysis"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 888,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 205,
      "x": 3784.716158346274,
      "y": -225.17620404863965,
      "colorIndex": 0,
      "title": "updatePopupScroll",
      "content": "// 更新彈出框的滾動位置\nfunction updatePopupScroll() {\n  if (activePopup) {\n    activePopup.scrollTop = popupScrollPosition;\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 120,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 206,
      "x": 3784.716158346274,
      "y": -177.87620404863935,
      "colorIndex": 0,
      "title": "clearSelection",
      "content": "// 清除选择\nfunction clearSelection() {\n  selectedNodes.forEach(id => {\n    const node = nodes[id];\n    if (node && node.element) {\n      node.element.classList.remove('selected');\n    }\n  });\n  selectedNodes.clear();\n  if (selectionBox) {\n    selectionBox.style.display = 'none';\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 282,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 207,
      "x": 3784.716158346274,
      "y": -130.57620404863917,
      "colorIndex": 0,
      "title": "findNodeByElement",
      "content": "// 辅助函数：通过元素查找节点\n  function findNodeByElement(element) {\n    return nodes.find(node => node.element === element);\n  }",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 117,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 208,
      "x": 3784.716158346274,
      "y": -83.27620404863933,
      "colorIndex": 0,
      "title": "applyTransform",
      "content": "function applyTransform() {\n  console.log('Applying transform:', {\n    translateX,\n    translateY,\n    scale,\n    screenCenterX: (window.innerWidth / 2 - translateX) / scale,\n    screenCenterY: (window.innerHeight / 2 - translateY) / scale\n  });\n  \n  transformContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  nodesContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  drawConnections();\n  updateNodeList();\n\n  updateMinimap();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections",
        "updateNodeList",
        "updateMinimap"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 535,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 209,
      "x": 4201.319158346275,
      "y": -538.9442040486383,
      "colorIndex": 0,
      "title": "createNode",
      "content": "// 主函數\nfunction createNode(x, y, title = '節點', type = 'normal') {\n  if (type === 'group') {\n    const node = createGroupNodeElement(x, y, title);\n    const nodeData = initializeGroupNodeData(node, x, y);\n    setupGroupNodeEvents(node, nodeData);\n    return nodeData;\n  } else {\n    const node = createNodeElement(x, y, title);\n    const nodeData = initializeNodeData(node, x, y);\n    setupNodeDrag(node, nodeData);\n    setupCollapseButton(node, nodeData);\n    setupDeleteButton(node, nodeData);\n    setupTitleInput(node);\n    setupParagraphInput(node, nodeData);\n    setupInitialAddButton(node, nodeData);\n    setupAddItemButton(node, nodeData);\n    setupHideChildrenButton(node, nodeData);\n    setupGenerateButton(node, nodeData);\n    setupPortEvents(node, nodeData);\n    updateNodePosition(nodeData);\n      // 初始化變數分析框\n  setupVariableAnalysis(node, nodeData);\n    return nodeData;\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "createGroupNodeElement",
        "initializeGroupNodeData",
        "setupGroupNodeEvents",
        "createNodeElement",
        "initializeNodeData",
        "setupNodeDrag",
        "setupCollapseButton",
        "setupDeleteButton",
        "setupTitleInput",
        "setupParagraphInput",
        "setupInitialAddButton",
        "setupAddItemButton",
        "setupHideChildrenButton",
        "setupGenerateButton",
        "setupPortEvents",
        "updateNodePosition",
        "setupVariableAnalysis"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 888,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 210,
      "x": 4199.988158346275,
      "y": -494.30620404863885,
      "colorIndex": 0,
      "title": "createSelectionBox",
      "content": "// 创建框选元素\nfunction createSelectionBox() {\n  selectionBox = document.createElement('div');\n  selectionBox.className = 'selection-box';\n  selectionBox.style.display = 'none';\n  document.body.appendChild(selectionBox);\n  return selectionBox;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 240,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 211,
      "x": 4199.988158346275,
      "y": -447.00620404863866,
      "colorIndex": 0,
      "title": "updateSelectionBox",
      "content": "// 更新框选区域\nfunction updateSelectionBox(x1, y1, x2, y2) {\n  const left = Math.min(x1, x2);\n  const top = Math.min(y1, y2);\n  const width = Math.abs(x2 - x1);\n  const height = Math.abs(y2 - y1);\n\nselectionBox.style.left = `${left}px`;\nselectionBox.style.top = `${top}px`;\nselectionBox.style.width = `${width}px`;\nselectionBox.style.height = `${height}px`;\n  selectionBox.style.display = 'block';\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "left",
          "active": false
        },
        {
          "name": "top",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "height",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 394,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 212,
      "x": 4199.988158346275,
      "y": -399.7062040486385,
      "colorIndex": 0,
      "title": "findNodeByElement",
      "content": "// 辅助函数：通过元素查找节点\n  function findNodeByElement(element) {\n    return nodes.find(node => node.element === element);\n  }",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 117,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 213,
      "x": 4199.988158346275,
      "y": -352.40620404863876,
      "colorIndex": 0,
      "title": "toWorldX",
      "content": "// 視圖轉換函數\nfunction toWorldX(screenX) {\n  return (screenX / scale) + translateX;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 81,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 214,
      "x": 4199.988158346275,
      "y": -305.1062040486386,
      "colorIndex": 0,
      "title": "toWorldY",
      "content": "function toWorldY(screenY) {\n  return (screenY / scale) + translateY;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 71,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 215,
      "x": 4199.988158346275,
      "y": -257.8062040486384,
      "colorIndex": 0,
      "title": "clearSelection",
      "content": "// 清除选择\nfunction clearSelection() {\n  selectedNodes.forEach(id => {\n    const node = nodes[id];\n    if (node && node.element) {\n      node.element.classList.remove('selected');\n    }\n  });\n  selectedNodes.clear();\n  if (selectionBox) {\n    selectionBox.style.display = 'none';\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 282,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 216,
      "x": 4199.988158346275,
      "y": -210.50620404863855,
      "colorIndex": 0,
      "title": "selectNodesInBox",
      "content": "// 选择节点\nfunction selectNodesInBox(selectionRect, additiveSelection = false) {\n    // 如果不是增減選擇模式，先清除選擇\n    if (!additiveSelection) {\n        clearSelection();\n    }\n\n    nodes.forEach(node => {\n        if (isNodeInSelection(node, selectionRect)) {\n            // 如果是增減選擇模式，切換選擇狀態\n            if (additiveSelection) {\n                if (selectedNodes.has(node.id)) {\n                    node.element.classList.remove('selected');\n                    selectedNodes.delete(node.id);\n                } else {\n                    node.element.classList.add('selected');\n                    selectedNodes.add(node.id);\n                }\n            } else {\n                // 普通模式，直接選擇\n                node.element.classList.add('selected');\n                selectedNodes.add(node.id);\n            }\n        }\n    });\n\n    return selectedNodes.size > 0;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "clearSelection"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 850,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 217,
      "x": 4199.988158346275,
      "y": -163.20620404863837,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\n    console.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3031,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 218,
      "x": 4199.988158346275,
      "y": -115.90620404863807,
      "colorIndex": 0,
      "title": "applyTransform",
      "content": "function applyTransform() {\n  console.log('Applying transform:', {\n    translateX,\n    translateY,\n    scale,\n    screenCenterX: (window.innerWidth / 2 - translateX) / scale,\n    screenCenterY: (window.innerHeight / 2 - translateY) / scale\n  });\n  \n  transformContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  nodesContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  drawConnections();\n  updateNodeList();\n\n  updateMinimap();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections",
        "updateNodeList",
        "updateMinimap"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 535,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 219,
      "x": 4199.988158346275,
      "y": -68.60620404863835,
      "colorIndex": 0,
      "title": "updateNodePosition",
      "content": "// 修改節點位置更新函數\nfunction updateNodePosition(node) {\nnode.element.style.left = `${node.x}px`;\nnode.element.style.top = `${node.y}px`;\n  node.element.style.transform = 'none'; // 確保節點不受容器縮放影響\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 189,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 220,
      "x": 4273.486001321481,
      "y": 323.9324075216085,
      "colorIndex": 0,
      "title": "setupNodeDrag",
      "content": "// 设置节点拖拽\nfunction setupNodeDrag(node, nodeData) {\n  node.addEventListener('mousedown', (e) => {\n    if (e.target.className.includes('node') || e.target.className === 'node-title') {\n      if (spacePressed || e.button === 1) return;\n\n      draggingNode = nodeData;\n      dragStartWorldX = toWorldX(e.clientX);\n      dragStartWorldY = toWorldY(e.clientY);\n      dragOffsetX = dragStartWorldX - nodeData.x;\n      dragOffsetY = dragStartWorldY - nodeData.y;\n\n      e.stopPropagation();\n    }\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "toWorldX",
        "toWorldY"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 496,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 221,
      "x": 4276.78600132148,
      "y": 362.4324075216085,
      "colorIndex": 0,
      "title": "setupCollapseButton",
      "content": "function setupCollapseButton(node, nodeData) {\n  const collapseBtn = node.querySelector('.collapse-btn');\n  collapseBtn.addEventListener('click', (e) => {\n    node.classList.toggle('collapsed');\n    \n    const collapsible = node.querySelector('.collapsible');\n    const originalPorts = node.querySelectorAll('.output-port:not(.header-port)');\n    const headerPort = node.querySelector('.header-port');\n    \n    if (node.classList.contains('collapsed')) {\n      originalPorts.forEach(port => port.style.display = 'none');\n      if (!headerPort) {\n        const port = document.createElement('div');\n        port.className = 'output-port header-port';\n        port.dataset.type = 'output';\n        port.style.display = 'block';\n        node.querySelector('.node-header').appendChild(port);\n      } else {\n        headerPort.style.display = 'block';\n      }\n      collapseBtn.textContent = '+';\n    } else {\n      originalPorts.forEach(port => port.style.display = 'block');\n      if (headerPort) headerPort.style.display = 'none';\n      collapseBtn.textContent = '-';\n    }\n    \n    drawConnections();\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections"
      ],
      "variableStates": [
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "collapseBtn",
          "active": false
        },
        {
          "name": "collapsible",
          "active": false
        },
        {
          "name": "originalPorts",
          "active": false
        },
        {
          "name": "headerPort",
          "active": false
        },
        {
          "name": "port",
          "active": false
        },
        {
          "name": "port",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1132,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 222,
      "x": 4277.886001321481,
      "y": 410.83240752160725,
      "colorIndex": 0,
      "title": "setupDeleteButton",
      "content": "// 修改刪除節點函數\nfunction setupDeleteButton(node, nodeData) {\n  node.querySelector('.delete-node-btn').addEventListener('click', (e) => {\n    // 移除所有與該節點相關的連接\n    connections = connections.filter(conn =>\n    conn.fromNode !== nodeData.id && conn.toNode !== nodeData.id\n    );\n\n    // 重新索引節點ID\n    nodes = nodes.filter(n => n.id !== nodeData.id);\n    nodes.forEach((n, index) => {\n      n.id = index; // 重新分配連續的ID\n    });\n\n    // 更新連接中的節點ID引用\n    connections.forEach(conn => {\n      if (conn.fromNode > nodeData.id) conn.fromNode--;\n      if (conn.toNode > nodeData.id) conn.toNode--;\n    });\n\n    node.remove();\n    drawConnections();\n    updateSameNameHighlights(); // 刪除後更新高亮\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections",
        "updateSameNameHighlights"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 705,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 223,
      "x": 4274.58600132148,
      "y": 458.13240752160743,
      "colorIndex": 0,
      "title": "setupUngroupButton",
      "content": "function setupUngroupButton(node, nodeData) {\n  const ungroupBtn = node.querySelector('.ungroup-btn');\n  if (!ungroupBtn) return;\n  \n  // 移除現有事件監聽器\n  ungroupBtn.replaceWith(ungroupBtn.cloneNode(true));\n  const newUngroupBtn = node.querySelector('.ungroup-btn');\n  \n  newUngroupBtn.addEventListener('click', (e) => {\n    ungroupNodes(nodeData);\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "ungroupNodes"
      ],
      "variableStates": [
        {
          "name": "ungroupBtn",
          "active": false
        },
        {
          "name": "newUngroupBtn",
          "active": false
        },
        {
          "name": "ungroupBtn",
          "active": false
        },
        {
          "name": "ungroupBtn",
          "active": false
        },
        {
          "name": "newUngroupBtn",
          "active": false
        },
        {
          "name": "newUngroupBtn",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 376,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 224,
      "x": 4275.68600132148,
      "y": 787.032407521607,
      "colorIndex": 0,
      "title": "setupTitleInput",
      "content": "// 设置标题输入\nfunction setupTitleInput(node) {\n  const titleInput = node.querySelector('.node-title');\n  titleInput.addEventListener('input', () => {\n    titleInput.value = titleInput.value.trim();\n    \n    // 檢查是否有相同名稱的節點已經有描述\n    const nodeData = findNodeByElement(node);\n    if (nodeData) {\n      const sameNameNodes = nodes.filter(n => \n        n.id !== nodeData.id &&\n        n.element.querySelector('.node-title').value === titleInput.value\n      );\n      \n      if (sameNameNodes.length > 0 && !nodeDescriptions[nodeData.id]) {\n        // 使用第一個同名節點的描述\n        const firstSameNameNode = sameNameNodes[0];\n        if (nodeDescriptions[firstSameNameNode.id]) {\n          nodeDescriptions[nodeData.id] = nodeDescriptions[firstSameNameNode.id];\n          updateNodeList(); // 觸發更新\n        }\n      }\n    }\n    \n    updateSameNameHighlights();\n   \n    if (nodeData) {\n      nodeData.jumpIndex = 0;\n      updateJumpButton(nodeData);\n    }\n    nodes.forEach(n => updateJumpButton(n));\n  });\n\n  const nodeData = findNodeByElement(node);\n  if (nodeData) {\n    updateJumpButton(nodeData);\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "findNodeByElement",
        "updateNodeList",
        "updateSameNameHighlights",
        "updateJumpButton"
      ],
      "variableStates": [
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        },
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "titleInput",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "sameNameNodes",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        },
        {
          "name": "firstSameNameNode",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1085,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 225,
      "x": 4283.386001321479,
      "y": 829.9324075216084,
      "colorIndex": 0,
      "title": "setupPortEvents",
      "content": "// 设置端口事件\nfunction setupPortEvents(node, nodeData) {\n  // 输入端口\n  node.querySelector('.input-port').addEventListener('mouseup', (e) => {\n    if (connecting) {\n      connections.push( {\n        fromNode: connecting.fromNode,\n        fromOutput: connecting.fromOutput,\n        toNode: nodeData.id\n      });\n      connecting = null;\n      container.classList.remove('connecting');\n      drawConnections();\n    }\n  });\n\n  // 初始输出端口\n  setupOutputPort(node.querySelector('.output-port'), nodeData, 0);\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "drawConnections",
        "setupOutputPort"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 496,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 226,
      "x": 4540.78600132148,
      "y": 481.2324075216061,
      "colorIndex": 0,
      "title": "ungroupNodes",
      "content": "// Ungroup nodes\nfunction ungroupNodes(groupNode) {\n  if (!groupNode || !groupNode.isGroupNode) return;\n  \n  try {\n    // 1. 恢復被包含節點的可見性\n    groupNode.containedNodes.forEach(nodeId => {\n      const node = nodes[nodeId];\n      if (node) {\n        node.element.style.display = ''; // 恢復顯示\n      }\n    });\n    \n    // 2. 恢復原始連接\n    // 先移除所有與群組節點相關的連接\n    connections = connections.filter(conn => \n      conn.fromNode !== groupNode.id && conn.toNode !== groupNode.id\n    );\n    \n    // 恢復原始連接\n    groupNode.originalConnections.forEach(connData => {\n      // 恢復進入該節點的連接\n      connData.incoming.forEach(conn => {\n        connections.push({\n          fromNode: conn.fromNode,\n          fromOutput: conn.fromOutput,\n          toNode: connData.nodeId\n        });\n      });\n      \n      // 恢復從該節點出去的連接\n      connData.outgoing.forEach(conn => {\n        connections.push({\n          fromNode: connData.nodeId,\n          fromOutput: conn.fromOutput,\n          toNode: conn.toNode\n        });\n      });\n    });\n    \n    // 3. 從節點列表中移除群組節點\n    const index = nodes.findIndex(n => n.id === groupNode.id);\n    if (index !== -1) {\n      nodes.splice(index, 1);\n      groupNode.element.remove();\n    }\n    \n    // 4. 重新索引節點ID\n    nodes.forEach((n, i) => {\n      n.id = i;\n    });\n    \n    // 5. 更新連接中的節點ID引用\n    connections.forEach(conn => {\n      if (conn.fromNode > groupNode.id) conn.fromNode--;\n      if (conn.toNode > groupNode.id) conn.toNode--;\n    });\n    \n    drawConnections();\n    updateNodeList();\n    showStatusMessage('群組已成功解散', 'success');\n  } catch (error) {\n    console.error('解散群組失敗:', error);\n    showStatusMessage('解散群組時發生錯誤', 'error');\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": true,
      "isCollapsed": false,
      "items": [
        "drawConnections",
        "updateNodeList"
      ],
      "variableStates": [
        {
          "name": "node",
          "active": false
        },
        {
          "name": "index",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "index",
          "active": false
        },
        {
          "name": "index",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1642,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 227,
      "x": 4760.78600132148,
      "y": 481.2324075216061,
      "colorIndex": 0,
      "title": "drawConnections",
      "content": "function drawConnections() {\n    console.log(\"Current connections:\", JSON.parse(JSON.stringify(connections)));\n  console.log(\"Current node outputs:\", nodes.map(n => ({\n    id: n.id, \n    outputs: n.outputs,\n    ports: Array.from(n.element.querySelectorAll('.output-port')).map(p => ({\n      outputIndex: p.dataset.outputIndex,\n      originalIndex: p.dataset.originalIndex\n    }))\n  })));\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n  // 先繪製非折疊節點的連接\n  connections.forEach(conn => {\n    const fromNode = nodes[conn.fromNode];\n    const toNode = nodes[conn.toNode];\n    \n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector('.header-port');\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[conn.fromOutput];\n    }\n    \n    const toPort = toNode.element.querySelector('.input-port');\n    if (!fromPort || !toPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const toRect = toPort.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    const startX = fromRect.left + fromRect.width / 2 - containerRect.left;\n    const startY = fromRect.top + fromRect.height / 2 - containerRect.top;\n    const endX = toRect.left + toRect.width / 2 - containerRect.left;\n    const endY = toRect.top + toRect.height / 2 - containerRect.top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    \n    if (fromNode.element.classList.contains('collapsed')) {\n      const controlOffset = 100 + (conn.fromOutput * 15);\n      ctx.bezierCurveTo(\n        startX + controlOffset, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    } else {\n      ctx.bezierCurveTo(\n        startX + 100, startY,\n        endX - 100, endY,\n        endX, endY\n      );\n    }\n    \n    // 根據是否高亮設置不同顏色\n    ctx.strokeStyle = conn.highlighted ? '#4a90e2' : '#888';\n    ctx.lineWidth = conn.highlighted ? 3 : 2;\n    ctx.stroke();\n  });\n\n  // 繪製正在連接中的線條\n  if (connecting) {\n    const fromNode = nodes[connecting.fromNode];\n    let fromPort;\n    if (fromNode.element.classList.contains('collapsed')) {\n      fromPort = fromNode.element.querySelector(`.header-port[data-output-index=\"${connecting.fromOutput}\"]`);\n    } else {\n      fromPort = fromNode.element.querySelectorAll('.output-port:not(.header-port)')[connecting.fromOutput];\n    }\n\n    if (!fromPort) return;\n\n    const fromRect = fromPort.getBoundingClientRect();\n    const startX = fromRect.left + fromRect.width / 2 - container.getBoundingClientRect().left;\n    const startY = fromRect.top + fromRect.height / 2 - container.getBoundingClientRect().top;\n    const endX = connecting.currentX - container.getBoundingClientRect().left;\n    const endY = connecting.currentY - container.getBoundingClientRect().top;\n\n    ctx.beginPath();\n    ctx.moveTo(startX, startY);\n    ctx.lineTo(endX, endY);\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 2 * (1/scale);\n    ctx.stroke();\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "項目 1"
      ],
      "variableStates": [
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "fromNode",
          "active": false
        },
        {
          "name": "toNode",
          "active": false
        },
        {
          "name": "fromPort",
          "active": false
        },
        {
          "name": "toPort",
          "active": false
        },
        {
          "name": "fromRect",
          "active": false
        },
        {
          "name": "toRect",
          "active": false
        },
        {
          "name": "containerRect",
          "active": false
        },
        {
          "name": "startX",
          "active": false
        },
        {
          "name": "startY",
          "active": false
        },
        {
          "name": "endX",
          "active": false
        },
        {
          "name": "endY",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        },
        {
          "name": "controlOffset",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 3031,
        "lastUpdated": "2025-06-30T14:42:45.419Z"
      }
    },
    {
      "id": 228,
      "x": 4760.78600132148,
      "y": 528.5324075216062,
      "colorIndex": 0,
      "title": "updateNodeList",
      "content": "// 更新節點列表 - 優化版本\nfunction updateNodeList() {\n  const nodeList = document.getElementById('node-list');\n  if (!nodeList) return;\n  \n  requestAnimationFrame(() => {\n    const visibleNodes = getVisibleNodes();\n    const visibleNodeIds = visibleNodes.map(n => n.id).join(',');\n    const lastVisibleNodeIds = (lastVisibleNodes || []).map(n => n.id).join(',');\n    \n    if (visibleNodeIds === lastVisibleNodeIds) return;\n    \n    saveCurrentDescriptions();\n    \n    // 建立節點名稱到描述的映射\n    const nameToDescriptionMap = {};\n    nodes.forEach(node => {\n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      if (nodeDescriptions[node.id] && nodeDescriptions[node.id].trim() !== '') {\n        // 如果這個節點有描述，記錄到映射中\n        nameToDescriptionMap[title] = nodeDescriptions[node.id];\n      }\n    });\n    \n    const fragment = document.createDocumentFragment();\n    \n    visibleNodes.forEach(node => {\n      const nodeElement = document.createElement('div');\n      nodeElement.className = 'node-list-item';\n      \n      const title = node.element.querySelector('.node-title')?.value || '未命名節點';\n      \n      // 檢查是否有相同名稱的節點已經有描述\n      let description = nodeDescriptions[node.id] || '';\n      if (!description.trim() && nameToDescriptionMap[title]) {\n        // 如果當前節點沒有描述，但相同名稱的節點有描述，則使用該描述\n        description = nameToDescriptionMap[title];\n        nodeDescriptions[node.id] = description; // 更新節點描述資料\n      }\n      \n      nodeElement.innerHTML = `\n        <div class=\"node-list-name\">${escapeHtml(title)}</div>\n        <textarea class=\"node-list-description\" data-node-id=\"${node.id}\" \n          placeholder=\"輸入節點描述...\">${escapeHtml(description)}</textarea>\n      `;\n      \n      const descInput = nodeElement.querySelector('.node-list-description');\n      descInput.addEventListener('input', () => {\n        const newDescription = descInput.value;\n        nodeDescriptions[descInput.dataset.nodeId] = newDescription;\n        \n        // 當描述變更時，更新所有同名節點的描述\n        if (newDescription.trim() !== '') {\n          const currentTitle = node.element.querySelector('.node-title')?.value || '未命名節點';\n          nodes.forEach(n => {\n            const nTitle = n.element.querySelector('.node-title')?.value || '未命名節點';\n            if (nTitle === currentTitle && n.id !== node.id) {\n              nodeDescriptions[n.id] = newDescription;\n            }\n          });\n           syncDescriptionsForSameNameNodes(descInput.dataset.nodeId);\n          // 觸發重新渲染節點列表\n          updateNodeList();\n        }\n      });\n      \n      fragment.appendChild(nodeElement);\n    });\n    \n    nodeList.innerHTML = '';\n    nodeList.appendChild(fragment);\n    lastVisibleNodes = visibleNodes;\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": true,
      "items": [
        "getVisibleNodes",
        "saveCurrentDescriptions",
        "escapeHtml",
        "syncDescriptionsForSameNameNodes"
      ],
      "variableStates": [
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nodeList",
          "active": false
        },
        {
          "name": "visibleNodes",
          "active": false
        },
        {
          "name": "visibleNodeIds",
          "active": false
        },
        {
          "name": "lastVisibleNodeIds",
          "active": false
        },
        {
          "name": "nameToDescriptionMap",
          "active": false
        },
        {
          "name": "title",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "nodeElement",
          "active": false
        },
        {
          "name": "description",
          "active": false
        },
        {
          "name": "descInput",
          "active": false
        },
        {
          "name": "newDescription",
          "active": false
        },
        {
          "name": "currentTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        },
        {
          "name": "nTitle",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 2681,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    },
    {
      "id": 229,
      "x": -315.8430105000002,
      "y": -1120.720911900003,
      "colorIndex": 0,
      "title": "analyzeVariables",
      "content": "// 新增變數分析函數\nfunction analyzeVariables(nodeData) {\n  // 獲取內容來源，優先使用 paragraph-btn 的原始內容\n  let content = '';\n  const paragraphBtn = nodeData.element.querySelector('.paragraph-btn');\n  const paragraphInput = nodeData.element.querySelector('.paragraph-input');\n  \n  if (paragraphBtn && paragraphBtn.dataset.originalContent) {\n    content = paragraphBtn.dataset.originalContent;\n  } else if (paragraphInput) {\n    content = paragraphInput.value;\n  }\n  \n  const variableAnalysisContent = nodeData.element.querySelector('.variable-analysis-content');\n  \n  // 清空現有內容\n  variableAnalysisContent.innerHTML = '';\n  \n  // 提取所有 const 和 let 聲明的變數\n  const variableRegex = /(?:const|let)\\s+([a-zA-Z_$][0-9a-zA-Z_$]*)/g;\n  const variables = new Set();\n  let match;\n  \n  while ((match = variableRegex.exec(content)) !== null) {\n    variables.add(match[1]);\n  }\n  \n  // 如果沒有找到變數，顯示提示\n  if (variables.size === 0) {\n    variableAnalysisContent.innerHTML = '<div class=\"no-variables-message\">未找到變數聲明</div>';\n    return;\n  }\n  \n  // 為每個變數創建一個按鈕\n  variables.forEach(variable => {\n    const variableBtn = document.createElement('button');\n    variableBtn.className = 'variable-btn';\n    variableBtn.textContent = variable;\n    variableBtn.dataset.variableName = variable;\n    variableBtn.dataset.active = 'false';\n    \n    variableBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      toggleVariableHighlight(variable, nodeData, variableBtn);\n    });\n    \n    variableAnalysisContent.appendChild(variableBtn);\n  });\n  \n  // 確保內容是可見的\n  const analysisContainer = nodeData.element.querySelector('.variable-analysis-container');\n  if (analysisContainer) {\n    analysisContainer.style.display = 'block';\n    variableAnalysisContent.style.display = 'block';\n  }\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "toggleVariableHighlight"
      ],
      "variableStates": [
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "paragraphBtn",
          "active": false
        },
        {
          "name": "paragraphInput",
          "active": false
        },
        {
          "name": "variableAnalysisContent",
          "active": false
        },
        {
          "name": "variableRegex",
          "active": false
        },
        {
          "name": "variables",
          "active": false
        },
        {
          "name": "match",
          "active": false
        },
        {
          "name": "variableBtn",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        },
        {
          "name": "analysisContainer",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1749,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    },
    {
      "id": 230,
      "x": -319.1430105000004,
      "y": -702.720911900003,
      "colorIndex": 0,
      "title": "initializeGroupNodeData",
      "content": "// 修改後的 initializeGroupNodeData 函數，確保正確初始化連接數據\nfunction initializeGroupNodeData(node, x, y, containedNodes = []) {\n  const nodeData = {\n    element: node,\n    id: nodes.length,\n    outputs: [0],\n    x,\n    y,\n    jumpIndex: 0,\n    isGroupNode: true,\n    containedNodes: containedNodes,\n    originalConnections: [],  // 保存原始連接\n    incomingConnections: [],  // 進入群組的連接\n    outgoingConnections: []   // 離開群組的連接\n  };\n  \n  // 保存所有被包含節點的原始連接\n  containedNodes.forEach(nodeId => {\n    const originalNode = nodes[nodeId];\n    if (originalNode) {\n      const nodeConnections = {\n        nodeId: originalNode.id,\n        incoming: [],\n        outgoing: []\n      };\n      \n      // 收集進入該節點的連接\n      connections.forEach(conn => {\n        if (conn.toNode === originalNode.id) {\n          nodeConnections.incoming.push({\n            fromNode: conn.fromNode,\n            fromOutput: conn.fromOutput,\n            toNode: conn.toNode\n          });\n        }\n      });\n      \n      // 收集從該節點出去的連接\n      connections.forEach(conn => {\n        if (conn.fromNode === originalNode.id) {\n          nodeConnections.outgoing.push({\n            fromNode: conn.fromNode,\n            fromOutput: conn.fromOutput,\n            toNode: conn.toNode\n          });\n        }\n      });\n      \n      nodeData.originalConnections.push(nodeConnections);\n    }\n  });\n  \n  nodes.push(nodeData);\n  updateGroupNodeInfo(nodeData);\n  \n  // 設置跳轉按鈕\n  const jumpBtn = node.querySelector('.jump-to-btn');\n  jumpBtn.addEventListener('click', (e) => {\n    jumpToSameNameNode(nodeData);\n    e.stopPropagation();\n  });\n\n  return nodeData;\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "updateGroupNodeInfo",
        "jumpToSameNameNode"
      ],
      "variableStates": [
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "nodeData",
          "active": false
        },
        {
          "name": "originalNode",
          "active": false
        },
        {
          "name": "nodeConnections",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        },
        {
          "name": "jumpBtn",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1586,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    },
    {
      "id": 231,
      "x": -302.6430105000006,
      "y": -1578.320911900003,
      "colorIndex": 0,
      "title": "setupUngroupButton",
      "content": "// Setup ungroup button\nfunction setupUngroupButton(node, nodeData) {\n  const ungroupBtn = node.querySelector('.ungroup-btn');\n  if (!ungroupBtn) return;\n  \n  // 移除現有事件監聽器\n  ungroupBtn.replaceWith(ungroupBtn.cloneNode(true));\n  const newUngroupBtn = node.querySelector('.ungroup-btn');\n  \n  newUngroupBtn.addEventListener('click', (e) => {\n    ungroupNodes(nodeData);\n    e.stopPropagation();\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "ungroupNodes"
      ],
      "variableStates": [
        {
          "name": "ungroupBtn",
          "active": false
        },
        {
          "name": "newUngroupBtn",
          "active": false
        },
        {
          "name": "ungroupBtn",
          "active": false
        },
        {
          "name": "ungroupBtn",
          "active": false
        },
        {
          "name": "newUngroupBtn",
          "active": false
        },
        {
          "name": "newUngroupBtn",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 400,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    },
    {
      "id": 232,
      "x": 3922.180669971074,
      "y": -1626.2161757016543,
      "colorIndex": 0,
      "title": "highlightVariableInPopup",
      "content": "function highlightVariableInPopup(variableName, nodeData) {\n  // 獲取彈出框元素\n  const popup = nodeData.element.querySelector('.paragraph-popup');\n  if (!popup) return;\n\n  // 清除之前的高亮\n  const existingHighlights = popup.querySelectorAll('.variable-highlight');\n  existingHighlights.forEach(el => {\n    const parent = el.parentNode;\n    parent.replaceChild(document.createTextNode(el.textContent), el);\n    parent.normalize(); // 合併相鄰的文本節點\n  });\n\n  // 創建正則表達式來匹配變數名稱（確保是完整的單詞）\n  const regex = new RegExp(`\\\\b${escapeRegExp(variableName)}\\\\b`, 'g');\n\n  // 遍歷彈出框的所有文本節點\n  const walker = document.createTreeWalker(popup, NodeFilter.SHOW_TEXT);\n  const textNodes = [];\n  let node;\n  while (node = walker.nextNode()) {\n    if (node.nodeValue.trim() && regex.test(node.nodeValue)) {\n      textNodes.push(node);\n    }\n  }\n\n  // 高亮匹配的文本\n  textNodes.forEach(textNode => {\n    const parent = textNode.parentNode;\n    if (parent.nodeName === 'SPAN' && parent.classList.contains('variable-highlight')) {\n      return; // 已經是高亮狀態，跳過\n    }\n\n    const content = textNode.nodeValue;\n    const newContent = content.replace(regex, match => {\n      return `<span class=\"variable-highlight\">${match}</span>`;\n    });\n\n    const temp = document.createElement('div');\n    temp.innerHTML = newContent;\n    \n    // 替換原始文本節點\n    const fragment = document.createDocumentFragment();\n    while (temp.firstChild) {\n      fragment.appendChild(temp.firstChild);\n    }\n    \n    parent.replaceChild(fragment, textNode);\n  });\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "createTreeWalker"
      ],
      "variableStates": [
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "popup",
          "active": false
        },
        {
          "name": "existingHighlights",
          "active": false
        },
        {
          "name": "parent",
          "active": false
        },
        {
          "name": "regex",
          "active": false
        },
        {
          "name": "walker",
          "active": false
        },
        {
          "name": "textNodes",
          "active": false
        },
        {
          "name": "node",
          "active": false
        },
        {
          "name": "content",
          "active": false
        },
        {
          "name": "newContent",
          "active": false
        },
        {
          "name": "temp",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        },
        {
          "name": "fragment",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1485,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    },
    {
      "id": 233,
      "x": 2329.779213718175,
      "y": 2465.5900901662403,
      "colorIndex": 0,
      "title": "container.addEventListener('wheel', (e) =>",
      "content": "// 滾輪縮放\ncontainer.addEventListener('wheel', (e) => {\n  e.preventDefault();\n\n  // 獲取鼠標位置相對於視口的坐標\n  const mouseX = e.clientX;\n  const mouseY = e.clientY;\n\n  // 計算縮放前的世界坐標\n  const worldX = (mouseX - translateX) / scale;\n  const worldY = (mouseY - translateY) / scale;\n\n  // 計算新的縮放比例（保持原有方向邏輯）\n  const delta = -e.deltaY;\n  const newScale = delta > 0 ? scale * 1.1 : scale / 1.1;\n  scale = Math.min(Math.max(0.1, newScale), 3);\n\n  // 計算新的平移值 - 保持鼠標下的點在相同位置\n  translateX = mouseX - worldX * scale;\n  translateY = mouseY - worldY * scale;\n\n  // 應用變換\n  applyTransform();\n});",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "applyTransform"
      ],
      "variableStates": [
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "mouseX",
          "active": false
        },
        {
          "name": "mouseY",
          "active": false
        },
        {
          "name": "worldX",
          "active": false
        },
        {
          "name": "worldY",
          "active": false
        },
        {
          "name": "delta",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        },
        {
          "name": "newScale",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 566,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    },
    {
      "id": 234,
      "x": 2606.1428500818115,
      "y": 2472.8628174389673,
      "colorIndex": 0,
      "title": "applyTransform",
      "content": "function applyTransform() {\n  console.log('Applying transform:', {\n    translateX,\n    translateY,\n    scale,\n    screenCenterX: (window.innerWidth / 2 - translateX) / scale,\n    screenCenterY: (window.innerHeight / 2 - translateY) / scale\n  });\n  \n  transformContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  nodesContainer.style.transform = `\n    translate(${translateX}px, ${translateY}px)\n    scale(${scale})\n  `;\n  drawConnections();\n  updateNodeList();\n\n  updateMinimap();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "drawConnections",
        "updateNodeList",
        "updateMinimap"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 535,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    },
    {
      "id": 235,
      "x": -1209.845455900001,
      "y": -109.83583020000026,
      "colorIndex": 0,
      "title": "initMinimap",
      "content": "// 初始化小地圖\nfunction initMinimap() {\n  minimapCanvas.width = minimapCanvas.offsetWidth;\n  minimapCanvas.height = minimapCanvas.offsetHeight;\n  updateMinimap();\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "updateMinimap"
      ],
      "variableStates": [],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 159,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    },
    {
      "id": 236,
      "x": -897.8454559000011,
      "y": -74.83583020000037,
      "colorIndex": 0,
      "title": "updateMinimap",
      "content": "// 更新小地圖\nfunction updateMinimap() {\n  if (!nodes.length) return;\n  \n  // 計算所有節點的邊界\n  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n  nodes.forEach(node => {\n    minX = Math.min(minX, node.x);\n    minY = Math.min(minY, node.y);\n    maxX = Math.max(maxX, node.x + 200); // 假設節點寬度為200\n    maxY = Math.max(maxY, node.y + getNodeHeight(node.element));\n  });\n  \n  // 添加邊距\n  const padding = 50;\n  minX -= padding;\n  minY -= padding;\n  maxX += padding;\n  maxY += padding;\n  \n  // 計算縮放比例\n  const width = maxX - minX;\n  const height = maxY - minY;\n  const scaleX = minimapCanvas.width / width;\n  const scaleY = minimapCanvas.height / height;\n  const scale = Math.min(scaleX, scaleY);\n  \n  // 清空畫布\n  minimapCtx.clearRect(0, 0, minimapCanvas.width, minimapCanvas.height);\n  \n  // 繪製所有節點\n  nodes.forEach(node => {\n    const x = (node.x - minX) * scale;\n    const y = (node.y - minY) * scale;\n    const nodeWidth = 200 * scale;\n    const nodeHeight = getNodeHeight(node.element) * scale;\n    \n    // 繪製節點矩形\n    minimapCtx.fillStyle = 'rgba(255, 255, 255, 0.3)';\n    minimapCtx.fillRect(x, y, nodeWidth, nodeHeight);\n    \n    // 繪製邊框\n    minimapCtx.strokeStyle = 'rgba(255, 255, 255, 0.5)';\n    minimapCtx.lineWidth = 1;\n    minimapCtx.strokeRect(x, y, nodeWidth, nodeHeight);\n  });\n  \n  // 更新視口指示器\n  updateViewportIndicator(minX, minY, scale);\n}",
      "description": "",
      "isConvertedToButton": true,
      "isChildrenHidden": false,
      "isCollapsed": false,
      "items": [
        "getNodeHeight",
        "updateViewportIndicator"
      ],
      "variableStates": [
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "minX",
          "active": false
        },
        {
          "name": "padding",
          "active": false
        },
        {
          "name": "width",
          "active": false
        },
        {
          "name": "height",
          "active": false
        },
        {
          "name": "scaleX",
          "active": false
        },
        {
          "name": "scaleY",
          "active": false
        },
        {
          "name": "scale",
          "active": false
        },
        {
          "name": "x",
          "active": false
        },
        {
          "name": "y",
          "active": false
        },
        {
          "name": "nodeWidth",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        },
        {
          "name": "nodeHeight",
          "active": false
        }
      ],
      "variableAnalysisExpanded": false,
      "metadata": {
        "contentLength": 1359,
        "lastUpdated": "2025-06-30T14:42:45.420Z"
      }
    }
  ],
  "connections": [
    {
      "fromNode": 0,
      "fromOutput": 0,
      "toNode": 1,
      "highlighted": false
    },
    {
      "fromNode": 0,
      "fromOutput": 2,
      "toNode": 2,
      "highlighted": false
    },
    {
      "fromNode": 0,
      "fromOutput": 1,
      "toNode": 54,
      "highlighted": false
    },
    {
      "fromNode": 0,
      "fromOutput": 3,
      "toNode": 85,
      "highlighted": false
    },
    {
      "fromNode": 0,
      "fromOutput": 4,
      "toNode": 91,
      "highlighted": false
    },
    {
      "fromNode": 93,
      "fromOutput": 0,
      "toNode": 96,
      "highlighted": false
    },
    {
      "fromNode": 93,
      "fromOutput": 1,
      "toNode": 97,
      "highlighted": false
    },
    {
      "fromNode": 0,
      "fromOutput": 6,
      "toNode": 98,
      "highlighted": false
    },
    {
      "fromNode": 0,
      "fromOutput": 7,
      "toNode": 104,
      "highlighted": false
    },
    {
      "fromNode": 104,
      "fromOutput": 0,
      "toNode": 105,
      "highlighted": false
    },
    {
      "fromNode": 104,
      "fromOutput": 1,
      "toNode": 114,
      "highlighted": false
    },
    {
      "fromNode": 104,
      "fromOutput": 2,
      "toNode": 115,
      "highlighted": false
    },
    {
      "fromNode": 115,
      "fromOutput": 0,
      "toNode": 116,
      "highlighted": false
    },
    {
      "fromNode": 104,
      "fromOutput": 3,
      "toNode": 117,
      "highlighted": false
    },
    {
      "fromNode": 117,
      "fromOutput": 0,
      "toNode": 118,
      "highlighted": false
    },
    {
      "fromNode": 117,
      "fromOutput": 1,
      "toNode": 119,
      "highlighted": false
    },
    {
      "fromNode": 117,
      "fromOutput": 2,
      "toNode": 120,
      "highlighted": false
    },
    {
      "fromNode": 117,
      "fromOutput": 3,
      "toNode": 121,
      "highlighted": false
    },
    {
      "fromNode": 117,
      "fromOutput": 4,
      "toNode": 122,
      "highlighted": false
    },
    {
      "fromNode": 117,
      "fromOutput": 5,
      "toNode": 123,
      "highlighted": false
    },
    {
      "fromNode": 104,
      "fromOutput": 4,
      "toNode": 124,
      "highlighted": false
    },
    {
      "fromNode": 104,
      "fromOutput": 5,
      "toNode": 125,
      "highlighted": false
    },
    {
      "fromNode": 124,
      "fromOutput": 0,
      "toNode": 126,
      "highlighted": false
    },
    {
      "fromNode": 124,
      "fromOutput": 1,
      "toNode": 127,
      "highlighted": false
    },
    {
      "fromNode": 124,
      "fromOutput": 2,
      "toNode": 128,
      "highlighted": false
    },
    {
      "fromNode": 125,
      "fromOutput": 0,
      "toNode": 129,
      "highlighted": false
    },
    {
      "fromNode": 125,
      "fromOutput": 1,
      "toNode": 130,
      "highlighted": false
    },
    {
      "fromNode": 125,
      "fromOutput": 2,
      "toNode": 131,
      "highlighted": false
    },
    {
      "fromNode": 125,
      "fromOutput": 3,
      "toNode": 132,
      "highlighted": false
    },
    {
      "fromNode": 125,
      "fromOutput": 4,
      "toNode": 133,
      "highlighted": false
    },
    {
      "fromNode": 125,
      "fromOutput": 5,
      "toNode": 134,
      "highlighted": false
    },
    {
      "fromNode": 138,
      "fromOutput": 0,
      "toNode": 144,
      "highlighted": false
    },
    {
      "fromNode": 138,
      "fromOutput": 1,
      "toNode": 145,
      "highlighted": false
    },
    {
      "fromNode": 138,
      "fromOutput": 2,
      "toNode": 146,
      "highlighted": false
    },
    {
      "fromNode": 138,
      "fromOutput": 3,
      "toNode": 147,
      "highlighted": false
    },
    {
      "fromNode": 166,
      "fromOutput": 0,
      "toNode": 167,
      "highlighted": false
    },
    {
      "fromNode": 166,
      "fromOutput": 1,
      "toNode": 168,
      "highlighted": false
    },
    {
      "fromNode": 166,
      "fromOutput": 2,
      "toNode": 169,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 1,
      "toNode": 106,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 2,
      "toNode": 107,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 3,
      "toNode": 108,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 4,
      "toNode": 109,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 5,
      "toNode": 110,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 6,
      "toNode": 111,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 7,
      "toNode": 112,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 8,
      "toNode": 113,
      "highlighted": false
    },
    {
      "fromNode": 105,
      "fromOutput": 0,
      "toNode": 178,
      "highlighted": false
    },
    {
      "fromNode": 178,
      "fromOutput": 0,
      "toNode": 179,
      "highlighted": false
    },
    {
      "fromNode": 178,
      "fromOutput": 1,
      "toNode": 180,
      "highlighted": false
    },
    {
      "fromNode": 178,
      "fromOutput": 2,
      "toNode": 181,
      "highlighted": false
    },
    {
      "fromNode": 178,
      "fromOutput": 3,
      "toNode": 182,
      "highlighted": false
    },
    {
      "fromNode": 178,
      "fromOutput": 4,
      "toNode": 183,
      "highlighted": false
    },
    {
      "fromNode": 178,
      "fromOutput": 5,
      "toNode": 184,
      "highlighted": false
    },
    {
      "fromNode": 178,
      "fromOutput": 6,
      "toNode": 185,
      "highlighted": false
    },
    {
      "fromNode": 178,
      "fromOutput": 7,
      "toNode": 186,
      "highlighted": false
    },
    {
      "fromNode": 184,
      "fromOutput": 0,
      "toNode": 187,
      "highlighted": false
    },
    {
      "fromNode": 184,
      "fromOutput": 1,
      "toNode": 188,
      "highlighted": false
    },
    {
      "fromNode": 164,
      "fromOutput": 0,
      "toNode": 189,
      "highlighted": false
    },
    {
      "fromNode": 164,
      "fromOutput": 1,
      "toNode": 190,
      "highlighted": false
    },
    {
      "fromNode": 164,
      "fromOutput": 2,
      "toNode": 191,
      "highlighted": false
    },
    {
      "fromNode": 164,
      "fromOutput": 3,
      "toNode": 192,
      "highlighted": false
    },
    {
      "fromNode": 164,
      "fromOutput": 4,
      "toNode": 193,
      "highlighted": false
    },
    {
      "fromNode": 185,
      "fromOutput": 0,
      "toNode": 220,
      "highlighted": false
    },
    {
      "fromNode": 185,
      "fromOutput": 1,
      "toNode": 221,
      "highlighted": false
    },
    {
      "fromNode": 185,
      "fromOutput": 2,
      "toNode": 222,
      "highlighted": false
    },
    {
      "fromNode": 185,
      "fromOutput": 3,
      "toNode": 223,
      "highlighted": false
    },
    {
      "fromNode": 185,
      "fromOutput": 4,
      "toNode": 224,
      "highlighted": false
    },
    {
      "fromNode": 185,
      "fromOutput": 5,
      "toNode": 225,
      "highlighted": false
    },
    {
      "fromNode": 223,
      "fromOutput": 0,
      "toNode": 226,
      "highlighted": false
    },
    {
      "fromNode": 226,
      "fromOutput": 0,
      "toNode": 227,
      "highlighted": false
    },
    {
      "fromNode": 226,
      "fromOutput": 1,
      "toNode": 228,
      "highlighted": false
    },
    {
      "fromNode": 3,
      "fromOutput": 0,
      "toNode": 177,
      "highlighted": false
    },
    {
      "fromNode": 3,
      "fromOutput": 1,
      "toNode": 5,
      "highlighted": false
    },
    {
      "fromNode": 3,
      "fromOutput": 2,
      "toNode": 148,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 0,
      "toNode": 149,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 1,
      "toNode": 150,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 3,
      "toNode": 6,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 4,
      "toNode": 7,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 5,
      "toNode": 8,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 6,
      "toNode": 9,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 7,
      "toNode": 10,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 8,
      "toNode": 11,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 9,
      "toNode": 12,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 10,
      "toNode": 13,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 11,
      "toNode": 14,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 12,
      "toNode": 15,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 13,
      "toNode": 16,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 14,
      "toNode": 17,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 15,
      "toNode": 18,
      "highlighted": false
    },
    {
      "fromNode": 4,
      "fromOutput": 16,
      "toNode": 151,
      "highlighted": false
    },
    {
      "fromNode": 5,
      "fromOutput": 0,
      "toNode": 19,
      "highlighted": false
    },
    {
      "fromNode": 5,
      "fromOutput": 1,
      "toNode": 20,
      "highlighted": false
    },
    {
      "fromNode": 5,
      "fromOutput": 2,
      "toNode": 21,
      "highlighted": false
    },
    {
      "fromNode": 5,
      "fromOutput": 3,
      "toNode": 22,
      "highlighted": false
    },
    {
      "fromNode": 7,
      "fromOutput": 0,
      "toNode": 23,
      "highlighted": false
    },
    {
      "fromNode": 8,
      "fromOutput": 0,
      "toNode": 24,
      "highlighted": false
    },
    {
      "fromNode": 8,
      "fromOutput": 1,
      "toNode": 25,
      "highlighted": false
    },
    {
      "fromNode": 9,
      "fromOutput": 0,
      "toNode": 26,
      "highlighted": false
    },
    {
      "fromNode": 10,
      "fromOutput": 0,
      "toNode": 40,
      "highlighted": false
    },
    {
      "fromNode": 10,
      "fromOutput": 1,
      "toNode": 27,
      "highlighted": false
    },
    {
      "fromNode": 11,
      "fromOutput": 0,
      "toNode": 28,
      "highlighted": false
    },
    {
      "fromNode": 11,
      "fromOutput": 1,
      "toNode": 29,
      "highlighted": false
    },
    {
      "fromNode": 11,
      "fromOutput": 2,
      "toNode": 30,
      "highlighted": false
    },
    {
      "fromNode": 11,
      "fromOutput": 3,
      "toNode": 31,
      "highlighted": false
    },
    {
      "fromNode": 12,
      "fromOutput": 0,
      "toNode": 32,
      "highlighted": false
    },
    {
      "fromNode": 13,
      "fromOutput": 0,
      "toNode": 33,
      "highlighted": false
    },
    {
      "fromNode": 14,
      "fromOutput": 0,
      "toNode": 166,
      "highlighted": false
    },
    {
      "fromNode": 15,
      "fromOutput": 0,
      "toNode": 34,
      "highlighted": false
    },
    {
      "fromNode": 15,
      "fromOutput": 1,
      "toNode": 35,
      "highlighted": false
    },
    {
      "fromNode": 16,
      "fromOutput": 0,
      "toNode": 36,
      "highlighted": false
    },
    {
      "fromNode": 16,
      "fromOutput": 1,
      "toNode": 37,
      "highlighted": false
    },
    {
      "fromNode": 17,
      "fromOutput": 0,
      "toNode": 38,
      "highlighted": false
    },
    {
      "fromNode": 17,
      "fromOutput": 1,
      "toNode": 39,
      "highlighted": false
    },
    {
      "fromNode": 23,
      "fromOutput": 0,
      "toNode": 41,
      "highlighted": false
    },
    {
      "fromNode": 32,
      "fromOutput": 0,
      "toNode": 42,
      "highlighted": false
    },
    {
      "fromNode": 32,
      "fromOutput": 1,
      "toNode": 43,
      "highlighted": false
    },
    {
      "fromNode": 32,
      "fromOutput": 2,
      "toNode": 44,
      "highlighted": false
    },
    {
      "fromNode": 32,
      "fromOutput": 3,
      "toNode": 45,
      "highlighted": false
    },
    {
      "fromNode": 32,
      "fromOutput": 4,
      "toNode": 46,
      "highlighted": false
    },
    {
      "fromNode": 33,
      "fromOutput": 0,
      "toNode": 47,
      "highlighted": false
    },
    {
      "fromNode": 33,
      "fromOutput": 1,
      "toNode": 48,
      "highlighted": false
    },
    {
      "fromNode": 45,
      "fromOutput": 0,
      "toNode": 49,
      "highlighted": false
    },
    {
      "fromNode": 45,
      "fromOutput": 1,
      "toNode": 50,
      "highlighted": false
    },
    {
      "fromNode": 45,
      "fromOutput": 2,
      "toNode": 194,
      "highlighted": false
    },
    {
      "fromNode": 46,
      "fromOutput": 0,
      "toNode": 51,
      "highlighted": false
    },
    {
      "fromNode": 46,
      "fromOutput": 1,
      "toNode": 52,
      "highlighted": false
    },
    {
      "fromNode": 46,
      "fromOutput": 2,
      "toNode": 170,
      "highlighted": false
    },
    {
      "fromNode": 46,
      "fromOutput": 3,
      "toNode": 53,
      "highlighted": false
    },
    {
      "fromNode": 53,
      "fromOutput": 0,
      "toNode": 171,
      "highlighted": false
    },
    {
      "fromNode": 53,
      "fromOutput": 1,
      "toNode": 172,
      "highlighted": false
    },
    {
      "fromNode": 53,
      "fromOutput": 2,
      "toNode": 173,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 0,
      "toNode": 3,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 1,
      "toNode": 4,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 2,
      "toNode": 55,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 3,
      "toNode": 56,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 4,
      "toNode": 57,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 5,
      "toNode": 58,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 6,
      "toNode": 135,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 7,
      "toNode": 229,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 8,
      "toNode": 59,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 9,
      "toNode": 230,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 10,
      "toNode": 231,
      "highlighted": false
    },
    {
      "fromNode": 54,
      "fromOutput": 11,
      "toNode": 60,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 0,
      "toNode": 61,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 1,
      "toNode": 62,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 2,
      "toNode": 162,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 3,
      "toNode": 63,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 4,
      "toNode": 64,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 5,
      "toNode": 65,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 6,
      "toNode": 66,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 7,
      "toNode": 67,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 8,
      "toNode": 68,
      "highlighted": false
    },
    {
      "fromNode": 55,
      "fromOutput": 9,
      "toNode": 161,
      "highlighted": false
    },
    {
      "fromNode": 64,
      "fromOutput": 0,
      "toNode": 69,
      "highlighted": false
    },
    {
      "fromNode": 65,
      "fromOutput": 0,
      "toNode": 70,
      "highlighted": false
    },
    {
      "fromNode": 65,
      "fromOutput": 1,
      "toNode": 71,
      "highlighted": false
    },
    {
      "fromNode": 66,
      "fromOutput": 0,
      "toNode": 72,
      "highlighted": false
    },
    {
      "fromNode": 67,
      "fromOutput": 0,
      "toNode": 73,
      "highlighted": false
    },
    {
      "fromNode": 68,
      "fromOutput": 0,
      "toNode": 74,
      "highlighted": false
    },
    {
      "fromNode": 69,
      "fromOutput": 0,
      "toNode": 75,
      "highlighted": false
    },
    {
      "fromNode": 70,
      "fromOutput": 0,
      "toNode": 76,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 0,
      "toNode": 77,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 1,
      "toNode": 78,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 2,
      "toNode": 79,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 3,
      "toNode": 80,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 4,
      "toNode": 81,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 5,
      "toNode": 82,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 6,
      "toNode": 152,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 7,
      "toNode": 153,
      "highlighted": false
    },
    {
      "fromNode": 71,
      "fromOutput": 8,
      "toNode": 83,
      "highlighted": false
    },
    {
      "fromNode": 72,
      "fromOutput": 0,
      "toNode": 195,
      "highlighted": false
    },
    {
      "fromNode": 72,
      "fromOutput": 1,
      "toNode": 196,
      "highlighted": false
    },
    {
      "fromNode": 74,
      "fromOutput": 0,
      "toNode": 84,
      "highlighted": false
    },
    {
      "fromNode": 85,
      "fromOutput": 0,
      "toNode": 86,
      "highlighted": false
    },
    {
      "fromNode": 85,
      "fromOutput": 1,
      "toNode": 87,
      "highlighted": false
    },
    {
      "fromNode": 85,
      "fromOutput": 2,
      "toNode": 163,
      "highlighted": false
    },
    {
      "fromNode": 85,
      "fromOutput": 3,
      "toNode": 88,
      "highlighted": false
    },
    {
      "fromNode": 85,
      "fromOutput": 4,
      "toNode": 164,
      "highlighted": false
    },
    {
      "fromNode": 85,
      "fromOutput": 5,
      "toNode": 165,
      "highlighted": false
    },
    {
      "fromNode": 85,
      "fromOutput": 6,
      "toNode": 89,
      "highlighted": false
    },
    {
      "fromNode": 85,
      "fromOutput": 7,
      "toNode": 90,
      "highlighted": false
    },
    {
      "fromNode": 91,
      "fromOutput": 0,
      "toNode": 92,
      "highlighted": false
    },
    {
      "fromNode": 92,
      "fromOutput": 0,
      "toNode": 93,
      "highlighted": false
    },
    {
      "fromNode": 92,
      "fromOutput": 1,
      "toNode": 94,
      "highlighted": false
    },
    {
      "fromNode": 92,
      "fromOutput": 2,
      "toNode": 95,
      "highlighted": false
    },
    {
      "fromNode": 98,
      "fromOutput": 0,
      "toNode": 99,
      "highlighted": false
    },
    {
      "fromNode": 98,
      "fromOutput": 1,
      "toNode": 100,
      "highlighted": false
    },
    {
      "fromNode": 98,
      "fromOutput": 2,
      "toNode": 101,
      "highlighted": false
    },
    {
      "fromNode": 98,
      "fromOutput": 3,
      "toNode": 102,
      "highlighted": false
    },
    {
      "fromNode": 98,
      "fromOutput": 4,
      "toNode": 103,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 0,
      "toNode": 197,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 1,
      "toNode": 198,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 2,
      "toNode": 199,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 3,
      "toNode": 200,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 4,
      "toNode": 201,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 5,
      "toNode": 202,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 6,
      "toNode": 203,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 7,
      "toNode": 204,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 8,
      "toNode": 205,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 9,
      "toNode": 206,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 10,
      "toNode": 207,
      "highlighted": false
    },
    {
      "fromNode": 107,
      "fromOutput": 11,
      "toNode": 208,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 0,
      "toNode": 209,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 1,
      "toNode": 210,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 2,
      "toNode": 211,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 3,
      "toNode": 212,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 4,
      "toNode": 213,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 5,
      "toNode": 214,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 6,
      "toNode": 215,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 7,
      "toNode": 216,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 8,
      "toNode": 217,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 9,
      "toNode": 218,
      "highlighted": false
    },
    {
      "fromNode": 108,
      "fromOutput": 10,
      "toNode": 219,
      "highlighted": false
    },
    {
      "fromNode": 135,
      "fromOutput": 0,
      "toNode": 136,
      "highlighted": false
    },
    {
      "fromNode": 135,
      "fromOutput": 1,
      "toNode": 137,
      "highlighted": false
    },
    {
      "fromNode": 135,
      "fromOutput": 2,
      "toNode": 138,
      "highlighted": false
    },
    {
      "fromNode": 135,
      "fromOutput": 3,
      "toNode": 139,
      "highlighted": false
    },
    {
      "fromNode": 135,
      "fromOutput": 4,
      "toNode": 140,
      "highlighted": false
    },
    {
      "fromNode": 135,
      "fromOutput": 5,
      "toNode": 141,
      "highlighted": false
    },
    {
      "fromNode": 135,
      "fromOutput": 6,
      "toNode": 142,
      "highlighted": false
    },
    {
      "fromNode": 139,
      "fromOutput": 0,
      "toNode": 143,
      "highlighted": false
    },
    {
      "fromNode": 148,
      "fromOutput": 0,
      "toNode": 175,
      "highlighted": false
    },
    {
      "fromNode": 148,
      "fromOutput": 1,
      "toNode": 176,
      "highlighted": false
    },
    {
      "fromNode": 151,
      "fromOutput": 0,
      "toNode": 174,
      "highlighted": false
    },
    {
      "fromNode": 153,
      "fromOutput": 0,
      "toNode": 154,
      "highlighted": false
    },
    {
      "fromNode": 154,
      "fromOutput": 0,
      "toNode": 155,
      "highlighted": false
    },
    {
      "fromNode": 154,
      "fromOutput": 1,
      "toNode": 156,
      "highlighted": false
    },
    {
      "fromNode": 154,
      "fromOutput": 2,
      "toNode": 232,
      "highlighted": false
    },
    {
      "fromNode": 156,
      "fromOutput": 0,
      "toNode": 157,
      "highlighted": false
    },
    {
      "fromNode": 156,
      "fromOutput": 1,
      "toNode": 158,
      "highlighted": false
    },
    {
      "fromNode": 156,
      "fromOutput": 2,
      "toNode": 159,
      "highlighted": false
    },
    {
      "fromNode": 156,
      "fromOutput": 3,
      "toNode": 160,
      "highlighted": false
    },
    {
      "fromNode": 104,
      "fromOutput": 6,
      "toNode": 233,
      "highlighted": false
    },
    {
      "fromNode": 233,
      "fromOutput": 0,
      "toNode": 234,
      "highlighted": false
    },
    {
      "fromNode": 0,
      "fromOutput": 5,
      "toNode": 235,
      "highlighted": false
    },
    {
      "fromNode": 235,
      "fromOutput": 0,
      "toNode": 236,
      "highlighted": false
    }
  ],
  "viewState": {
    "scale": 0.9999999999999997,
    "translateX": 993.4232250165951,
    "translateY": 195.40542730198598
  },
  "savedAt": "2025-06-30T14:42:45.421Z"
}